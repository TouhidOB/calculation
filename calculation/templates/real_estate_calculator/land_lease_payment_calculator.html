{% extends "base.html" %}

{% block title %}Land Lease Payment Calculator{% endblock %}

{% block meta_description %}Calculate the total and monthly cost of a land lease agreement based on annual rent, rent escalation rate, and the lease term.{% endblock %}

{% block meta_keywords %}land lease calculator, ground lease cost, annual rent escalation, real estate lease finance, commercial property lease{% endendblock %}

{% block extra_head %}
<!-- Include Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

<style>
    /* Custom Styling for a Neutral Earth/Brown Theme (Land/Leasing) */
    .solver-wrapper {
        background: #fcfbf8; /* Very light beige/cream */
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 900px; 
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-section {
        padding: 25px;
        border-radius: 10px;
        background-color: #f7ede3; /* Light Earth Tone */
        border: 2px solid #a16207; /* Ocher/Dark Brown accent */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 30px;
    }
    
    .input-box label {
        font-size: 1rem;
        font-weight: 600;
        color: #78350f; /* Deep Brown */
        display: block;
        margin-bottom: 5px;
    }

    .form-control-custom {
        padding: 12px;
        font-size: 1.1rem;
        border: 2px solid #fcd34d; 
        border-radius: 8px;
        font-weight: 700;
        color: #b45309;
    }
    .form-control-custom:focus {
        border-color: #a16207;
        box-shadow: 0 0 0 0.25rem rgba(161, 98, 7, 0.25);
    }

    .result-section {
        margin-top: 30px;
    }

    .summary-card {
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.15);
        background-color: #fffbeb; /* Very Pale Yellow/Cream */
        border-left: 5px solid #a16207; /* Dark Ocher accent */
    }

    .result-error {
        border-left: 5px solid #ef4444; /* Red */
        background-color: #fee2e2;
        color: #991b1b;
        padding: 20px;
        border-radius: 8px;
    }
    
    /* Styles for Cost display */
    .result-label {
        font-size: 1.2rem;
        font-weight: 600;
        color: #78350f; /* Deep Brown */
    }
    
    .cost-value {
        font-size: 3.5rem;
        font-weight: 900;
        color: #a16207; /* Bright Ocher */
    }
    
    .text-brown { color: #78350f !important; }
    .text-ocher { color: #a16207 !important; }

</style>
{% endblock %}

{% block content %}
<div class="container p-4 p-md-5">
    <h1 class="h3 fw-bolder mb-2 text-dark text-center">ðŸŒ³ Land Lease Cost Calculator</h1>
    <p class="text-secondary mb-5 text-center">
        Determine the total cost of a ground lease, accounting for annual rental amounts and fixed escalation rates.
    </p>

    <div class="solver-wrapper">
        
        <form id="lease-form" class="row g-4 justify-content-center">
            
            <!-- Financial Inputs -->
            <div class="col-lg-6">
                <div class="input-section h-100">
                    <h4 class="h5 fw-bold text-center text-brown p-2 rounded mb-4">1. Lease Financials</h4>
                    
                    <div class="input-box mb-4">
                        <label for="initial-rent">Year 1 Annual Rent:</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" id="initial-rent" 
                               value="15000" 
                               min="100"
                               step="100"
                               required
                               class="form-control form-control-custom">
                        </div>
                        <small class="text-muted">The annual rent amount due in the first year of the lease.</small>
                    </div>
                    
                    <div class="input-box mb-4">
                        <label for="escalation-rate">Annual Rent Escalation Rate:</label>
                        <div class="input-group">
                            <input type="number" id="escalation-rate" 
                               value="3" 
                               min="0" 
                               max="15"
                               step="0.1"
                               required 
                               class="form-control form-control-custom">
                             <span class="input-group-text">%</span>
                        </div>
                        <small class="text-muted">The percentage by which the annual rent increases each year.</small>
                    </div>

                </div>
            </div>
            
            <!-- Time Input -->
            <div class="col-lg-6">
                <div class="input-section h-100">
                    <h4 class="h5 fw-bold text-center text-brown p-2 rounded mb-4">2. Lease Term</h4>
                    
                    <div class="input-box mb-4">
                        <label for="lease-term">Total Lease Term (Years):</label>
                        <div class="input-group">
                            <input type="number" id="lease-term" 
                               value="25" 
                               min="1" 
                               max="99"
                               step="1"
                               required 
                               class="form-control form-control-custom">
                            <span class="input-group-text">Years</span>
                        </div>
                        <small class="text-muted">The full duration of the land lease agreement.</small>
                    </div>
                    
                    <div class="text-center mt-5">
                        <p class="text-muted fw-bold mb-0">The calculation assumes rent is paid annually at the start of each year (or simple interest compounding).</p>
                    </div>
                </div>
            </div>
            
            <div class="col-12 mt-0">
                <button type="submit"
                    class="btn btn-primary w-100 py-3 fw-bold shadow-lg text-white" style="background-color: #a16207; border: none;">
                Calculate Total Lease Cost
            </button>
            </div>
        </form>

        <div id="result-container" class="result-section">
            <div id="summary-output" class="summary-card d-none mb-4"></div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<!-- Include Bootstrap 5 JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    /**
     * Formats a number as USD currency (with cents for accuracy).
     */
    const currencyFormatterCents = new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: 2,
        maximumFractionDigits: 2,
    });
    
    /**
     * Updates the UI with the calculation result or error.
     */
    function displayResult(isError, contentHtml) {
        const summaryDiv = document.getElementById('summary-output');
        
        summaryDiv.classList.remove('d-none', 'result-error', 'summary-card');
        
        if (isError) {
            summaryDiv.classList.add('result-error');
            summaryDiv.classList.remove('summary-card');
            summaryDiv.innerHTML = contentHtml;
        } else {
            summaryDiv.classList.add('summary-card');
            summaryDiv.classList.remove('result-error');
            summaryDiv.innerHTML = contentHtml;
        }
    }

    /**
     * Gathers all inputs from the form.
     */
    function getInputs() {
        const inputs = {
            initialRent: parseFloat(document.getElementById('initial-rent').value),
            escalationRate: parseFloat(document.getElementById('escalation-rate').value),
            leaseTerm: parseInt(document.getElementById('lease-term').value),
        };
        
        if (isNaN(inputs.initialRent) || inputs.initialRent <= 0) {
            throw new Error("Initial Annual Rent must be a valid positive number.");
        }
        if (isNaN(inputs.escalationRate) || inputs.escalationRate < 0) {
            throw new Error("Escalation Rate must be zero or a positive number.");
        }
        if (isNaN(inputs.leaseTerm) || inputs.leaseTerm < 1) {
            throw new Error("Lease Term must be at least 1 year.");
        }
        return inputs;
    }

    /**
     * Handles form submission and triggers the calculation.
     */
    function handleLeaseCalc(e) {
        e.preventDefault();

        try {
            const i = getInputs();
            const rateDecimal = i.escalationRate / 100;
            let totalLeaseCost = 0;
            let finalYearRent = i.initialRent;
            
            // 1. Calculate Total Lease Cost (sum of all annual payments)
            for (let year = 1; year <= i.leaseTerm; year++) {
                // Rent for the current year (Year 1 rent is initialRent)
                let currentYearRent = i.initialRent * Math.pow(1 + rateDecimal, year - 1);
                
                totalLeaseCost += currentYearRent;
                
                if (year === i.leaseTerm) {
                    finalYearRent = currentYearRent;
                }
            }
            
            // 2. Calculate Averages
            const avgAnnualCost = totalLeaseCost / i.leaseTerm;
            const avgMonthlyCost = avgAnnualCost / 12;

            // 3. Build Summary HTML
            const summaryHtml = `
                <h4 class="h5 fw-bold text-center text-brown mb-4">Total Lease Cost Summary</h4>
                
                <div class="row text-center align-items-center mb-4">
                    
                    <!-- Total Lease Cost -->
                    <div class="col-md-6 mb-3 border-end border-ocher">
                        <p class="result-label">TOTAL LEASE COST (${i.leaseTerm} YEARS)</p>
                        <p class="cost-value mb-0 text-ocher">
                            ${currencyFormatterCents.format(totalLeaseCost)}
                        </p>
                    </div>

                    <!-- Average Monthly Cost -->
                    <div class="col-md-6 mb-3">
                        <p class="result-label">AVERAGE MONTHLY COST</p>
                        <p class="cost-value mb-0 text-brown" style="font-size: 2.5rem;">
                            ${currencyFormatterCents.format(avgMonthlyCost)}
                        </p>
                    </div>
                </div>
                
                <hr class="my-4">
                
                <h5 class="h6 fw-bold text-center text-brown mb-3">Key Metrics</h5>
                
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <table class="table table-sm table-borderless">
                            <tbody>
                                <tr>
                                    <td class="fw-bold">Starting Annual Rent (Year 1)</td>
                                    <td class="text-end">${currencyFormatterCents.format(i.initialRent)}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Final Annual Rent (Year ${i.leaseTerm})</td>
                                    <td class="text-end">${currencyFormatterCents.format(finalYearRent)}</td>
                                </tr>
                                <tr>
                                    <td class="fw-bold">Average Annual Cost Over Term</td>
                                    <td class="text-end">${currencyFormatterCents.format(avgAnnualCost)}</td>
                                </tr>
                                <tr class="table-warning">
                                    <td class="fw-bolder fs-6">Total Lease Cost</td>
                                    <td class="text-end fw-bolder fs-6 text-ocher">${currencyFormatterCents.format(totalLeaseCost)}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
            
            displayResult(false, summaryHtml);
            
        } catch (error) {
            console.error(error);
             const htmlContent = `<p class="fw-bold text-center">Calculation Error</p><p class="text-center">${error.message}</p>`;
            displayResult(true, htmlContent);
        }
    }

    // Attach handler to the form
    document.getElementById('lease-form').addEventListener('submit', handleLeaseCalc);

    // Initial calculation for default value on load
    window.onload = function() {
        document.getElementById('lease-form').dispatchEvent(new Event('submit'));
    };
</script>
{% endblock %}