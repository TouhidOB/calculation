{% extends "base.html" %}

{% block title %}Moving Cost Estimator{% endblock %}

{% block meta_description %}Estimate the total cost of your move based on home size, distance, and optional services like packing and storage.{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    :root {
        --move-blue: #1e40af;
        --move-yellow: #facc15;
        --move-light: #eff6ff;
    }

    body {
        background-color: #f8fafc;
        font-family: 'Inter', system-ui, -apple-system, sans-serif;
    }

    .calc-card {
        background: white;
        border-radius: 1.25rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        border: 1px solid #bfdbfe;
        overflow: hidden;
    }

    .input-sidebar {
        background-color: var(--move-light);
        border-right: 1px solid #dbeafe;
    }

    .form-label {
        font-weight: 700;
        color: var(--move-blue);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    .result-display-box {
        background-color: white;
        border: 2px solid var(--move-blue);
        border-radius: 1rem;
        padding: 2rem;
        text-align: center;
        position: relative;
    }

    .estimate-value {
        font-size: 3.5rem;
        font-weight: 900;
        color: var(--move-blue);
        line-height: 1;
    }

    .stat-mini {
        background: #f1f5f9;
        border-radius: 0.75rem;
        padding: 1rem;
        border: 1px solid #e2e8f0;
    }

    .placeholder-state {
        padding: 5rem 2rem;
        text-align: center;
        color: #94a3b8;
    }

    .service-toggle {
        transition: all 0.2s ease;
        cursor: pointer;
        border: 1px solid #dbeafe;
    }

    .service-toggle:hover {
        background-color: #dbeafe !important;
    }

    @media print {
        .input-sidebar, .btn-no-print { display: none !important; }
        .calc-card { border: none; box-shadow: none; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-dark"><i class="bi bi-truck text-primary me-2"></i>Relocation Cost Modeler</h1>
        <p class="text-muted mx-auto" style="max-width: 650px;">
            Moving expenses vary wildly based on volume and labor. Use this model to estimate professional moving company fees and logistics surcharges.
        </p>
    </div>

    <div class="calc-card mx-auto" style="max-width: 1100px;">
        <div class="row g-0">
            <div class="col-lg-5 input-sidebar p-4 p-md-5">
                <form id="moving-form">
                    <h6 class="fw-bold text-dark mb-4 text-uppercase small">Inventory & Distance</h6>
                    
                    <div class="mb-3">
                        <label class="form-label">Home Size / Inventory Volume</label>
                        <select id="home-size" class="form-select shadow-sm" required>
                            <option value="" disabled selected>Select size...</option>
                            <option value="800">Studio / 1 Bedroom Apt</option>
                            <option value="1300">2 Bedroom Home</option>
                            <option value="1900">3 Bedroom Home</option>
                            <option value="2600">4+ Bedroom Home</option>
                        </select>
                    </div>

                    <div class="row g-2 mb-4">
                        <div class="col-7">
                            <label class="form-label">Total Distance</label>
                            <div class="input-group shadow-sm">
                                <input type="number" id="move-distance" class="form-control border-end-0" placeholder="e.g. 150" required>
                                <span class="input-group-text bg-white border-start-0 text-muted">Miles</span>
                            </div>
                        </div>
                        <div class="col-5">
                            <label class="form-label">Fuel Index %</label>
                            <input type="number" id="fuel-cost" class="form-control shadow-sm" placeholder="10">
                        </div>
                    </div>

                    <h6 class="fw-bold text-dark mb-3 text-uppercase small pt-3 border-top">Premium Logistics</h6>

                    <div class="form-check p-2 rounded service-toggle mb-2 bg-white shadow-sm">
                        <input class="form-check-input ms-1" type="checkbox" id="packing-service">
                        <label class="form-check-label ms-2 small fw-bold" for="packing-service">Full Professional Packing</label>
                    </div>

                    <div class="form-check p-2 rounded service-toggle mb-2 bg-white shadow-sm">
                        <input class="form-check-input ms-1" type="checkbox" id="storage-service">
                        <label class="form-check-label ms-2 small fw-bold" for="storage-service">30-Day Transition Storage</label>
                    </div>

                    <div class="mb-4 mt-3">
                        <label class="form-label">Valuation (Protection)</label>
                        <select id="insurance-tier" class="form-select shadow-sm">
                            <option value="0">Standard Release Value ($0.60/lb)</option>
                            <option value="0.05">Full Value Protection (Basic)</option>
                            <option value="0.12">High Value Protection</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary w-100 py-3 fw-bold shadow-sm" style="background-color: var(--move-blue); border: none;">
                        Generate Estimate <i class="bi bi-arrow-right-circle ms-1"></i>
                    </button>
                    
                    <button type="reset" class="btn btn-link w-100 mt-2 text-decoration-none text-muted small">Clear Data</button>
                </form>
            </div>

            <div class="col-lg-7 p-4 p-md-5 bg-white">
                
                <div id="placeholder-ui" class="placeholder-state w-100">
                    <i class="bi bi-box-seam display-1 mb-3 opacity-25" style="color: var(--move-blue);"></i>
                    <h4 class="fw-bold text-dark">Ready to Estimate?</h4>
                    <p>Provide your move details to calculate labor costs, transportation rates, and optional service fees.</p>
                </div>

                <div id="results-ui" class="w-100 d-none">
                    <div class="result-display-box mb-4 shadow-sm">
                        <span class="form-label text-muted mb-2 d-block">Estimated Professional Quote</span>
                        <div class="estimate-value mb-2" id="total-cost-display">$0.00</div>
                        <div class="badge bg-warning text-dark px-3 py-2 rounded-pill" id="move-type-badge">Local Move</div>
                    </div>

                    

                    <div class="row g-3 mb-4">
                        <div class="col-md-4">
                            <div class="stat-mini text-center">
                                <span class="form-label d-block mb-1 text-muted">Labor</span>
                                <div class="h5 fw-bold mb-0" id="labor-display">$0</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-mini text-center">
                                <span class="form-label d-block mb-1 text-muted">Transport</span>
                                <div class="h5 fw-bold mb-0" id="transport-display">$0</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="stat-mini text-center">
                                <span class="form-label d-block mb-1 text-muted">Services</span>
                                <div class="h5 fw-bold mb-0" id="services-display">$0</div>
                            </div>
                        </div>
                    </div>

                    <div class="p-3 rounded-4 bg-light border shadow-sm">
                        <h6 class="fw-bold text-dark mb-1 small"><i class="bi bi-info-square-fill me-2 text-primary"></i>Estimate Note</h6>
                        <p class="x-small text-muted mb-0">
                            Professional quotes are usually based on <strong>actual weight</strong> or <strong>cubic feet</strong>. This estimate uses volume averages for your selected home size.
                        </p>
                    </div>
                </div>

                <div id="error-ui" class="w-100 d-none text-center">
                    <div class="alert alert-danger rounded-4 p-4 shadow-sm">
                        <i class="bi bi-geo-alt-fill fs-1 d-block mb-2"></i>
                        <h5 class="fw-bold">Invalid Route</h5>
                        <p id="error-msg" class="mb-0 small"></p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const form = document.getElementById('moving-form');
    const resultsUi = document.getElementById('results-ui');
    const placeholderUi = document.getElementById('placeholder-ui');
    const errorUi = document.getElementById('error-ui');

    const currency = new Intl.NumberFormat('en-US', {
        style: 'currency', currency: 'USD', minimumFractionDigits: 2,
    });

    form.addEventListener('submit', function(e) {
        e.preventDefault();

        const baseLabor = parseFloat(document.getElementById('home-size').value);
        const dist = parseFloat(document.getElementById('move-distance').value);
        const fuelIndex = parseFloat(document.getElementById('fuel-cost').value || 10);
        const packing = document.getElementById('packing-service').checked;
        const storage = document.getElementById('storage-service').checked;
        const insFactor = parseFloat(document.getElementById('insurance-tier').value);

        placeholderUi.classList.add('d-none');
        resultsUi.classList.add('d-none');
        errorUi.classList.add('d-none');

        if (isNaN(baseLabor) || isNaN(dist) || dist < 1) {
            errorUi.classList.remove('d-none');
            document.getElementById('error-msg').innerText = "Please specify home size and a valid distance.";
            return;
        }

        // 1. Transportation Logic
        const isLongDistance = dist >= 100;
        let transportCost = isLongDistance ? 
            (dist * 1.50 * (baseLabor / 1000)) : 
            ((dist * 5.00) + 500);

        // 2. Services Logic
        const packingCost = packing ? (baseLabor * 0.35) : 0;
        const storageCost = storage ? 350 : 0;
        const insCost = baseLabor * insFactor;
        
        const subtotal = baseLabor + transportCost + packingCost + storageCost + insCost;
        const fuelSurcharge = subtotal * (fuelIndex / 100);
        const total = subtotal + fuelSurcharge;

        // UI Updates
        resultsUi.classList.remove('d-none');
        document.getElementById('total-cost-display').textContent = currency.format(total);
        document.getElementById('labor-display').textContent = currency.format(baseLabor);
        document.getElementById('transport-display').textContent = currency.format(transportCost + fuelSurcharge);
        document.getElementById('services-display').textContent = currency.format(packingCost + storageCost + insCost);
        
        const badge = document.getElementById('move-type-badge');
        badge.textContent = isLongDistance ? "Interstate / Long Distance" : "Local Intra-City Move";
        badge.className = isLongDistance ? "badge bg-primary text-white px-3 py-2 rounded-pill" : "badge bg-warning text-dark px-3 py-2 rounded-pill";
    });

    form.addEventListener('reset', () => {
        resultsUi.classList.add('d-none');
        placeholderUi.classList.remove('d-none');
        errorUi.classList.add('d-none');
    });
</script>
{% endblock %}