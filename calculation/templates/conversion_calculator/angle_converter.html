{% extends "base.html" %}

{% block title %}Angle Converter (Degrees to Radians, etc.){% endblock %}

{% block meta_description %}Convert angle measurements instantly between Degrees, Radians, Gradians, and Turns. Supports Degrees-Minutes-Seconds (DMS) input.{% endblock %}

{% block meta_keywords %}angle converter, degrees to radians, gradian, turn, dms, trigonometry, math converter{% endblock %}

{% block extra_head %}
<style>
    /* Base styles from the template */
    .calc-wrapper {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    
    .section-title {
        font-weight: 600;
        margin-top: 20px;
        color: #343a40;
    }
    
    /* Input Group Styling */
    .conversion-input-group {
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
        background: #f0fff0; /* Light green/mint theme for math/angles */
        border-radius: 8px;
        padding: 15px;
        border: 1px solid #28a745;
    }
    
    .conversion-input-group label {
        font-weight: 500;
        margin-bottom: 5px;
        color: #1e7e34;
    }

    .conversion-input-group input[type="text"],
    .conversion-input-group select {
        font-size: 1.1rem;
        padding: 8px;
        border-radius: 6px;
        border: 1px solid #ced4da;
    }
    
    /* Results List Styling */
    .result-list-group {
        border-radius: 8px;
        overflow: hidden;
    }

    .result-list-group .list-group-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        border-left: 4px solid transparent;
        transition: all 0.2s ease;
    }
    
    .result-list-group .list-group-item:hover {
        background-color: #f1f3f5;
    }

    .result-list-group .unit-name {
        font-weight: 500;
        color: #495057;
    }
    
    .result-list-group .unit-value {
        font-size: 1.1rem;
        font-weight: bold;
        color: #28a745; /* Green theme */
    }
    
    .highlight-item {
        border-left-color: #28a745 !important; 
        background-color: #f3fff3;
    }
    
    .conversion-button {
        background-color: #28a745;
        color: white;
        font-weight: bold;
        padding: 12px;
        margin-top: 20px;
        border-radius: 8px;
        width: 100%;
        transition: background-color 0.2s;
    }
    .conversion-button:hover {
        background-color: #1e7e34;
    }

    /* DMS Input Grid */
    #dmsInputContainer {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 10px;
    }

    .dms-group {
        display: flex;
        flex-direction: column;
    }
    .dms-group input {
        text-align: center;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-3">üìê Angle Converter</h1>
    <p class="small-muted">Convert angular measurements: Radians, Degrees, Gradians, and Turns. Supports input as Decimal Degrees or Degrees-Minutes-Seconds (DMS).</p>
    [Image of geometric angle showing degrees and radians]

    <div class="calc-wrapper mt-4">

        <h5 class="section-title">Step 1: Input Type and Value</h5>

        <div class="conversion-input-group">
            <label for="inputMethodSelect">Input Method</label>
            <select id="inputMethodSelect" class="form-select mb-3">
                <option value="decimal">Decimal/Standard Input (e.g., 90, 1.57)</option>
                <option value="dms">Degrees-Minutes-Seconds (DMS) Input</option>
            </select>

            <!-- Decimal Input Container -->
            <div id="decimalInputContainer">
                <label for="decimalValueInput">Enter Angle Value</label>
                <div class="d-flex">
                    <input type="number" class="form-control me-2" id="decimalValueInput" placeholder="e.g., 90 or 1.57" value="90" step="any" autofocus>
                    <select id="unitSelect" class="form-select w-50">
                        <!-- Options populated by JS -->
                    </select>
                </div>
            </div>

            <!-- DMS Input Container (Initially hidden) -->
            <div id="dmsInputContainer" style="display:none;">
                <div class="dms-group">
                    <label for="dmsDegrees">Degrees $\left(^{\circ}\right)$</label>
                    <input type="number" id="dmsDegrees" placeholder="0-359" value="90">
                </div>
                <div class="dms-group">
                    <label for="dmsMinutes">Minutes $\left(\prime\right)$</label>
                    <input type="number" id="dmsMinutes" placeholder="0-59" value="0">
                </div>
                <div class="dms-group">
                    <label for="dmsSeconds">Seconds $\left(\prime\prime\right)$</label>
                    <input type="number" id="dmsSeconds" placeholder="0-59" value="0">
                </div>
            </div>
        </div>

        <button class="btn conversion-button" id="convertButton">
            Convert Angle
        </button>

        <h5 class="section-title mt-4">Step 2: Conversion Results</h5>
        
        <div class="list-group result-list-group mt-3" id="resultsList">
            <div class="alert alert-info" id="initialMessage">Enter an angle value and click 'Convert Angle' to see all formats.</div>
        </div>

    </div>
    
    <div class="mt-5">
        <p class="small-muted">**Key Formulas:** $1 \text{ Turn} = 360^{\circ} = 2\pi \text{ radians} = 400 \text{ gradian}$.</p>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    // --- CONVERSION FACTORS (Base is Radians) ---
    // Factor: Multiplier to convert 1 RADIANS to the target unit
    const UNIT_FACTORS = {
        'radian': { name: 'Radians', factor: 1, abbr: 'rad', decimal: 6 },
        'degree': { name: 'Degrees (Decimal)', factor: 180 / Math.PI, abbr: '¬∞', decimal: 6 },
        'gradian': { name: 'Gradians', factor: 200 / Math.PI, abbr: 'grad', decimal: 6 },
        'turn': { name: 'Turns', factor: 1 / (2 * Math.PI), abbr: 'turns', decimal: 8 }
    };
    
    // Units that can be selected in the input dropdown
    const SELECTABLE_UNITS = [
        { key: 'degree', name: 'Degrees' },
        { key: 'radian', name: 'Radians' },
        { key: 'gradian', name: 'Gradians' },
        { key: 'turn', name: 'Turns' }
    ];

    let activeUnit = 'degree'; // Default unit for decimal input
    const inputMethodSelect = document.getElementById('inputMethodSelect');
    const decimalContainer = document.getElementById('decimalInputContainer');
    const dmsContainer = document.getElementById('dmsInputContainer');
    const decimalValueInput = document.getElementById('decimalValueInput');
    const unitSelect = document.getElementById('unitSelect');
    const dmsDegrees = document.getElementById('dmsDegrees');
    const dmsMinutes = document.getElementById('dmsMinutes');
    const dmsSeconds = document.getElementById('dmsSeconds');
    const convertButton = document.getElementById('convertButton');
    const resultsList = document.getElementById('resultsList');
    
    // --- UTILITY FUNCTIONS ---

    /**
     * Converts Decimal Degrees to Degrees-Minutes-Seconds (DMS) string.
     */
    function toDMS(decimalDegree) {
        let isNegative = decimalDegree < 0;
        let absDD = Math.abs(decimalDegree);

        let D = Math.floor(absDD);
        let M = Math.floor((absDD - D) * 60);
        let S = ((absDD - D) * 60 - M) * 60;

        let sign = isNegative ? '-' : '';
        
        return `${sign}${D}¬∞ ${M}' ${S.toFixed(3)}"`;
    }

    /**
     * Converts Degrees-Minutes-Seconds (DMS) components to Decimal Degrees.
     */
    function dmsToDecimal(D, M, S) {
        // Ensure inputs are valid numbers
        D = parseFloat(D) || 0;
        M = parseFloat(M) || 0;
        S = parseFloat(S) || 0;
        
        let sign = D < 0 ? -1 : 1;
        
        // Use absolute values for calculation
        let absD = Math.abs(D);
        let absM = Math.abs(M);
        let absS = Math.abs(S);

        // DMS calculation: D + M/60 + S/3600
        let decimalDegree = absD + (absM / 60) + (absS / 3600);
        
        return decimalDegree * sign;
    }

    /**
     * Populates the unit select dropdown.
     */
    function populateUnitSelect() {
        unitSelect.innerHTML = '';
        SELECTABLE_UNITS.forEach(unit => {
            const option = document.createElement('option');
            option.value = unit.key;
            option.textContent = `${unit.name} (${UNIT_FACTORS[unit.key].abbr})`;
            unitSelect.appendChild(option);
        });
        unitSelect.value = activeUnit;
    }
    
    // --- MAIN CONVERSION LOGIC ---

    /**
     * Main function to perform the angle conversion.
     */
    function convertAngle() {
        const inputMethod = inputMethodSelect.value;
        let baseRadians = null;
        let decimalDegrees = null;

        // 1. Determine the input value and convert to BASE RADIANS
        if (inputMethod === 'decimal') {
            const inputValue = parseFloat(decimalValueInput.value);
            const inputUnitKey = unitSelect.value;
            
            if (isNaN(inputValue)) {
                resultsList.innerHTML = `<div class="alert alert-warning">Please enter a valid number for the angle.</div>`;
                return;
            }
            
            // Convert input unit to Radians
            const radFactor = UNIT_FACTORS[inputUnitKey].factor;
            baseRadians = inputValue / radFactor;

            if (inputUnitKey === 'degree') {
                decimalDegrees = inputValue;
            } else {
                decimalDegrees = baseRadians * UNIT_FACTORS['degree'].factor;
            }

        } else if (inputMethod === 'dms') {
            const D = dmsDegrees.value;
            const M = dmsMinutes.value;
            const S = dmsSeconds.value;
            
            decimalDegrees = dmsToDecimal(D, M, S);
            
            // Convert Degrees to Radians
            const degFactor = UNIT_FACTORS['degree'].factor;
            baseRadians = decimalDegrees / degFactor;
        }

        if (baseRadians === null || isNaN(baseRadians)) {
            resultsList.innerHTML = `<div class="alert alert-danger">Invalid input. Check the values in the selected fields.</div>`;
            return;
        }

        // 2. Display all converted formats
        resultsList.innerHTML = '';

        // Display DMS format first
        const dmsResult = toDMS(decimalDegrees);
        resultsList.innerHTML += `
            <div class="list-group-item highlight-item">
                <span class="unit-name">Degrees-Minutes-Seconds (DMS)</span>
                <span class="unit-value">${dmsResult}</span>
            </div>
        `;
        
        // Display all other standard units
        SELECTABLE_UNITS.forEach(unit => {
            const toKey = unit.key;
            const { name, abbr, factor, decimal } = UNIT_FACTORS[toKey];
            
            // Convert from Base Radians to Target Unit
            const convertedValue = baseRadians * factor;
            
            const li = document.createElement('div');
            li.classList.add('list-group-item');

            // Highlight the degree result separately for decimal input method
            if (inputMethod === 'decimal' && toKey === unitSelect.value) {
                li.classList.add('highlight-item');
            }

            li.innerHTML = `
                <span class="unit-name">${name} (${abbr})</span>
                <span class="unit-value">${convertedValue.toFixed(decimal)}</span>
            `;
            
            resultsList.appendChild(li);
        });
    }
    
    // --- UI/Input Logic ---

    /**
     * Toggles visibility between Decimal/Standard input and DMS input fields.
     */
    function toggleInputMethod() {
        if (inputMethodSelect.value === 'dms') {
            decimalContainer.style.display = 'none';
            dmsContainer.style.display = 'grid';
            // Clear decimal input value to prevent confusion
            decimalValueInput.value = '';
        } else {
            decimalContainer.style.display = 'block';
            dmsContainer.style.display = 'none';
            // Clear DMS inputs to prevent confusion
            dmsDegrees.value = 90;
            dmsMinutes.value = 0;
            dmsSeconds.value = 0;
            // Restore default decimal input
            decimalValueInput.value = 90;
            unitSelect.value = 'degree';
        }
        convertAngle(); // Rerun conversion on change
    }

    // --- Initialization and Event Listeners ---

    window.onload = function() {
        populateUnitSelect();
        
        inputMethodSelect.addEventListener('change', toggleInputMethod);
        convertButton.addEventListener('click', convertAngle);
        
        // Live update listeners for DMS fields
        dmsDegrees.addEventListener('input', convertAngle);
        dmsMinutes.addEventListener('input', convertAngle);
        dmsSeconds.addEventListener('input', convertAngle);
        
        // Live update listeners for Decimal fields
        decimalValueInput.addEventListener('input', convertAngle);
        unitSelect.addEventListener('change', convertAngle);
        
        // Initial conversion run
        convertAngle();
    };

</script>
{% endblock %}