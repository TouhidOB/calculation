{% extends "base.html" %}

{% block title %}Hurricane Category/Wind Speed Converter (Saffir-Simpson Scale){% endblock %}

{% block meta_description %}Convert wind speed (knots, MPH, km/h) to the corresponding Saffir-Simpson Hurricane Wind Scale category, and see speed conversions.{% endblock %}

{% block meta_keywords %}hurricane, wind speed, Saffir-Simpson scale, category converter, tropical storm, knots, MPH, km/h{% endblock %}

{% block extra_head %}
<style>
    /* Base styles from the template */
    .calc-wrapper {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    
    .section-title {
        font-weight: 600;
        margin-top: 20px;
        color: #0d47a1; /* Deep Blue Theme for Weather/Hurricanes */
    }
    
    /* Input Group Styling */
    .input-group-custom {
        margin-bottom: 20px;
        background: #e3f2fd; /* Very light blue background for emphasis */
        border-radius: 8px;
        padding: 15px;
        border: 1px solid #0d47a1; 
    }
    
    .input-group-custom label {
        font-weight: 500;
        margin-bottom: 5px;
        color: #1565c0;
    }

    .input-field {
        font-size: 1.2rem;
        padding: 10px;
        border-radius: 6px;
        border: 1px solid #ced4da;
    }

    /* Speed/Unit Combo Input Styling */
    .speed-input-container {
        display: flex;
        gap: 10px;
    }
    .speed-input-container input {
        flex-grow: 2;
    }
    .speed-input-container select {
        flex-grow: 1;
        max-width: 100px;
    }

    /* Results Styling */
    .result-list-group .list-group-item {
        display: flex;
        flex-direction: column;
        align-items: start;
        padding: 15px 20px;
        margin-bottom: 10px;
        border-left: 4px solid #0d47a1;
        transition: all 0.2s ease;
        background-color: #f7f7f7;
    }

    .result-list-group .unit-name {
        font-weight: 600;
        color: #343a40;
        margin-bottom: 5px;
        font-size: 1.1rem;
    }
    
    .result-list-group .unit-value {
        font-family: monospace;
        font-size: 1.5rem;
        font-weight: bold;
        color: white; 
        word-break: break-all;
        width: 100%;
        background-color: #1565c0;
        padding: 10px;
        border-radius: 4px;
    }
    
    .conversion-button {
        background-color: #0d47a1;
        color: white;
        font-weight: bold;
        padding: 12px;
        margin-top: 10px;
        border-radius: 8px;
        width: 100%;
        transition: background-color 0.2s;
    }
    .conversion-button:hover {
        background-color: #1565c0;
    }

    /* Category Specific Styling */
    .category-level {
        padding: 10px;
        border-radius: 6px;
        font-size: 1.6rem;
        font-weight: 700;
        text-align: center;
        margin-top: 15px;
        color: white;
    }

    /* Color definitions for categories */
    .category-0 { background-color: #00bcd4; } /* Blue for Tropical Storm */
    .category-1 { background-color: #4caf50; } /* Green */
    .category-2 { background-color: #ffeb3b; color: #333; } /* Yellow */
    .category-3 { background-color: #ff9800; } /* Orange */
    .category-4 { background-color: #ff5722; } /* Deep Orange */
    .category-5 { background-color: #b71c1c; } /* Red */
    .category-lt { background-color: #9e9e9e; } /* Gray for Depression/Wave */
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-3">ðŸŒ€ Hurricane Category/Wind Speed Converter</h1>
    <p class="small-muted">Determine the Saffir-Simpson Hurricane Wind Scale (SSHWS) category from sustained wind speed.</p>
    

    <div class="calc-wrapper mt-4">

        <h5 class="section-title">Step 1: Enter Sustained Wind Speed</h5>
        
        <div class="input-group-custom">
            
            <label for="windSpeedValue">Wind Speed (Sustained)</label>
            <div class="speed-input-container">
                <input type="number" class="form-control input-field" id="windSpeedValue" placeholder="e.g., 90" value="90" min="0" step="0.1">
                <select id="windSpeedUnit" class="form-select input-field">
                    <option value="kt" selected>knots</option>
                    <option value="mph">MPH</option>
                    <option value="kmh">km/h</option>
                </select>
            </div>
            <p class="small-muted mt-1">Sustained wind speeds are typically averaged over one minute.</p>
        </div>

        <button class="btn conversion-button" onclick="calculateCategory()">
            Calculate Category & Conversions
        </button>

        <h5 class="section-title mt-4">Step 2: Calculated Result & Conversions</h5>
        
        <div class="result-list-group mt-3" id="resultsList">
            <div class="alert alert-info" id="initialMessage">Calculated results will appear here.</div>
        </div>

    </div>
    
    <div class="mt-5">
        <p class="small-muted">**Note:** Categories are determined by the *maximum sustained* surface wind speed. This scale does not account for storm surge, rainfall, or tornado potential.</p>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
    // --- CONSTANTS ---
    // Conversion factors to KN (Knots) - Knots is the base calculation unit
    const CONVERSION_FACTORS = {
        'kt': 1,
        'mph': 0.868976, // 1 MPH = 0.868976 knots
        'kmh': 0.539957  // 1 km/h = 0.539957 knots
    };

    // Knots (kt) to other units
    const KN_TO_MPH = 1.15078;
    const KN_TO_KMH = 1.852;

    // Saffir-Simpson Hurricane Wind Scale boundaries (using KNOTS)
    // The scale determines the classification *based on the lower boundary*.
    const SSHWS_SCALE = [
        // { kt: 137, name: "Category 5", color: "category-5", min_mph: 157, min_kmh: 252 }, 
        // We use the reverse order (highest first) for easier "if-else" logic.
        { min_kt: 137, name: "Category 5", color: "category-5" },
        { min_kt: 113, name: "Category 4", color: "category-4" },
        { min_kt: 96,  name: "Category 3", color: "category-3" },
        { min_kt: 83,  name: "Category 2", color: "category-2" },
        { min_kt: 64,  name: "Category 1", color: "category-1" },
        { min_kt: 34,  name: "Tropical Storm", color: "category-0" },
        { min_kt: 0,   name: "Tropical Depression/Wave", color: "category-lt" }
        // Note: kt 64 is the transition point from Tropical Storm to Hurricane Category 1
    ];


    // --- DOM Elements ---
    const windSpeedValue = document.getElementById('windSpeedValue');
    const windSpeedUnit = document.getElementById('windSpeedUnit');
    const resultsList = document.getElementById('resultsList');

    /**
     * Converts the input speed to Knots (kt).
     * @param {number} value - Input speed value.
     * @param {string} unit - Input unit ('kt', 'mph', 'kmh').
     * @returns {number} Speed in knots.
     */
    function convertToKnots(value, unit) {
        return value * CONVERSION_FACTORS[unit];
    }

    /**
     * Determines the Hurricane Category from the speed in knots.
     * @param {number} ktSpeed - Wind speed in knots.
     * @returns {Object} The scale object containing name and color.
     */
    function getCategoryFromKnots(ktSpeed) {
        if (ktSpeed < 0) return { name: "Invalid Speed", color: "alert-danger" };
        
        // Iterate through the scale from highest category down
        for (const category of SSHWS_SCALE) {
            if (ktSpeed >= category.min_kt) {
                return category;
            }
        }
        return SSHWS_SCALE[SSHWS_SCALE.length - 1]; // Should technically be caught by min_kt: 0
    }

    /**
     * Performs the main calculation: conversion and classification.
     */
    function calculateCategory() {
        resultsList.innerHTML = '';
        
        const speedVal = parseFloat(windSpeedValue.value);
        const speedUnit = windSpeedUnit.value;
        
        // --- Validation ---
        if (isNaN(speedVal) || speedVal < 0) {
            resultsList.innerHTML = '<div class="alert alert-danger">Please enter a valid, non-negative wind speed.</div>';
            return;
        }

        // --- Conversion to Knots ---
        const speedInKnots = convertToKnots(speedVal, speedUnit);
        
        // --- Classification ---
        const category = getCategoryFromKnots(speedInKnots);

        // --- Output Conversions ---
        const speedInMPH = speedInKnots * KN_TO_MPH;
        const speedInKMH = speedInKnots * KN_TO_KMH;

        // --- Render Results ---
        
        // 1. Category Result (Main Banner)
        const categoryDiv = document.createElement('div');
        categoryDiv.classList.add('category-level', category.color);
        categoryDiv.textContent = category.name;
        resultsList.appendChild(categoryDiv);

        // 2. Conversion Breakdown
        
        // Knots
        renderResult('Sustained Wind Speed', speedInKnots, 'knots (kt)', false, '#0d47a1', '#e3f2fd');
        
        // MPH
        renderResult('Sustained Wind Speed', speedInMPH, 'MPH', false, '#0d47a1', '#e3f2fd');

        // km/h
        renderResult('Sustained Wind Speed', speedInKMH, 'km/h', false, '#0d47a1', '#e3f2fd');
        
        // 3. Category Description (using the color of the category)
        const descriptionItem = document.createElement('div');
        descriptionItem.classList.add('list-group-item');
        descriptionItem.style.borderLeftColor = '#0d47a1';
        descriptionItem.style.backgroundColor = '#e3f2fd';
        descriptionItem.innerHTML = `
            <div class="unit-name" style="color: #455a64;">Category Boundary</div>
            <div style="font-size: 1.0rem; color: #1565c0;">
                <span style="font-weight: bold;">${category.name}</span> officially begins at: 
                <span style="font-weight: bold;">${category.min_kt} kt</span>, 
                <span style="font-weight: bold;">${(category.min_kt * KN_TO_MPH).toFixed(0)} MPH</span>, or 
                <span style="font-weight: bold;">${(category.min_kt * KN_TO_KMH).toFixed(0)} km/h</span>.
            </div>
        `;
        resultsList.appendChild(descriptionItem);
    }
    
    /**
     * Renders a single result item (Conversion Breakdown).
     * @param {string} name - The label for the result.
     * @param {number} value - The numerical value.
     * @param {string} unit - The unit string.
     * @param {boolean} isMainResult - Not used here, but kept for template consistency.
     * @param {string} valueColor - Color for the value text.
     * @param {string} backgroundColor - Background color for the value box.
     */
    function renderResult(name, value, unit, isMainResult, valueColor, backgroundColor) {
        const item = document.createElement('div');
        item.classList.add('list-group-item');
        
        // Use a fixed color for conversion boxes
        let valueDisplayColor = '#1565c0';
        let unitDisplayColor = '#0d47a1';
        let nameColor = '#455a64';

        item.style.borderLeftColor = '#1565c0'; // Secondary blue

        item.innerHTML = `
            <div class="unit-name" style="color: ${nameColor};">${name}</div>
            <div class="unit-value" style="background-color: ${backgroundColor}; color: ${valueDisplayColor};">
                ${value.toFixed(2)} <span style="font-size: 0.7em; font-weight: normal; color: ${unitDisplayColor};">${unit}</span>
            </div>
        `;
        resultsList.appendChild(item);
    }
    
    // --- Initialization & Event Listeners ---
    
    function setupListeners() {
        // Attach listeners to all inputs that change the result
        document.querySelectorAll('#windSpeedValue, #windSpeedUnit').forEach(input => {
            input.addEventListener('input', calculateCategory);
            input.addEventListener('change', calculateCategory);
        });
        
        calculateCategory(); // Initial calculation
    }

    window.onload = function() {
        setupListeners();
    };

</script>
{% endblock %}