{% extends "base.html" %}

{% block title %}Mulch and Soil Calculator | Cubic Yard & Bag Estimate{% endblock %}

{% block meta_description %}Quickly calculate how many cubic yards of mulch or soil you need for your garden beds. Supports bulk and bag estimates.{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
<style>
    :root {
        --garden-green: #198754;
        --soil-brown: #5d4037;
        --bg-soft: #f4f9f6;
    }

    body { background-color: #f8fbf9; }

    .calc-card {
        border: none;
        border-radius: 1.25rem;
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.05);
        overflow: hidden;
    }

    .card-header-garden {
        background: linear-gradient(135deg, var(--garden-green) 0%, #146c43 100%);
        color: white;
        padding: 2rem 1.5rem;
    }

    .input-group-text {
        background-color: #f1f8f4;
        border-right: none;
        color: var(--garden-green);
        font-weight: 600;
        min-width: 85px;
        justify-content: center;
    }

    .form-control {
        border-left: none;
    }

    .form-control:focus {
        border-color: #dee2e6;
        box-shadow: none;
    }

    .tip-card {
        background-color: #fff;
        border-left: 4px solid var(--garden-green);
        font-size: 0.9rem;
    }

    /* Results Styling */
    .result-hero {
        background: var(--bg-soft);
        border: 2px solid #e1eee7;
        border-radius: 1rem;
    }

    .yard-value {
        font-size: 3rem;
        font-weight: 800;
        color: var(--garden-green);
        line-height: 1;
    }

    .conversion-badge {
        background-color: white;
        border: 1px solid #dee2e6;
        border-radius: 0.5rem;
        padding: 0.75rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-7">
            
            <div class="card calc-card">
                <div class="card-header-garden text-center">
                    <h1 class="h2 mb-2"><i class="bi bi-tree-fill me-2"></i>Mulch & Soil Calculator</h1>
                    <p class="mb-0 opacity-75">Precision estimates for garden beds and landscaping projects</p>
                </div>

                <div class="card-body p-4 p-md-5 bg-white">
                    
                    <div class="text-center mb-4">
                        
                    </div>

                    <form id="mulch-form">
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small">BED LENGTH</label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">Length</span>
                                    <input type="number" name="length" class="form-control" placeholder="0.0" step="0.1" required>
                                    <span class="input-group-text bg-white border-start-0 text-muted fw-normal">ft</span>
                                </div>
                            </div>

                            <div class="col-md-6">
                                <label class="form-label fw-bold text-muted small">BED WIDTH</label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">Width</span>
                                    <input type="number" name="width" class="form-control" placeholder="0.0" step="0.1" required>
                                    <span class="input-group-text bg-white border-start-0 text-muted fw-normal">ft</span>
                                </div>
                            </div>

                            <div class="col-12">
                                <label class="form-label fw-bold text-muted small">COVERAGE DEPTH</label>
                                <div class="input-group input-group-lg shadow-sm">
                                    <span class="input-group-text bg-success text-white"><i class="bi bi-layers"></i></span>
                                    <input type="number" name="depth" class="form-control" placeholder="Usually 2 to 4" step="0.1" required>
                                    <span class="input-group-text">inches</span>
                                </div>
                                <div class="form-text mt-2 ms-1">
                                    <i class="bi bi-info-circle me-1"></i> Mulch is typically spread **3 inches** deep.
                                </div>
                            </div>

                            <div class="col-12 pt-3">
                                <button type="submit" class="btn btn-success btn-lg w-100 py-3 fw-bold shadow-sm">
                                    Calculate Volume <i class="bi bi-calculator ms-2"></i>
                                </button>
                            </div>
                        </div>
                    </form>

                    <div id="results-container" class="d-none mt-5 animate__animated animate__fadeIn">
                        <div class="result-hero p-4 text-center mb-4">
                            <span class="text-uppercase fw-bold text-muted small d-block mb-2">Total Bulk Volume</span>
                            <div class="yard-value" id="out-yards">0.000</div>
                            <div class="h4 fw-bold text-success mb-0">Cubic Yards</div>
                        </div>

                        <div class="row g-3">
                            <div class="col-md-6">
                                <div class="conversion-badge text-center">
                                    <div class="small text-muted text-uppercase fw-bold">Cubic Feet</div>
                                    <div class="h5 mb-0 mt-1" id="out-feet">0.00</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="conversion-badge text-center">
                                    <div class="small text-muted text-uppercase fw-bold">2 cu. ft. Bags</div>
                                    <div class="h5 mb-0 mt-1" id="out-bags">0</div>
                                </div>
                            </div>
                        </div>

                        <div class="tip-card p-3 mt-4">
                            <div class="d-flex">
                                <i class="bi bi-lightbulb-fill text-warning fs-4 me-3"></i>
                                <div>
                                    <strong>Ordering Tip:</strong> For bulk deliveries, most suppliers have a 1 or 2 cubic yard minimum. For smaller projects, buying bags may be more cost-effective.
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="error-alert" class="alert alert-light border-danger text-danger mt-4 d-none" role="alert">
                        <i class="bi bi-exclamation-triangle-fill me-2"></i>
                        Please enter positive measurements for all fields.
                    </div>

                </div>
            </div>

            <div class="mt-4 text-center">
                <p class="text-muted small">Volume Calculation Formula: $V = (Length \times Width \times (Depth / 12)) / 27$</p>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('mulch-form').addEventListener('submit', function (e) {
        e.preventDefault();
        
        const form = e.target;
        const L = parseFloat(form.elements.length.value);
        const W = parseFloat(form.elements.width.value);
        const Din = parseFloat(form.elements.depth.value);
        
        const resBox = document.getElementById('results-container');
        const errBox = document.getElementById('error-alert');

        if (L > 0 && W > 0 && Din > 0) {
            // Logic
            const Dft = Din / 12;
            const cuFt = L * W * Dft;
            const cuYd = cuFt / 27;
            const bags = Math.ceil(cuFt / 2); // Assuming standard 2 cu ft mulch bags

            // Update UI
            document.getElementById('out-yards').innerText = cuYd.toFixed(2);
            document.getElementById('out-feet').innerText = cuFt.toFixed(2) + " ftÂ³";
            document.getElementById('out-bags').innerText = bags + " Bags";

            resBox.classList.remove('d-none');
            errBox.classList.add('d-none');
            
            // Smooth Scroll
            resBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        } else {
            resBox.classList.add('d-none');
            errBox.classList.remove('d-none');
        }
    });
</script>
{% endblock %}