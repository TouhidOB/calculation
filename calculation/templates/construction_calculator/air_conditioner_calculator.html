{% extends "base.html" %}

{% block title %}Air Conditioner BTU Calculator{% endblock %}

{% block meta_description %}Estimate the required BTU capacity for an air conditioner based on room size, sun exposure, number of occupants, and insulation quality. {% endblock %}

{% block meta_keywords %}BTU calculator, air conditioner sizing, AC capacity, cooling load, room size BTU, HVAC estimate{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        max-width: 700px;
        margin: 0 auto;
    }

    .section-title {
        font-weight: 700;
        margin-top: 25px;
        color: #03A9F4; /* Light Blue for HVAC/Cooling */
        border-bottom: 2px solid #03A9F4;
        padding-bottom: 5px;
        margin-bottom: 15px;
    }
    
    .result-alert {
        font-size: 1.2rem;
        font-weight: 500;
        border-left: 5px solid #FF9800; /* Orange for key result */
    }

    .input-group-text {
        min-width: 120px;
        justify-content: center;
        background-color: #e1f5fe;
        font-weight: 600;
        color: #03A9F4;
    }

    .info-box {
        background-color: #f0f7fb; /* Very light blue info box */
        border: 1px solid #03A9F4;
        border-radius: 5px;
        padding: 10px;
        margin-top: 15px;
        font-size: 0.85rem;
    }

    .result-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #03A9F4;
    }

    .btu-recommendation {
        font-size: 2.2rem;
        font-weight: 800;
        color: #FF9800;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-4 text-center">❄️ Air Conditioner BTU Calculator</h1>
    <p class="text-center small-muted">Estimate the required BTU capacity for efficient room cooling.</p>
    

    <div class="calc-wrapper">

        <form id="btu-calculator-form">
            <h5 class="section-title">1. Room Size and Base Calculation</h5>

            <!-- Length Input (Feet) -->
            <label for="length-input" class="form-label">Room Length</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Length (L)</span>
                <input type="number" id="length-input" class="form-control" name="roomLength" placeholder="e.g., 15" value="15" min="5" step="1" required>
                <span class="input-group-text">ft</span>
            </div>
            
            <!-- Width Input (Feet) -->
            <label for="width-input" class="form-label">Room Width</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Width (W)</span>
                <input type="number" id="width-input" class="form-control" name="roomWidth" placeholder="e.g., 12" value="12" min="5" step="1" required>
                <span class="input-group-text">ft</span>
            </div>

            <h5 class="section-title">2. Environmental Factors</h5>
            
            <!-- Sun Exposure -->
            <label for="sun-exposure-select" class="form-label">Sun Exposure/Shade</label>
            <select class="form-select mb-3" id="sun-exposure-select" name="sunExposureFactor">
                <option value="1.0" selected>Moderate (Standard windows, some shade)</option>
                <option value="1.1">Heavy Sun (Unshaded south or west facing windows)</option>
                <option value="0.9">Heavy Shade (North facing, heavily shaded)</option>
            </select>

            <!-- Insulation Quality -->
            <label for="insulation-select" class="form-label">Insulation Quality / Climate</label>
            <select class="form-select mb-3" id="insulation-select" name="insulationFactor">
                <option value="1.0" selected>Average (Standard walls and ceiling)</option>
                <option value="1.15">Poor (Poorly insulated, high ceilings, hot climate)</option>
                <option value="0.9">Excellent (Modern insulation, cool climate)</option>
            </select>
            
            <!-- Occupants -->
            <label for="occupants-input" class="form-label">Number of People Regularly in Room</label>
            <div class="input-group mb-3">
                <span class="input-group-text">People</span>
                <input type="number" id="occupants-input" class="form-control" name="occupants" placeholder="e.g., 2" value="2" min="1" step="1" required>
            </div>

            <div class="info-box">
                **BTU Rule of Thumb:** The calculation starts with a base of 20 BTU per square foot (a standard estimate) and adjusts this based on environmental factors and heat generated by people.
            </div>

            <button class="btn btn-dark btn-lg w-100 mt-4" style="background-color: #03A9F4; border-color: #03A9F4;" type="submit">Calculate Required BTU</button>
        </form>

        <div class="alert mt-4 d-none result-alert alert-info" id="btu-result"></div>

        <h5 class="section-title d-none" id="table-title">BTU Calculation Breakdown</h5>
        <table class="table table-bordered mt-2 d-none" id="btu-table">
            <thead>
                <tr class="table-dark" style="background-color: #03A9F4; color: white;">
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="btu-body"></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Constants
    const BASE_BTU_PER_SQFT = 20; // Standard baseline for moderate climate/insulation
    const BTU_PER_PERSON = 400; // Heat load contribution per person (approximate)

    // Function to find the nearest standard BTU size (rounding up to common commercial sizes)
    function getStandardBTU(requiredBTU) {
        // Common residential/light commercial AC sizes
        const standardSizes = [5000, 6000, 8000, 10000, 12000, 14000, 18000, 24000, 30000, 36000];
        
        for (let size of standardSizes) {
            if (requiredBTU <= size) {
                return size;
            }
        }
        return standardSizes[standardSizes.length - 1]; // Return largest standard if required BTU is very high
    }

    // Function to display errors or results
    function displayResult(isError, message, metrics) {
        const res = document.getElementById('btu-result');
        const table = document.getElementById('btu-table');
        const tableTitle = document.getElementById('table-title');
        const tableBody = document.getElementById('btu-body');

        // Hide and reset classes
        res.classList.remove('d-none', 'alert-warning', 'alert-danger');
        table.classList.add('d-none');
        tableTitle.classList.add('d-none');
        tableBody.innerHTML = '';

        if (isError) {
            res.classList.add('alert-danger');
            res.innerHTML = `**Calculation Error:** ${message}`;
        } else {
            res.classList.add('alert-info');
            
            // Primary result: Calculated BTU and Recommended Unit
            res.innerHTML = `
**Required BTU Capacity (Calculated):**
<div class="d-flex justify-content-around align-items-center mt-3">
    <div class="text-center">
        <span class="result-value">${Math.round(metrics.requiredBTU)}</span><br>
        <span class="small text-muted">Estimated BTU/hr</span>
    </div>
    <div class="text-center">
        <span class="btu-recommendation">${metrics.recommendedBTU} BTU</span><br>
        <span class="small text-muted">Recommended Standard Size</span>
    </div>
</div>
`;
            
            // Populate and show the detailed table
            let tableRows = `
            <tr><td>**Recommended Standard BTU Unit**</td><td>**${metrics.recommendedBTU}**</td></tr>
            <tr><td>Required BTU (Unrounded Estimate)</td><td>${metrics.requiredBTU.toFixed(0)}</td></tr>
            <tr><td>Total Square Footage (Area)</td><td>${metrics.area.toFixed(0)} sq ft</td></tr>
            <tr><td colspan="2" class="text-center table-active">**Load Breakdown**</td></tr>
            <tr><td>Base Cooling Load (${BASE_BTU_PER_SQFT} BTU/sq ft)</td><td>${metrics.baseBTULoad.toFixed(0)} BTU</td></tr>
            <tr><td>Heat Load from People (${BTU_PER_PERSON} BTU/person)</td><td>${metrics.peopleBTULoad.toFixed(0)} BTU</td></tr>
            <tr><td>Multiplier (Sun/Insulation) Applied</td><td>${metrics.totalMultiplier.toFixed(2)}</td></tr>
            `;
            
            tableBody.innerHTML = tableRows;
            table.classList.remove('d-none');
            tableTitle.classList.remove('d-none');
        }
    }

    // Main Calculation Logic
    document.getElementById('btu-calculator-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const form = e.target;
        
        // Input values
        const roomLength = parseFloat(form.elements.roomLength.value);
        const roomWidth = parseFloat(form.elements.roomWidth.value);
        const sunExposureFactor = parseFloat(form.elements.sunExposureFactor.value);
        const insulationFactor = parseFloat(form.elements.insulationFactor.value);
        const occupants = parseInt(form.elements.occupants.value, 10);
        
        // Basic validation
        if (isNaN(roomLength) || roomLength <= 0 || isNaN(roomWidth) || roomWidth <= 0 || 
            isNaN(occupants) || occupants < 1) 
        {
            displayResult(true, "Please ensure Length, Width, and Occupants are valid positive numbers.");
            return;
        }

        try {
            // --- 1. Calculate Area ---
            const area = roomLength * roomWidth;

            // --- 2. Calculate Base Cooling Load ---
            // Base BTU load based on area (standard rule of thumb)
            const baseBTULoad = area * BASE_BTU_PER_SQFT;

            // --- 3. Calculate People Heat Load ---
            // Additional heat load from occupants
            const peopleBTULoad = occupants * BTU_PER_PERSON;

            // --- 4. Apply Environmental Multiplier ---
            // Combine sun exposure and insulation factors
            const totalMultiplier = sunExposureFactor * insulationFactor;

            // Apply multiplier to the structural heat load (base)
            // People load is generally considered independent of wall/window factors
            const adjustedBaseLoad = baseBTULoad * totalMultiplier;

            // --- 5. Calculate Total Required BTU ---
            const requiredBTU = adjustedBaseLoad + peopleBTULoad;
            
            if (requiredBTU <= 0) {
                displayResult(true, "Calculated BTU requirement is zero or negative. Check inputs.");
                return;
            }

            // --- 6. Find Recommended Standard BTU ---
            const recommendedBTU = getStandardBTU(requiredBTU);

            // 7. Display results
            const metrics = {
                roomLength,
                roomWidth,
                area,
                sunExposureFactor,
                insulationFactor,
                occupants,
                baseBTULoad,
                peopleBTULoad,
                totalMultiplier,
                requiredBTU,
                recommendedBTU
            };
            displayResult(false, "", metrics);

        } catch (error) {
            console.error("Calculation Error:", error);
            displayResult(true, "An unexpected error occurred during the calculation.");
        }
    });

    // Run once on load to ensure initial hidden state
    window.onload = function() {
        document.getElementById('btu-result').classList.add('d-none');
        document.getElementById('btu-table').classList.add('d-none');
        document.getElementById('table-title').classList.add('d-none');
    };
</script>
{% endblock %}

