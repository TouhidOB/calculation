{% extends "base.html" %}

{% block title %}Topsoil and Mulch Volume Calculator{% endblock %}

{% block meta_description %}Calculate the required volume (cubic yards/feet) and weight (tons) for topsoil, compost, or mulch based on coverage area, depth, and material density. {% endblock %}

{% block meta_keywords %}topsoil calculator, mulch volume, compost estimate, cubic yard, cubic foot, tons, material weight, density, gardening estimate, landscaping{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        max-width: 700px;
        margin: 0 auto;
    }

    .section-title {
        font-weight: 700;
        margin-top: 25px;
        color: #795548; /* Earth Tone for Soil */
        border-bottom: 2px solid #795548;
        padding-bottom: 5px;
        margin-bottom: 15px;
    }
    
    .result-alert {
        font-size: 1.2rem;
        font-weight: 500;
        border-left: 5px solid #FFC107; /* Gold/Amber for final result contrast */
    }

    .input-group-text {
        min-width: 120px;
        justify-content: center;
        background-color: #f7f7f7;
        font-weight: 600;
    }

    .unit-input-label {
        font-size: 0.85rem;
        font-style: italic;
        color: #6c757d;
        margin-top: -10px;
        margin-bottom: 15px;
        display: block;
    }

    .density-info {
        background-color: #f5efe8; /* Light earth tone info box */
        border: 1px solid #795548;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 15px;
        font-size: 0.85rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-4 text-center">ðŸŒ± Topsoil & Mulch Volume Calculator</h1>
    <p class="text-center small-muted">Determine the volume and weight of topsoil or other loose materials needed for a specific area.</p>
    

    <div class="calc-wrapper">

        <form id="topsoil-form">
            <h5 class="section-title">1. Coverage Dimensions</h5>

            <!-- Area Length Input (Feet) -->
            <label for="area-length-input" class="form-label">Area Length</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Length</span>
                <input type="number" id="area-length-input" class="form-control" name="areaLength" placeholder="Length (e.g., 30)" min="0.1" step="0.1" required>
                <span class="input-group-text">ft</span>
            </div>
            
            <!-- Area Width Input (Feet) -->
            <label for="area-width-input" class="form-label">Area Width</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Width</span>
                <input type="number" id="area-width-input" class="form-control" name="areaWidth" placeholder="Width (e.g., 15)" min="0.1" step="0.1" required>
                <span class="input-group-text">ft</span>
            </div>
            
            <!-- Depth Input (Inches) -->
            <label for="depth-input" class="form-label">Required Depth</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Depth</span>
                <input type="number" id="depth-input" class="form-control" name="depthInches" placeholder="Depth (e.g., 6)" value="6" min="0.1" step="0.1" required>
                <span class="input-group-text">in</span>
            </div>
            
            <h5 class="section-title">2. Material Density (for Weight)</h5>

            <!-- Material Density Input (lb/cu ft) -->
            <label for="density-input" class="form-label">Material Density</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Density</span>
                <input type="number" id="density-input" class="form-control" name="density" placeholder="e.g., 80" value="80" min="1" step="1" required>
                <span class="input-group-text">lb/cu ft</span>
            </div>
            <div class="density-info">
                **Typical Densities (lb/cu ft):** Dry Topsoil (~80), Damp Topsoil (~100), Mulch (~40), Compost (~60).
            </div>
            
            <h5 class="section-title">3. Waste Allowance</h5>

            <!-- Waste Percentage Input -->
            <label for="waste-input" class="form-label">Waste/Compaction Allowance</label>
            <div class="input-group mb-3">
                <span class="input-group-text">Waste Factor</span>
                <input type="number" id="waste-input" class="form-control" name="wastePercent" placeholder="Standard is 5-10" value="10" min="0" max="25" step="1" required>
                <span class="input-group-text">%</span>
            </div>

            <button class="btn btn-primary btn-lg w-100 mt-4" style="background-color: #795548; border-color: #795548;" type="submit">Calculate Soil Needs</button>
        </form>

        <div class="alert mt-4 d-none result-alert alert-warning" id="topsoil-result"></div>

        <h5 class="section-title d-none" id="table-title">Calculation Summary</h5>
        <table class="table table-bordered mt-2 d-none" id="topsoil-table">
            <thead>
                <tr class="table-dark" style="background-color: #795548; color: white;">
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="topsoil-body"></tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Constants
    const INCHES_PER_FOOT = 12;
    const CU_FT_PER_CU_YD = 27;
    const LBS_PER_TON = 2000;

    // Function to display errors or results
    function displayResult(isError, message, metrics) {
        const res = document.getElementById('topsoil-result');
        const table = document.getElementById('topsoil-table');
        const tableTitle = document.getElementById('table-title');
        const tableBody = document.getElementById('topsoil-body');

        // Hide and reset classes
        res.classList.remove('d-none', 'alert-warning', 'alert-danger');
        table.classList.add('d-none');
        tableTitle.classList.add('d-none');
        tableBody.innerHTML = '';

        if (isError) {
            res.classList.add('alert-danger');
            res.innerHTML = `**Calculation Error:** ${message}`;
        } else {
            res.classList.add('alert-warning');
            
            // Primary result: Volume (Cu Yds) and Weight (Tons)
            res.innerHTML = `
**Total Material to Order (with Waste Factor):**
<div class="d-flex justify-content-around mt-3">
    <div class="text-center">
        <span style="font-size:2rem; color:#795548; font-weight:bold;">${metrics.finalCuYd.toFixed(2)}</span><br>
        <span class="small text-muted">Cubic Yards (CY)</span>
    </div>
    <div class="text-center">
        <span style="font-size:2rem; color:#795548; font-weight:bold;">${metrics.finalTons.toFixed(2)}</span><br>
        <span class="small text-muted">Tons</span>
    </div>
</div>
<p class="text-center mt-3 mb-0">Total volume is **${metrics.finalCuFt.toFixed(2)} cu ft**.</p>
`;
            
            // Populate and show the detailed table
            let tableRows = `
            <tr><td>Total Cubic Yards (CY)</td><td>**${metrics.finalCuYd.toFixed(3)} CY**</td></tr>
            <tr><td>Total Cubic Feet (CF)</td><td>${metrics.finalCuFt.toFixed(3)} CF</td></tr>
            <tr><td>Total Weight (Tons)</td><td>**${metrics.finalTons.toFixed(3)} Tons**</td></tr>
            <tr><td>Total Weight (Lbs)</td><td>${metrics.finalLbs.toFixed(0)} lbs</td></tr>
            <tr><td>Coverage Area</td><td>${metrics.areaSqFt.toFixed(2)} sq ft</td></tr>
            <tr><td>Depth Used</td><td>${metrics.depthFt.toFixed(3)} ft</td></tr>
            <tr><td>Material Density</td><td>${metrics.density.toFixed(0)} lb/cu ft</td></tr>
            <tr><td>Waste/Compaction Applied</td><td>${(metrics.wasteFactorUsed * 100).toFixed(1)}%</td></tr>
            `;
            
            tableBody.innerHTML = tableRows;
            table.classList.remove('d-none');
            tableTitle.classList.remove('d-none');
        }
    }

    // Main Calculation Logic
    document.getElementById('topsoil-form').addEventListener('submit', function (e) {
        e.preventDefault();

        const form = e.target;
        
        // Input values
        const areaLength = parseFloat(form.elements.areaLength.value); // ft
        const areaWidth = parseFloat(form.elements.areaWidth.value); // ft
        const depthInches = parseFloat(form.elements.depthInches.value); // in
        const density = parseFloat(form.elements.density.value); // lb/cu ft
        const wastePercent = parseFloat(form.elements.wastePercent.value); // %
        
        // Basic validation
        if (isNaN(areaLength) || areaLength <= 0 || isNaN(areaWidth) || areaWidth <= 0 || isNaN(depthInches) || depthInches <= 0 || isNaN(density) || density <= 0 || isNaN(wastePercent) || wastePercent < 0) {
            displayResult(true, "Please ensure all dimensions, density, and waste factor are valid positive numbers.");
            return;
        }

        try {
            // 1. Calculate Area and Depth in Feet
            const areaSqFt = areaLength * areaWidth; // sq ft
            const depthFt = depthInches / INCHES_PER_FOOT; // ft

            // 2. Calculate Volume (No Waste)
            const volumeCuFtNoWaste = areaSqFt * depthFt; // cu ft
            
            // 3. Apply Waste Factor
            // For soil, waste factor often accounts for compaction and settling
            const wasteFactor = 1 + (wastePercent / 100);
            
            // Final Volume
            const finalCuFt = volumeCuFtNoWaste * wasteFactor; // cu ft
            const finalCuYd = finalCuFt / CU_FT_PER_CU_YD; // cu yd

            // 4. Calculate Weight
            const finalLbs = finalCuFt * density; // lbs
            const finalTons = finalLbs / LBS_PER_TON; // tons

            
            // 5. Display results
            const metrics = {
                areaSqFt,
                depthFt,
                density,
                finalCuFt,
                finalCuYd,
                finalLbs,
                finalTons,
                wasteFactorUsed: wasteFactor - 1
            };
            displayResult(false, "", metrics);

        } catch (error) {
            console.error("Calculation Error:", error);
            displayResult(true, "An unexpected error occurred during the calculation.");
        }
    });

    // Run once on load to ensure initial hidden state
    window.onload = function() {
        document.getElementById('topsoil-result').classList.add('d-none');
        document.getElementById('topsoil-table').classList.add('d-none');
        document.getElementById('table-title').classList.add('d-none');
    };
</script>
{% endblock %}

