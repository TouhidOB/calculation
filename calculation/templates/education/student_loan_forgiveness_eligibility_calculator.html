{% extends "base.html" %}

{% block title %}Student Loan Forgiveness Eligibility Calculator{% endblock %}

{% block meta_description %}Determine your eligibility for federal student loan forgiveness programs like PSLF and IDR based on loan type, employment, and repayment history.{% endblock %}

{% block meta_keywords %}PSLF eligibility, IDR forgiveness, student loan calculator, public service loan forgiveness, income driven repayment, loan payoff timeline{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    .calc-wrapper {
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid #dee2e6;
    }

    .criteria-section {
        background-color: #f8f9fa;
        border: 1px solid #e9ecef;
        border-radius: 12px;
        padding: 25px;
        height: 100%;
    }

    .section-title {
        font-size: 0.9rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #0d6efd;
        margin-bottom: 20px;
        border-bottom: 2px solid #0d6efd;
        display: inline-block;
    }

    .result-display-area {
        background-color: #ffffff;
        border: 2px dashed #dee2e6;
        border-radius: 15px;
        padding: 40px 25px;
        text-align: center;
        min-height: 400px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        transition: all 0.3s ease;
    }

    .result-status {
        font-size: 1.75rem;
        font-weight: 800;
        margin-bottom: 15px;
        line-height: 1.2;
    }

    /* Custom range slider styling for professional look */
    .form-range::-webkit-slider-thumb { background: #0d6efd; }
    .form-range::-moz-range-thumb { background: #0d6efd; }

    .eligible-border { border: 4px solid #198754 !important; background-color: #f0fff4 !important; }
    .partial-border { border: 4px solid #ffc107 !important; background-color: #fffbeb !important; }
    .ineligible-border { border: 4px solid #dc3545 !important; background-color: #fff5f5 !important; }

    .timeline-stat {
        background: rgba(255,255,255,0.6);
        border-radius: 8px;
        padding: 15px;
        border: 1px solid rgba(0,0,0,0.05);
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-dark">âœ… Loan Forgiveness Eligibility Calculator</h1>
        <p class="text-muted mx-auto" style="max-width: 700px;">
            Navigate the complexities of federal student loan forgiveness. Find your primary path toward a zero balance for PSLF or IDR programs.
        </p>
    </div>

    

    <div class="calc-wrapper mx-auto" style="max-width: 1100px;">
        <div class="row g-4">
            
            <div class="col-lg-6">
                <div class="criteria-section">
                    <div class="section-title">1. Loan & Plan Details</div>
                    <div class="mb-3">
                        <label class="form-label fw-bold small">Federal Loan Type</label>
                        <select id="loan-type" class="form-select form-select-lg" onchange="calculateEligibility()">
                            <option value="" selected disabled>Select your loan type...</option>
                            <option value="direct">Direct Loans (Standard)</option>
                            <option value="ffel-perkins">FFEL or Perkins Loans</option>
                            <option value="private">Private Student Loans</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold small">Active Repayment Plan</label>
                        <select id="repayment-plan" class="form-select" onchange="calculateEligibility()">
                            <option value="idr">Income-Driven (SAVE, PAYE, IBR)</option>
                            <option value="standard">10-Year Standard Plan</option>
                            <option value="extended">Extended or Graduated Plan</option>
                        </select>
                    </div>

                    <div class="section-title mt-2">2. PSLF Criteria (Employment)</div>
                    <div class="mb-4">
                        <label class="form-label fw-bold small">Current Employer Type</label>
                        <select id="qualifying-employment" class="form-select" onchange="calculateEligibility()">
                            <option value="no">For-Profit Company / Self-Employed</option>
                            <option value="yes">Government or 501(c)(3) Non-Profit</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <label class="form-label fw-bold small d-flex justify-content-between">
                            Monthly Payments Completed 
                            <span class="text-primary" id="pslf-payments-display">0</span>
                        </label>
                        <input type="range" id="payments-made-pslf" class="form-range" min="0" max="120" step="1" value="0" oninput="calculateEligibility()">
                        <div class="d-flex justify-content-between helper-text small text-muted">
                            <span>0</span>
                            <span>PSLF Goal: 120</span>
                        </div>
                    </div>

                    <div class="section-title mt-2">3. IDR History</div>
                    <div class="mb-0">
                        <label class="form-label fw-bold small d-flex justify-content-between">
                            Total Years in Repayment
                            <span class="text-primary" id="idr-years-display">0</span>
                        </label>
                        <input type="range" id="years-completed-idr" class="form-range" min="0" max="25" step="1" value="0" oninput="calculateEligibility()">
                        <div class="d-flex justify-content-between helper-text small text-muted">
                            <span>0 Years</span>
                            <span>Max: 25 Years</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-6">
                <div id="result-box" class="result-display-area">
                    <div id="empty-state">
                        <i class="bi bi-shield-lock fs-1 text-muted mb-3 d-block"></i>
                        <h4 class="fw-bold text-muted">Awaiting Loan Data</h4>
                        <p class="text-muted small px-4">Please select your loan type to begin the eligibility assessment.</p>
                    </div>

                    <div id="calculation-state" style="display: none;">
                        <div class="result-status" id="forgiveness-status">Checking...</div>
                        <div class="badge bg-dark text-uppercase mb-4 px-3 py-2">Primary Recommendation</div>
                        
                        <div id="timeline-details" class="text-start mb-4">
                            </div>

                        <div id="result-message" class="alert alert-light border small text-dark mb-0">
                            </div>
                    </div>
                </div>
                
                <div class="mt-4 p-3 border rounded shadow-sm bg-white">
                    <h6 class="fw-bold"><i class="bi bi-info-circle me-2 text-primary"></i>Important Note</h6>
                    <p class="small text-muted mb-0">This tool provides estimates based on current Department of Education guidelines. Always verify counts with your loan servicer (e.g., MOHELA, Nelnet).</p>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const loanTypeEl = document.getElementById('loan-type');
    const repaymentPlanEl = document.getElementById('repayment-plan');
    const employmentEl = document.getElementById('qualifying-employment');
    const pslfSlider = document.getElementById('payments-made-pslf');
    const idrSlider = document.getElementById('years-completed-idr');

    const emptyState = document.getElementById('empty-state');
    const calcState = document.getElementById('calculation-state');
    const resultBox = document.getElementById('result-box');
    const statusText = document.getElementById('forgiveness-status');
    const timelineDetails = document.getElementById('timeline-details');
    const resultMsg = document.getElementById('result-message');

    function calculateEligibility() {
        const loan = loanTypeEl.value;
        if (!loan) return;

        // Sync displays
        document.getElementById('pslf-payments-display').textContent = pslfSlider.value;
        document.getElementById('idr-years-display').textContent = idrSlider.value;

        emptyState.style.display = 'none';
        calcState.style.display = 'block';

        const pslfMade = parseInt(pslfSlider.value);
        const idrYears = parseInt(idrSlider.value);
        const onIdr = repaymentPlanEl.value === 'idr';
        const inPublic = employmentEl.value === 'yes';

        // 1. Private Loan Logic
        if (loan === 'private') {
            showResult('ineligible', 'INELIGIBLE: PRIVATE LOANS', 
                `<div class="timeline-stat text-danger fw-bold">No Federal Path Available</div>
                 <p class="mt-2 small">Private student loans are not eligible for federal forgiveness programs like PSLF or IDR.</p>`,
                'Action: Consult your lender for private refinancing or hardship deferment options.');
            return;
        }

        // 2. PSLF Path Logic
        if (loan === 'direct' && inPublic && (onIdr || repaymentPlanEl.value === 'standard')) {
            const rem = 120 - pslfMade;
            if (rem <= 0) {
                showResult('eligible', 'PSLF ELIGIBLE!', 
                    `<div class="timeline-stat text-success"><i class="bi bi-patch-check-fill me-2"></i><strong>120/120 Payments Made</strong></div>`,
                    'Action: Submit your PSLF Forgiveness Application through the StudentAid.gov PSLF Help Tool immediately.');
            } else {
                showResult('partial', 'ON TRACK FOR PSLF', 
                    `<div class="timeline-stat">
                        <div class="d-flex justify-content-between"><span>Remaining:</span> <strong>${rem} Payments</strong></div>
                        <div class="d-flex justify-content-between"><span>Est. Date:</span> <strong>${Math.ceil(rem/12)} Years</strong></div>
                    </div>`,
                    'Keep certifying your employment annually to lock in these payment counts.');
            }
            return;
        }

        // 3. IDR Path Logic
        if (onIdr) {
            const target = 20; // simplified undergraduate target
            const rem = target - idrYears;
            if (rem <= 0) {
                showResult('eligible', 'IDR FORGIVENESS READY', 
                    `<div class="timeline-stat text-success"><strong>${idrYears}+ Years Completed</strong></div>`,
                    'Contact your servicer to verify your IDR account adjustment count.');
            } else {
                showResult('partial', 'IDR FORGIVENESS PATH', 
                    `<div class="timeline-stat">
                        <div class="d-flex justify-content-between"><span>Years Remaining:</span> <strong>${rem} Years</strong></div>
                    </div>`,
                    'Ensure you recertify your income every year to remain on this path.');
            }
            return;
        }

        // 4. Default / Consolidation Guidance
        if (loan === 'ffel-perkins') {
            showResult('ineligible', 'CONSOLIDATION REQUIRED', 
                `<p class="small">Your FFEL/Perkins loans are federal, but they must be converted to a <strong>Direct Consolidation Loan</strong> to qualify.</p>`,
                'Action: Visit StudentAid.gov to consolidate your loans into the Direct Loan program.');
        } else {
            showResult('ineligible', 'NO ACTIVE PATH', 
                `<p class="small">Currently, your plan or employment does not align with federal forgiveness requirements.</p>`,
                'Action: Switch to an Income-Driven Repayment (IDR) plan to begin accruing credit toward eventual forgiveness.');
        }
    }

    function showResult(type, title, html, msg) {
        resultBox.className = `result-display-area ${type}-border`;
        statusText.className = `result-status text-${type === 'partial' ? 'warning' : (type === 'eligible' ? 'success' : 'danger')}`;
        statusText.textContent = title;
        timelineDetails.innerHTML = html;
        resultMsg.textContent = msg;
    }
</script>
{% endblock %}