{% extends "base.html" %}

{% block title %}Thesis Page Count Estimator{% endblock %}

{% block meta_description %}Estimate the total page count and chapter distribution for your thesis or dissertation based on target word count and formatting rules.{% endblock %}

{% block meta_keywords %}thesis word count, dissertation length, academic planning, page estimator, chapter breakdown, writing tool{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    :root {
        --academic-purple: #6d28d9;
        --academic-light: #f5f3ff;
    }

    .planner-wrapper {
        background: white;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
        border: 1px solid #dee2e6;
    }

    .config-sidebar {
        background-color: var(--academic-light);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid #ddd6fe;
    }

    .stat-card {
        background: white;
        border: 1px solid #dee2e6;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        height: 100%;
    }

    .display-value {
        font-size: 3rem;
        font-weight: 800;
        color: var(--academic-purple);
        line-height: 1;
    }

    .chapter-row {
        transition: background-color 0.2s ease;
        border-radius: 8px;
    }

    .chapter-row:hover {
        background-color: #fafafa;
    }

    /* Professional Table Styling */
    .table-breakdown thead th {
        background-color: var(--academic-purple);
        color: white;
        border: none;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .empty-prompt {
        border: 2px dashed #cbd5e1;
        background: #f8fafc;
        border-radius: 12px;
        padding: 50px;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-dark">ðŸ“š Thesis Page Count Estimator</h1>
        <p class="text-muted mx-auto" style="max-width: 700px;">
            Convert your target word count into a structured page-by-page roadmap. Estimate chapter lengths and visualize your entire manuscript's volume.
        </p>
    </div>

    

    <div class="planner-wrapper mx-auto" style="max-width: 1150px;">
        <div class="row g-4">
            
            <div class="col-lg-4">
                <div class="config-sidebar h-100">
                    <h5 class="fw-bold mb-4 text-primary-emphasis"><i class="bi bi-sliders me-2"></i>Parameters</h5>
                    
                    <div class="mb-3">
                        <label class="form-label small fw-bold">Target Word Count (Body)</label>
                        <div class="input-group">
                            <input type="number" id="target-word-count" class="form-control form-control-lg" placeholder="e.g. 25000" oninput="calculatePages()">
                            <span class="input-group-text bg-white text-muted small">words</span>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label small fw-bold">Avg. Words Per Page</label>
                        <select id="words-per-page" class="form-select" onchange="calculatePages()">
                            <option value="250">250 (Double Spaced)</option>
                            <option value="300">300 (1.5 Spacing)</option>
                            <option value="500">500 (Single Spaced)</option>
                            <option value="custom">Custom</option>
                        </select>
                        <input type="number" id="custom-wpp" class="form-control mt-2 d-none" placeholder="Enter words/page" value="250" oninput="calculatePages()">
                    </div>

                    <div class="mb-4">
                        <label class="form-label small fw-bold">Front Matter / Fixed Pages</label>
                        <input type="number" id="fixed-pages" class="form-control" value="10" oninput="calculatePages()">
                        <small class="text-muted">Title, Abstract, Table of Contents, etc.</small>
                    </div>

                    <hr>

                    <h6 class="fw-bold mt-4 mb-3">Chapter Weights (%)</h6>
                    <div id="chapter-list">
                        </div>
                    
                    <button class="btn btn-outline-primary btn-sm w-100 mt-3" onclick="addChapter('New Chapter', 10)">
                        <i class="bi bi-plus-circle me-1"></i> Add Section
                    </button>
                </div>
            </div>

            <div class="col-lg-8">
                <div id="results-area">
                    
                    <div id="empty-state" class="empty-prompt text-center h-100 d-flex flex-column justify-content-center align-items-center">
                        <i class="bi bi-journal-text fs-1 text-muted mb-3"></i>
                        <h4 class="fw-bold text-muted">Awaiting Manuscript Data</h4>
                        <p class="text-muted">Enter your target word count in the sidebar to generate a structural estimate.</p>
                    </div>

                    <div id="calc-content" style="display: none;">
                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="stat-card">
                                    <div class="text-uppercase small fw-bold text-muted mb-2">Estimated Pages</div>
                                    <div class="display-value" id="final-page-count">0</div>
                                    <div class="small text-muted mt-2">Total Project Length</div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="stat-card">
                                    <div class="text-uppercase small fw-bold text-muted mb-2">Average Chapter</div>
                                    <div class="h2 fw-bold text-dark mb-0" id="avg-chapter-pages">0</div>
                                    <div class="small text-muted mt-1">Pages Per Section</div>
                                </div>
                            </div>
                        </div>

                        <div class="card border-0 shadow-sm overflow-hidden">
                            <table class="table table-hover table-breakdown mb-0">
                                <thead>
                                    <tr>
                                        <th class="ps-4">Chapter / Section</th>
                                        <th class="text-center">Weight</th>
                                        <th class="text-center">Pages</th>
                                        <th class="text-end pe-4">Words</th>
                                    </tr>
                                </thead>
                                <tbody id="breakdown-body">
                                    </tbody>
                            </table>
                        </div>
                        
                        <div class="mt-4 p-3 bg-light rounded border-start border-4 border-primary">
                            <p class="small text-muted mb-0">
                                <i class="bi bi-info-circle me-2"></i>
                                <strong>Note:</strong> These are structural estimates. Final page counts will vary based on font choice (Times New Roman vs. Arial), margin sizes, and the number of figures/tables included.
                            </p>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const targetInput = document.getElementById('target-word-count');
    const wppSelect = document.getElementById('words-per-page');
    const customWpp = document.getElementById('custom-wpp');
    const fixedInput = document.getElementById('fixed-pages');
    const chapterList = document.getElementById('chapter-list');
    const breakdownBody = document.getElementById('breakdown-body');

    const emptyState = document.getElementById('empty-state');
    const calcContent = document.getElementById('calc-content');

    const defaultChapters = [
        { name: 'Introduction', percent: 10 },
        { name: 'Literature Review', percent: 25 },
        { name: 'Methodology', percent: 15 },
        { name: 'Data Analysis', percent: 30 },
        { name: 'Discussion & Conclusion', percent: 20 },
    ];

    function addChapter(name, percent) {
        const id = Date.now();
        const div = document.createElement('div');
        div.className = 'mb-2 p-2 bg-white rounded border shadow-sm';
        div.innerHTML = `
            <div class="d-flex align-items-center gap-2">
                <input type="text" class="form-control form-control-sm ch-name" value="${name}" oninput="calculatePages()">
                <div class="input-group input-group-sm w-50">
                    <input type="number" class="form-control ch-percent" value="${percent}" oninput="calculatePages()">
                    <span class="input-group-text">%</span>
                </div>
                <button class="btn btn-sm text-danger" onclick="this.parentElement.parentElement.remove(); calculatePages();">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        `;
        chapterList.appendChild(div);
        calculatePages();
    }

    wppSelect.addEventListener('change', () => {
        customWpp.classList.toggle('d-none', wppSelect.value !== 'custom');
        calculatePages();
    });

    function calculatePages() {
        const targetWords = parseFloat(targetInput.value);
        if (!targetWords || targetWords <= 0) {
            emptyState.style.display = 'flex';
            calcContent.style.display = 'none';
            return;
        }

        emptyState.style.display = 'none';
        calcContent.style.display = 'block';

        let wpp = wppSelect.value === 'custom' ? parseFloat(customWpp.value) : parseFloat(wppSelect.value);
        wpp = wpp || 250;
        const fixed = parseFloat(fixedInput.value) || 0;

        const totalBodyPages = targetWords / wpp;
        const chapters = document.querySelectorAll('#chapter-list > div');
        let totalPercent = 0;
        
        const data = Array.from(chapters).map(ch => {
            const p = parseFloat(ch.querySelector('.ch-percent').value) || 0;
            totalPercent += p;
            return {
                name: ch.querySelector('.ch-name').value || 'Untitled Section',
                percent: p
            };
        });

        let html = '';
        data.forEach(ch => {
            const weight = totalPercent > 0 ? (ch.percent / totalPercent) : 0;
            const pgs = totalBodyPages * weight;
            const words = targetWords * weight;

            html += `
                <tr class="chapter-row">
                    <td class="ps-4 fw-bold">${ch.name}</td>
                    <td class="text-center text-muted">${ch.percent}%</td>
                    <td class="text-center fw-bold text-primary">${pgs.toFixed(1)}</td>
                    <td class="text-end pe-4">${Math.round(words).toLocaleString()}</td>
                </tr>
            `;
        });

        html += `
            <tr class="table-light">
                <td class="ps-4 italic text-muted">Fixed Pages (Front/Back Matter)</td>
                <td class="text-center">-</td>
                <td class="text-center fw-bold">${fixed}</td>
                <td class="text-end pe-4">-</td>
            </tr>
            <tr class="table-primary fw-bold">
                <td class="ps-4">TOTAL MANUSCRIPT</td>
                <td class="text-center">100%</td>
                <td class="text-center">${Math.ceil(totalBodyPages + fixed)}</td>
                <td class="text-end pe-4">${targetWords.toLocaleString()}</td>
            </tr>
        `;

        breakdownBody.innerHTML = html;
        document.getElementById('final-page-count').textContent = Math.ceil(totalBodyPages + fixed);
        document.getElementById('avg-chapter-pages').textContent = (totalBodyPages / (data.length || 1)).toFixed(1);
    }

    window.onload = function() {
        defaultChapters.forEach(ch => addChapter(ch.name, ch.percent));
        // Reset state so it starts empty
        emptyState.style.display = 'flex';
        calcContent.style.display = 'none';
    };
</script>
{% endblock %}