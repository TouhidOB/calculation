{% extends "base.html" %}

{% block title %}Speech and Presentation Length Calculator{% endblock %}

{% block meta_description %}Estimate the duration of your speech or presentation based on your text and custom words-per-minute (WPM) speaking rate. Calculates total word count and time in minutes and seconds.{% endblock %}

{% block meta_keywords %}speech calculator, presentation time, words per minute, speaking rate, speech length, word count to time{% endblock %}

{% block extra_head %}
<style>
    /* Styling for the speech length calculator application */
    .calc-wrapper {
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid #e0e0e0;
    }

    #text-input {
        min-height: 300px;
        font-size: 1.1rem;
        padding: 20px;
        resize: vertical;
        border: 2px solid #f0f2f5;
        border-radius: 8px;
        transition: border-color 0.3s ease;
    }

    #text-input:focus {
        border-color: #6f42c1;
        outline: none;
        box-shadow: 0 0 0 0.25rem rgba(111, 66, 193, 0.1);
    }

    .stat-box {
        background-color: #fcfaff;
        border: 1px solid #e9ecef;
        border-radius: 10px;
        padding: 20px 10px;
        text-align: center;
        transition: all 0.2s ease;
        height: 100%;
    }

    .stat-box:hover {
        border-color: #6f42c1;
        transform: translateY(-2px);
    }

    .stat-label {
        font-size: 0.75rem;
        color: #6c757d;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 8px;
        font-weight: 600;
    }

    .stat-value {
        font-size: 1.8rem;
        font-weight: 800;
        color: #212529;
        line-height: 1.1;
    }
    
    .stat-value.highlight {
        color: #6f42c1; /* Theme Purple */
    }

    .pace-guide {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 15px;
        font-size: 0.9rem;
        border-left: 4px solid #6f42c1;
    }

    .action-btns {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
    }

    @media (max-width: 767px) {
        .stat-value { font-size: 1.4rem; }
        .calc-wrapper { padding: 20px; }
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold">üéôÔ∏è Speech Length Calculator</h1>
        <p class="text-muted mx-auto" style="max-width: 600px;">
            Ensure your presentation fits perfectly within your time slot. Adjust your speaking pace and input your script below.
        </p>
    </div>

    <div class="calc-wrapper mx-auto" style="max-width: 1000px;">

        <div class="row g-4 mb-4">
            <div class="col-lg-6">
                <label class="form-label fw-bold">Set Your Speaking Speed (WPM)</label>
                <div class="input-group input-group-lg shadow-sm">
                    <input 
                        type="number" 
                        class="form-control" 
                        id="wpm-input" 
                        placeholder="150" 
                        min="40" 
                        max="300" 
                        value="150"
                    >
                    <span class="input-group-text bg-white text-muted">Words Per Minute</span>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="pace-guide">
                    <div class="fw-bold mb-1 small text-uppercase text-secondary">Speaking Pace Guide:</div>
                    <ul class="list-unstyled mb-0 small row">
                        <li class="col-6">‚Ä¢ <b>110:</b> Slow/Deliberate</li>
                        <li class="col-6">‚Ä¢ <b>130:</b> Conversational</li>
                        <li class="col-6">‚Ä¢ <b>150:</b> Standard Presentation</li>
                        <li class="col-6">‚Ä¢ <b>170:</b> Fast/Energetic</li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="row g-3 mb-5">
            <div class="col-6 col-md-3">
                <div class="stat-box">
                    <div class="stat-label">Word Count</div>
                    <div class="stat-value" id="word-count">0</div>
                </div>
            </div>

            <div class="col-12 col-md-5">
                <div class="stat-box border-primary border-opacity-25 shadow-sm">
                    <div class="stat-label">Estimated Speech Duration</div>
                    <div class="stat-value highlight" id="reading-time-minutes">0m 0s</div>
                    <p class="small text-muted mb-0">At <span id="current-wpm" class="fw-bold">150</span> WPM pace</p>
                </div>
            </div>

            <div class="col-6 col-md-4">
                <div class="stat-box">
                    <div class="stat-label">Conversational Rate</div>
                    <div class="stat-value text-secondary" id="conversational-time">0m 0s</div>
                    <p class="small text-muted mb-0">Ref. (120 WPM)</p>
                </div>
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0 fw-bold">Speech Script</h5>
            <div class="action-btns">
                <button class="btn btn-sm btn-outline-secondary" id="copy-btn">Copy Text</button>
                <button class="btn btn-sm btn-outline-danger" id="clear-btn">Clear All</button>
            </div>
        </div>
        
        <textarea 
            class="form-control shadow-sm" 
            id="text-input" 
            placeholder="Paste your script here. We recommend including notes like [Pause] or [Slide Change] to help your timing..."
            autofocus
        ></textarea>

        <div class="mt-5">
            
        </div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const CONVERSATIONAL_WPM = 120; 

    const textInput = document.getElementById('text-input');
    const wpmInput = document.getElementById('wpm-input');
    const wordCountEl = document.getElementById('word-count');
    const readingTimeEl = document.getElementById('reading-time-minutes');
    const conversationalTimeEl = document.getElementById('conversational-time');
    const currentWpmDisplay = document.getElementById('current-wpm');
    const clearBtn = document.getElementById('clear-btn');
    const copyBtn = document.getElementById('copy-btn');

    function formatTime(totalSeconds) {
        if (totalSeconds <= 0 || isNaN(totalSeconds)) return '0m 0s';
        const seconds = Math.round(totalSeconds);
        const minutes = Math.floor(seconds / 60);
        const remainingSeconds = seconds % 60;
        return `${minutes}m ${remainingSeconds}s`;
    }

    function getWordCount(text) {
        const trimmed = text.trim();
        if (!trimmed) return 0;
        // Accurate word count split by whitespace
        const words = trimmed.split(/\s+/);
        return words ? words.length : 0;
    }

    function updateTime() {
        const text = textInput.value;
        const userWPM = parseFloat(wpmInput.value) || 150; 
        const wordCount = getWordCount(text);
        
        const safeUserWPM = Math.max(1, userWPM);
        
        // 1. User Pace
        const totalUserSeconds = (wordCount / safeUserWPM) * 60;
        
        // 2. Conversational Pace (120 WPM)
        const totalConversationalSeconds = (wordCount / CONVERSATIONAL_WPM) * 60;
        
        // UI Updates
        wordCountEl.textContent = wordCount.toLocaleString();
        currentWpmDisplay.textContent = safeUserWPM;
        readingTimeEl.textContent = formatTime(totalUserSeconds);
        conversationalTimeEl.textContent = formatTime(totalConversationalSeconds);
    }

    function clearScript() {
        textInput.value = '';
        updateTime();
        textInput.focus();
    }

    function copyScript() {
        if (!textInput.value) return;
        textInput.select();
        document.execCommand('copy');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = 'Copied!';
        setTimeout(() => copyBtn.textContent = originalText, 2000);
    }

    // Event Listeners
    textInput.addEventListener('input', updateTime);
    wpmInput.addEventListener('input', updateTime);
    clearBtn.addEventListener('click', clearScript);
    copyBtn.addEventListener('click', copyScript);

    // Ensure page starts clean
    window.addEventListener('load', () => {
        textInput.value = '';
        updateTime();
    });
</script>
{% endblock %}