{% extends "base.html" %}

{% block title %}Lecture Video Watch Time Calculator{% endblock %}

{% block meta_description %}Calculate the total viewing time for a list of videos at various playback speeds (1.0x, 1.5x, 2.0x).{% endblock %}

{% block meta_keywords %}video duration calculator, lecture time, playback speed, study tool, time management, video acceleration{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    :root {
        --bs-primary-rgb: 139, 92, 246; /* Violet */
    }
    
    body {
        background-color: #f8fafc;
    }
    
    .calc-card {
        background: white;
        border-radius: 1.25rem;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.05);
        border: 1px solid #e2e8f0;
    }

    .speed-badge {
        font-size: 0.8rem;
        font-weight: 800;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .time-display {
        font-size: 2.5rem;
        font-weight: 800;
        letter-spacing: -1px;
        line-height: 1;
    }

    .hero-card {
        border-top: 5px solid #8b5cf6;
    }

    textarea.form-control {
        font-family: 'Courier New', Courier, monospace;
        font-size: 1rem;
        line-height: 1.6;
        border: 2px solid #e2e8f0;
        transition: border-color 0.2s;
    }

    textarea.form-control:focus {
        border-color: #8b5cf6;
        box-shadow: 0 0 0 0.25rem rgba(139, 92, 246, 0.1);
    }

    .empty-state {
        color: #94a3b8;
        padding: 4rem 1rem;
    }

    .recommended-label {
        position: absolute;
        top: -12px;
        left: 50%;
        transform: translateX(-50%);
        background: #8b5cf6;
        color: white;
        padding: 2px 12px;
        border-radius: 20px;
        font-size: 0.7rem;
        font-weight: 700;
        z-index: 10;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-dark"><i class="bi bi-stopwatch-fill text-primary me-2"></i>Watch Time Calculator</h1>
        <p class="text-muted mx-auto" style="max-width: 650px;">
            Optimizing your study schedule? Calculate exactly how long your video playlist will take at different playback speeds.
        </p>
    </div>

    

    <div class="row g-4">
        <div class="col-lg-5">
            <div class="calc-card p-4 h-100">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="fw-bold m-0 text-uppercase small text-secondary">1. Video List</h5>
                    <button class="btn btn-sm btn-outline-secondary" onclick="clearAll()">Clear</button>
                </div>
                
                <textarea id="video-durations" class="form-control mb-3" rows="12" 
                    placeholder="Enter durations (HH:MM:SS)&#10;00:45:00&#10;00:20:15&#10;1:05:00"></textarea>
                
                <div class="alert alert-light border small text-muted p-3">
                    <i class="bi bi-info-circle me-2"></i>
                    Accepts <strong>H:MM:SS</strong> or <strong>MM:SS</strong> formats. Put each video on a new line.
                </div>
            </div>
        </div>

        <div class="col-lg-7">
            <div id="empty-view" class="calc-card h-100 d-flex flex-column align-items-center justify-content-center empty-state text-center">
                <i class="bi bi-play-circle-fill display-1 mb-3 opacity-25"></i>
                <h4 class="fw-bold">Ready to Calculate</h4>
                <p>Paste your video durations on the left to see the optimized watch times.</p>
            </div>

            <div id="results-view" class="d-none h-100">
                <h5 class="fw-bold mb-3 text-uppercase small text-secondary">2. Playback Roadmap</h5>
                
                <div class="row g-3">
                    <div class="col-12">
                        <div class="calc-card p-4 d-flex align-items-center justify-content-between border-start border-4 border-secondary">
                            <div>
                                <span class="speed-badge text-secondary">Original Speed</span>
                                <h3 class="fw-bold m-0">1.0x</h3>
                            </div>
                            <div class="time-display text-dark" id="time-1-0">00:00:00</div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="calc-card p-4 d-flex align-items-center justify-content-between hero-card border border-primary position-relative shadow-sm" style="background: #f5f3ff;">
                            <div class="recommended-label">RECOMMENDED</div>
                            <div>
                                <span class="speed-badge text-primary">Focused Listening</span>
                                <h3 class="fw-bold m-0 text-primary">1.5x</h3>
                            </div>
                            <div class="time-display text-primary" id="time-1-5">00:00:00</div>
                        </div>
                    </div>

                    <div class="col-12">
                        <div class="calc-card p-4 d-flex align-items-center justify-content-between border-start border-4 border-dark" style="background: #fafafa;">
                            <div>
                                <span class="speed-badge text-dark">Maximum Pace</span>
                                <h3 class="fw-bold m-0">2.0x</h3>
                            </div>
                            <div class="time-display text-dark" id="time-2-0">00:00:00</div>
                        </div>
                    </div>
                </div>

                <h5 class="fw-bold mt-4 mb-3 text-uppercase small text-secondary">Alternative Speeds</h5>
                <div class="row g-3" id="additional-speeds">
                    </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const durationInput = document.getElementById('video-durations');
    const emptyView = document.getElementById('empty-view');
    const resultsView = document.getElementById('results-view');
    const additionalSpeeds = [1.25, 1.75, 2.25, 2.5];

    function clearAll() {
        durationInput.value = '';
        calculateWatchTime();
    }

    function durationToSeconds(str) {
        const parts = str.split(':').map(p => parseInt(p.trim()));
        if (parts.some(isNaN)) return null;
        if (parts.length === 3) return parts[0] * 3600 + parts[1] * 60 + parts[2];
        if (parts.length === 2) return parts[0] * 60 + parts[1];
        return null;
    }

    function secondsToDuration(total) {
        if (isNaN(total) || total < 0) return '00:00:00';
        const hours = Math.floor(total / 3600);
        const minutes = Math.floor((total % 3600) / 60);
        const seconds = Math.round(total % 60);
        const pad = (n) => String(n).padStart(2, '0');
        return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    function calculateWatchTime() {
        const val = durationInput.value.trim();
        
        if (!val) {
            emptyView.classList.remove('d-none');
            resultsView.classList.add('d-none');
            return;
        }

        const lines = val.split('\n').filter(s => s.trim().length > 0);
        const secondsList = lines.map(durationToSeconds).filter(s => s !== null && s > 0);

        if (secondsList.length === 0) {
            emptyView.classList.remove('d-none');
            resultsView.classList.add('d-none');
            return;
        }

        emptyView.classList.add('d-none');
        resultsView.classList.remove('d-none');

        const totalSeconds = secondsList.reduce((a, b) => a + b, 0);

        // Update Main Cards
        document.getElementById('time-1-0').textContent = secondsToDuration(totalSeconds / 1.0);
        document.getElementById('time-1-5').textContent = secondsToDuration(totalSeconds / 1.5);
        document.getElementById('time-2-0').textContent = secondsToDuration(totalSeconds / 2.0);

        // Update Grid
        const grid = document.getElementById('additional-speeds');
        grid.innerHTML = '';
        additionalSpeeds.forEach(speed => {
            const col = document.createElement('div');
            col.className = 'col-6 col-md-3';
            col.innerHTML = `
                <div class="calc-card p-3 text-center bg-light shadow-sm border-0">
                    <div class="speed-badge text-muted mb-1">${speed.toFixed(2)}x</div>
                    <div class="fw-bold text-dark">${secondsToDuration(totalSeconds / speed)}</div>
                </div>
            `;
            grid.appendChild(col);
        });
    }

    // Attach listener
    durationInput.addEventListener('input', calculateWatchTime);

    // No initialization with values, start clean for professional use
</script>
{% endblock %}