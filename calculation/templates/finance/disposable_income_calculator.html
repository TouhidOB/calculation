{% extends "base.html" %}

{% block title %}Disposable Income Calculator{% endblock %}
{% block meta_description %}Calculate disposable income after taxes and mandatory deductions.{% endblock %}

{% block extra_head %}
<style>.calc-wrapper{background:#fff;padding:22px;border-radius:10px}.analysis{white-space:pre-wrap}</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1>Disposable Income Calculator</h1>
  <p class="small-muted">Money available after taxes (for spending or saving).</p>

  <div class="calc-wrapper mt-3">
    <form id="disp-form">
      <div class="row">
        <div class="col-md-4 mb-2"><label>Gross Monthly Income ($)</label><input id="disp-gross" type="number" class="form-control"></div>
        <div class="col-md-4 mb-2"><label>Tax Rate (%)</label><input id="disp-tax" type="number" class="form-control" placeholder="e.g., 20"></div>
        <div class="col-md-4 mb-2"><label>Mandatory Deductions ($ per month)</label><input id="disp-ded" type="number" class="form-control" placeholder="Insurance, retirement pre-tax..."></div>
      </div>

      <div class="mt-2">
        <button class="btn btn-primary" type="submit">Calculate</button>
        <button id="disp-reset" type="button" class="btn btn-secondary">Reset</button>
      </div>
    </form>

    <div id="disp-result" class="mt-4 d-none">
      <h5>Result</h5>
      <div><strong>Disposable Income (Monthly):</strong> $<span id="disp-value">0.00</span></div>
      <div><strong>Disposable Annual:</strong> $<span id="disp-annual">0.00</span></div>

      <h6 class="mt-3">Deep Analysis</h6>
      <div id="disp-analysis" class="analysis alert alert-light"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('disp-form').addEventListener('submit', function(e){
  e.preventDefault();
  const gross = parseFloat(document.getElementById('disp-gross').value) || 0;
  const taxRate = parseFloat(document.getElementById('disp-tax').value)/100 || 0;
  const ded = parseFloat(document.getElementById('disp-ded').value) || 0;

  const afterTax = gross * (1 - taxRate);
  const disposable = afterTax - ded;
  const annual = disposable * 12;

  document.getElementById('disp-value').textContent = disposable.toFixed(2);
  document.getElementById('disp-annual').textContent = annual.toFixed(2);
  document.getElementById('disp-result').classList.remove('d-none');

  let pct = gross === 0 ? 0 : (disposable / gross) * 100;
  let analysis = `Disposable income is $${disposable.toFixed(2)} per month (${pct.toFixed(1)}% of gross).\n\nRecommendations:\n- Aim to save at least 20% of disposable income if possible.\n- If disposable < 30% of gross, consider tax-efficient retirement accounts or reduce mandatory costs.`;

  document.getElementById('disp-analysis').textContent = analysis;
});

document.getElementById('disp-reset').addEventListener('click', function(){
  ['disp-gross','disp-tax','disp-ded'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('disp-result').classList.add('d-none');
});
</script>
{% endblock %}
