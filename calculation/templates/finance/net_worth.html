{% extends "base.html" %}

{% block title %}Net Worth Calculator{% endblock %}
{% block meta_description %}Calculate your net worth: assets minus liabilities and get a deep analysis.{% endblock %}

{% block extra_head %}
<style>
  .calc { background:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.04) }
  .small-muted { font-size:0.9rem;color:#6c757d; }
  .row-gap { gap: .75rem; display:flex; flex-wrap:wrap; }
  .asset-liability { flex:1 1 48%; min-width:260px; }
  .analysis { white-space:pre-wrap; }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1>Net Worth Calculator</h1>
  <p class="small-muted">List all assets and liabilities for a comprehensive net worth and analysis.</p>

  <div class="calc mt-3">
    <form id="networth-form">
      <div class="row row-gap">
        <div class="asset-liability">
          <h5>Assets</h5>
          <div id="assets-list">
            <div class="input-group my-2">
              <input type="text" class="form-control asset-name" placeholder="Asset name (e.g., Savings)">
              <input type="number" class="form-control asset-value" placeholder="Amount" min="0" step="0.01">
              <button class="btn btn-outline-danger btn-sm remove-asset" type="button">−</button>
            </div>
          </div>
          <button id="add-asset" type="button" class="btn btn-sm btn-outline-primary">+ Add Asset</button>
        </div>

        <div class="asset-liability">
          <h5>Liabilities</h5>
          <div id="liabilities-list">
            <div class="input-group my-2">
              <input type="text" class="form-control liab-name" placeholder="Liability name (e.g., Mortgage)">
              <input type="number" class="form-control liab-value" placeholder="Amount" min="0" step="0.01">
              <button class="btn btn-outline-danger btn-sm remove-liab" type="button">−</button>
            </div>
          </div>
          <button id="add-liab" type="button" class="btn btn-sm btn-outline-primary">+ Add Liability</button>
        </div>
      </div>

      <hr>
      <div class="d-flex gap-2">
        <button class="btn btn-primary" type="submit">Calculate Net Worth</button>
        <button id="reset-networth" type="button" class="btn btn-secondary">Reset</button>
      </div>
    </form>

    <div id="nw-result" class="mt-4 d-none">
      <h5>Results</h5>
      <div class="mb-2"><strong>Total Assets:</strong> $<span id="total-assets">0.00</span></div>
      <div class="mb-2"><strong>Total Liabilities:</strong> $<span id="total-liabs">0.00</span></div>
      <div class="mb-2"><strong>Net Worth:</strong> $<span id="net-worth">0.00</span></div>

      <h6 class="mt-3">Deep Analysis</h6>
      <div id="nw-analysis" class="analysis alert alert-light"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function(){

  // --- Dynamic row generators
  function makeAssetRow() {
    const div = document.createElement('div');
    div.className = 'input-group my-2';
    div.innerHTML = `
      <input type="text" class="form-control asset-name" placeholder="Asset name (e.g., Investment)">
      <input type="number" class="form-control asset-value" placeholder="Amount" min="0" step="0.01">
      <button class="btn btn-outline-danger btn-sm remove-asset" type="button">−</button>
    `;
    return div;
  }

  function makeLiabRow() {
    const div = document.createElement('div');
    div.className = 'input-group my-2';
    div.innerHTML = `
      <input type="text" class="form-control liab-name" placeholder="Liability name (e.g., Loan)">
      <input type="number" class="form-control liab-value" placeholder="Amount" min="0" step="0.01">
      <button class="btn btn-outline-danger btn-sm remove-liab" type="button">−</button>
    `;
    return div;
  }

  // Add asset / liability buttons
  document.getElementById('add-asset').addEventListener('click', () => {
    document.getElementById('assets-list').appendChild(makeAssetRow());
  });

  document.getElementById('add-liab').addEventListener('click', () => {
    document.getElementById('liabilities-list').appendChild(makeLiabRow());
  });

  // Remove buttons (event delegation)
  document.addEventListener('click', function(e){
    if(e.target.classList.contains('remove-asset')){
      e.target.parentElement.remove();
    }
    if(e.target.classList.contains('remove-liab')){
      e.target.parentElement.remove();
    }
  });

  // Calculate Net Worth
  document.getElementById('networth-form').addEventListener('submit', function(e){
    e.preventDefault();

    const assets = Array.from(document.querySelectorAll('.asset-value'))
      .reduce((total, el)=> total + (parseFloat(el.value) || 0), 0);

    const liabs = Array.from(document.querySelectorAll('.liab-value'))
      .reduce((total, el)=> total + (parseFloat(el.value) || 0), 0);

    const net = assets - liabs;

    document.getElementById('total-assets').textContent = assets.toFixed(2);
    document.getElementById('total-liabs').textContent = liabs.toFixed(2);
    document.getElementById('net-worth').textContent = net.toFixed(2);
    document.getElementById('nw-result').classList.remove('d-none');

    // Deep analysis section...
    let mood = net > 0 ? "Good — positive net worth." :
               net === 0 ? "Neutral — assets equal liabilities." :
               "Warning — negative net worth.";

    // Asset & liability details
    const assetRows = document.querySelectorAll('.asset-name');
    const assetVals = document.querySelectorAll('.asset-value');
    let largestAsset = {name:"-", value:0};

    assetVals.forEach((input, i)=>{
      const value = parseFloat(input.value)||0;
      if(value > largestAsset.value){
        largestAsset = {name: assetRows[i].value || `Asset ${i+1}`, value};
      }
    });

    const liabRows = document.querySelectorAll('.liab-name');
    const liabVals = document.querySelectorAll('.liab-value');
    let largestLiab = {name:"-", value:0};

    liabVals.forEach((input, i)=>{
      const value = parseFloat(input.value)||0;
      if(value > largestLiab.value){
        largestLiab = {name: liabRows[i].value || `Liability ${i+1}`, value};
      }
    });

    const recs = net < 0
      ? [
          "- Reduce debts starting from highest interest.",
          "- Cut unnecessary expenses and redirect funds."
        ]
      : [
          "- Build emergency savings (3-6 months).",
          "- Diversify your assets to reduce risk."
        ];

    if(largestLiab.value > assets * 0.4){
      recs.push(`- Your largest liability (${largestLiab.name}) is high compared to total assets.`);
    }

    document.getElementById('nw-analysis').textContent = `
Net worth mood: ${mood}

Largest asset: ${largestAsset.name} — $${largestAsset.value.toFixed(2)}
Largest liability: ${largestLiab.name} — $${largestLiab.value.toFixed(2)}

Recommendations:
${recs.join('\n')}
    `;
  });

  // Reset button
  document.getElementById('reset-networth').addEventListener('click', ()=>{
    document.getElementById('assets-list').innerHTML = '';
    document.getElementById('liabilities-list').innerHTML = '';
    document.getElementById('assets-list').appendChild(makeAssetRow());
    document.getElementById('liabilities-list').appendChild(makeLiabRow());
    document.getElementById('nw-result').classList.add('d-none');
  });

  // Initial rows
  document.getElementById('assets-list').appendChild(makeAssetRow());
  document.getElementById('liabilities-list').appendChild(makeLiabRow());

});
</script>
{% endblock %}

