{% extends "base.html" %}

{% block title %}Debt-to-Income (DTI) Calculator{% endblock %}
{% block meta_description %}Calculate your DTI to understand borrowing capacity and risk profile.{% endblock %}

{% block extra_head %}
<style>
  .calc{background:#fff;padding:20px;border-radius:8px;box-shadow:0 0 10px rgba(0,0,0,0.04)}
  .analysis { white-space:pre-wrap; }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1>Debt-to-Income (DTI) Calculator</h1>
  <p class="small-muted">DTI = (Total monthly debt payments / Gross monthly income) × 100</p>

  <div class="calc mt-3">
    <form id="dti-form">
      <div class="mb-2">
        <label>Gross Monthly Income</label>
        <input id="gross-income" type="number" class="form-control" placeholder="e.g., 4000" min="0" step="0.01" required>
      </div>

      <div id="debts-section">
        <label>Monthly Debt Payments</label>
        <div class="input-group my-2">
          <input type="text" class="form-control debt-name" placeholder="Debt name (e.g., Car loan)">
          <input type="number" class="form-control debt-value" placeholder="Monthly payment" min="0" step="0.01">
          <button class="btn btn-outline-danger btn-sm remove-debt" type="button">−</button>
        </div>
      </div>
      <button id="add-debt" type="button" class="btn btn-sm btn-outline-primary">+ Add Debt</button>

      <div class="mt-3">
        <button class="btn btn-primary" type="submit">Calculate DTI</button>
        <button id="reset-dti" type="button" class="btn btn-secondary">Reset</button>
      </div>
    </form>

    <div id="dti-result" class="mt-4 d-none">
      <h5>Results</h5>
      <div><strong>Total Monthly Debt Payments:</strong> $<span id="total-debt-pay">0.00</span></div>
      <div><strong>DTI Ratio:</strong> <span id="dti-percent">0.00</span>%</div>

      <h6 class="mt-3">Deep Analysis</h6>
      <div id="dti-analysis" class="analysis alert alert-light"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  function makeDebtRow(){
    const div = document.createElement('div');
    div.className = 'input-group my-2';
    div.innerHTML = `
      <input type="text" class="form-control debt-name" placeholder="Debt name (e.g., Credit card)">
      <input type="number" class="form-control debt-value" placeholder="Monthly payment" min="0" step="0.01">
      <button class="btn btn-outline-danger btn-sm remove-debt" type="button">−</button>
    `;
    return div;
  }
  document.getElementById('add-debt').addEventListener('click', ()=> document.getElementById('debts-section').appendChild(makeDebtRow()));
  document.addEventListener('click', function(e){ if(e.target && e.target.classList.contains('remove-debt')) e.target.parentElement.remove(); });

  document.getElementById('dti-form').addEventListener('submit', function(e){
    e.preventDefault();
    const gross = parseFloat(document.getElementById('gross-income').value) || 0;
    const totalDebt = Array.from(document.querySelectorAll('.debt-value')).reduce((s,el)=> s + (parseFloat(el.value)||0), 0);
    const dti = gross === 0 ? 0 : (totalDebt / gross) * 100;

    document.getElementById('total-debt-pay').textContent = totalDebt.toFixed(2);
    document.getElementById('dti-percent').textContent = dti.toFixed(2);
    document.getElementById('dti-result').classList.remove('d-none');

    // Analysis
    let level = '';
    if(dti < 20) level = 'Excellent — very low debt burden.';
    else if(dti < 36) level = 'Good — manageable debt level for most lenders.';
    else if(dti < 43) level = 'Caution — approaching lender limits; consider reducing debt.';
    else level = 'High — likely high borrowing risk. Prioritize debt reduction.';

    const suggestions = [];
    if(dti >= 36) suggestions.push('- Prioritize paying down high-interest debts first.');
    else suggestions.push('- Keep up the current repayment pace and avoid new high-interest debt.');
    suggestions.push('- Consider refinancing if you have high-interest loans.');

    const analysis = `DTI Level: ${level}

Interpretation:
- Lenders typically prefer DTI < 36% (housing + other debts).
- If you plan to borrow (mortgage/loan), aim to lower DTI below 36%.

Recommendations:
${suggestions.join('\n')}
`;
    document.getElementById('dti-analysis').textContent = analysis;
  });

  document.getElementById('reset-dti').addEventListener('click', ()=>{
    document.getElementById('gross-income').value = '';
    document.getElementById('debts-section').innerHTML = '';
    document.getElementById('debts-section').appendChild(makeDebtRow());
    document.getElementById('dti-result').classList.add('d-none');
  });

  // initialize
  document.getElementById('debts-section').innerHTML = ''; document.getElementById('debts-section').appendChild(makeDebtRow());
</script>
{% endblock %}
