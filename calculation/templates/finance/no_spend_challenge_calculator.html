{% extends "base.html" %}

{% block title %}No-Spend Challenge Savings Calculator{% endblock %}

{% block meta_description %}Calculate potential savings during a no-spend challenge by projecting your typical daily spending over the challenge period.{% endblock %}

{% block meta_keywords %}no-spend challenge, savings, budgeting, financial independence{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .section-title {
        font-weight: bold;
        margin-top: 20px;
    }

    canvas {
        margin-top: 20px;
    }
    .result-alert { white-space: pre-wrap; }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-3">No-Spend Challenge Savings Calculator</h1>
    <p class="small-muted">Project your potential savings by estimating your typical spend rate over the duration of your no-spend challenge.</p>
    
    <div class="calc-wrapper mt-4">

        <ul class="nav nav-tabs">
            <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#nospend-monthly">Monthly Spend</a>
            </li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#nospend-annual">Annual Spend</a></li>
            <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#nospend-daily">Daily Spend</a></li>
        </ul>

        <div class="tab-content mt-3">
            
            <div class="tab-pane fade show active" id="nospend-monthly">
                <form class="nospend-form" data-period="monthly">
                    <h5 class="section-title">Challenge Inputs</h5>
                    <input type="number" class="form-control my-2 spend-input" placeholder="Typical Discretionary Monthly Spend ($)" min="0" step="10" required>
                    <input type="number" class="form-control my-2 challenge-days" placeholder="Days of No-Spend Challenge" min="1" max="365" required>
                    <button class="btn btn-primary mt-3" type="submit">Calculate</button>
                </form>
            </div>
            
            <div class="tab-pane fade" id="nospend-annual">
                <form class="nospend-form" data-period="annual">
                    <h5 class="section-title">Challenge Inputs</h5>
                    <input type="number" class="form-control my-2 spend-input" placeholder="Typical Discretionary Annual Spend ($)" min="0" step="100" required>
                    <input type="number" class="form-control my-2 challenge-days" placeholder="Days of No-Spend Challenge" min="1" max="365" required>
                    <button class="btn btn-primary mt-3" type="submit">Calculate</button>
                </form>
            </div>
            
            <div class="tab-pane fade" id="nospend-daily">
                <form class="nospend-form" data-period="daily">
                    <h5 class="section-title">Challenge Inputs</h5>
                    <input type="number" class="form-control my-2 spend-input" placeholder="Typical Discretionary Daily Spend ($)" min="0" step="1" required>
                    <input type="number" class="form-control my-2 challenge-days" placeholder="Days of No-Spend Challenge" min="1" max="365" required>
                    <button class="btn btn-primary mt-3" type="submit">Calculate</button>
                </form>
            </div>
            
        </div>

        <div class="alert alert-info mt-4 d-none result-alert" id="nospend-result"></div>
        <table class="table table-bordered mt-4 d-none" id="nospend-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value</th>
                </tr>
            </thead>
            <tbody id="nospend-body"></tbody>
        </table>
        <canvas id="nospend-chart" class="d-none"></canvas>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let nospendChart = null;

document.querySelectorAll('.nospend-form').forEach(function (form) {
    form.addEventListener('submit', function (e) {
        e.preventDefault();
        const period = form.dataset.period;
        const inputSpend = parseFloat(form.querySelector('.spend-input').value);
        const days = parseInt(form.querySelector('.challenge-days').value);
        
        let dailySpendRate;

        // 1. Normalize Input Spend to Daily Spend Rate
        if (period === 'monthly') {
            // Typical month is 30.4375 days (365.25/12)
            dailySpendRate = inputSpend / (365.25 / 12); 
        } else if (period === 'annual') {
            // Annual spend / 365.25 days
            dailySpendRate = inputSpend / 365.25; 
        } else { // daily
            // Already daily
            dailySpendRate = inputSpend; 
        }

        // 2. Calculate Total Savings
        const totalSaved = dailySpendRate * days;
        
        // Calculate the theoretical 'monthly' spend to compare against for the chart
        const normalizedMonthlySpend = dailySpendRate * (365.25 / 12);

        // 3. Update Results Display
        const res = document.getElementById('nospend-result');
        res.classList.remove('d-none');
        res.innerHTML = `**Estimated Daily Spend Rate:** $${dailySpendRate.toFixed(2)}\n
**Days in Challenge:** ${days}\n
---
**Potential Savings:** **$${totalSaved.toFixed(2)}**\n
${totalSaved > 0 ? '<span style="color:green;font-weight:bold;">✅ Great job! This is the amount you avoided spending.</span>' : '<span style="color:red;font-weight:bold;">❌ No potential savings calculated.</span>'}`;

        document.getElementById('nospend-table').classList.remove('d-none');
        document.getElementById('nospend-body').innerHTML = `
<tr><td>Estimated Daily Spend Rate</td><td>$${dailySpendRate.toFixed(2)}</td></tr>
<tr><td>Days of No-Spend</td><td>${days}</td></tr>
<tr><td>**Potential Savings**</td><td>**$${totalSaved.toFixed(2)}**</td></tr>
`;

        // 4. Update Chart
        const ctx = document.getElementById('nospend-chart').getContext('2d');
        document.getElementById('nospend-chart').classList.remove('d-none');
        if (nospendChart) nospendChart.destroy();
        
        // Calculate the hypothetical spend for the chart (if the challenge was a full month)
        const totalSpentHypothetical = normalizedMonthlySpend - totalSaved;
        const chartSpent = Math.max(0, totalSpentHypothetical);
        
        nospendChart = new Chart(ctx, {
            type: 'pie',
            data: {
                labels: ['Saved (Challenge Period)', 'Hypothetical Spent (Non-Challenge Period)'],
                datasets: [{ 
                    data: [totalSaved.toFixed(2), chartSpent.toFixed(2)],
                    backgroundColor: ['#4bc0c0', '#ff9f40'],
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: { display: true, text: 'Savings vs. Hypothetical Spend (Normalized)' }
                }
            }
        });
    });
});
</script>

{% endblock %}