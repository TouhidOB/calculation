{% extends "base.html" %}

{% block title %}Inflation (Purchasing Power) Calculator{% endblock %}
{% block meta_description %}See how inflation changed purchasing power between years.{% endblock %}

{% block extra_head %}
<style>
.calc-wrapper{background:#fff;padding:22px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.04)}
.analysis{white-space:pre-wrap}
.small-muted{font-size:.95rem;color:#6c757d}
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1>Inflation / Purchasing Power Calculator</h1>
  <p class="small-muted">Convert a past amount into today's equivalent using inflation (or vice versa).</p>

  <div class="calc-wrapper mt-3">
    <form id="inflation-form">
      <div class="row">
        <div class="col-md-4 mb-2">
          <label>Amount</label>
          <input id="inf-amount" type="number" class="form-control" step="0.01" value="1000" required>
        </div>
        <div class="col-md-4 mb-2">
          <label>From Year</label>
          <input id="inf-from-year" type="number" class="form-control" value="2015" min="1900" max="2100">
        </div>
        <div class="col-md-4 mb-2">
          <label>To Year</label>
          <input id="inf-to-year" type="number" class="form-control" value="{{ now.year }}" min="1900" max="2100">
        </div>
      </div>

      <div class="row mt-2">
        <div class="col-md-6 mb-2">
          <label>Average Annual Inflation Rate (%) — leave blank for default 3%</label>
          <input id="inf-rate" type="number" class="form-control" placeholder="e.g., 3" step="0.01">
        </div>
        <div class="col-md-6 mb-2 align-self-end">
          <button class="btn btn-primary" type="submit">Calculate</button>
          <button id="inf-reset" type="button" class="btn btn-secondary">Reset</button>
        </div>
      </div>
    </form>

    <div id="inf-result" class="mt-4 d-none">
      <h5>Result</h5>
      <div><strong>Adjusted Amount:</strong> $<span id="inf-adjusted">0.00</span></div>
      <div><strong>Purchasing Power Change:</strong> <span id="inf-change">0.00</span>%</div>

      <h6 class="mt-3">Deep Analysis</h6>
      <div id="inf-analysis" class="analysis alert alert-light"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('inflation-form').addEventListener('submit', function(e){
  e.preventDefault();
  const amount = parseFloat(document.getElementById('inf-amount').value)||0;
  const y1 = parseInt(document.getElementById('inf-from-year').value)||0;
  const y2 = parseInt(document.getElementById('inf-to-year').value)||0;
  let rate = document.getElementById('inf-rate').value ? parseFloat(document.getElementById('inf-rate').value)/100 : 0.03;
  const years = Math.abs(y2 - y1);
  const adjusted = amount * Math.pow(1 + rate, years);
  const pctChange = ((adjusted - amount) / Math.max(1, amount)) * 100;

  document.getElementById('inf-adjusted').textContent = adjusted.toFixed(2);
  document.getElementById('inf-change').textContent = pctChange.toFixed(2);
  document.getElementById('inf-result').classList.remove('d-none');

  // Deep analysis
  let trend = pctChange > 0 ? 'Price increase (inflation) reduced past purchasing power.' : 'Deflation / negative change.';
  let rec = `- If your money was held in cash, its equivalent value changed by ${pctChange.toFixed(1)}% over ${years} years.\n- Consider placing excess cash in inflation-protected investments (TIPS, high-yield savings, diversified portfolio) to preserve purchasing power.\n- Forecast uses a constant annual rate of ${(rate*100).toFixed(2)}% (approx). Actual inflation varies by year.`;

  const analysis = `From ${y1} → ${y2} (${years} years) at ${(rate*100).toFixed(2)}% annual inflation:
- Base amount: $${amount.toFixed(2)}
- Adjusted amount: $${adjusted.toFixed(2)}
- ${trend}

Recommendations:
${rec}`;

  document.getElementById('inf-analysis').textContent = analysis;
});

document.getElementById('inf-reset').addEventListener('click', function(){
  ['inf-amount','inf-from-year','inf-to-year','inf-rate'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('inf-result').classList.add('d-none');
});
</script>
{% endblock %}
