{% extends "base.html" %}
{% block title %}Wage Garnishment Calculator{% endblock %}
{% block meta_description %}Estimate paycheck garnishment amounts. Note: laws vary — this is a calculator for estimates, not legal advice.{% endblock %}

{% block extra_head %}
<style>
.calc-wrapper{background:#fff;padding:22px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.04)}
.analysis{white-space:pre-wrap}
.small-muted{font-size:.95rem;color:#6c757d}
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h1>Wage Garnishment Calculator</h1>
  <p class="small-muted">Estimate amount withheld from a paycheck by garnishment. Laws differ by jurisdiction — consult local rules for authoritative guidance.</p>

  <div class="calc-wrapper mt-3">
    <form id="wg-form">
      <div class="row">
        <div class="col-md-3 mb-2"><label>Gross Pay per Period ($)</label><input id="wg-gross" type="number" class="form-control" step="0.01" required></div>
        <div class="col-md-3 mb-2"><label>Pay Frequency</label>
          <select id="wg-freq" class="form-control"><option value="52">Weekly</option><option value="26">Bi-weekly</option><option value="24">Semi-monthly</option><option value="12">Monthly</option></select></div>
        <div class="col-md-3 mb-2"><label>Tax/Required Deductions ($)</label><input id="wg-deductions" type="number" class="form-control" step="0.01" value="0"></div>
        <div class="col-md-3 mb-2"><label>Number of Dependents</label><input id="wg-dependents" type="number" class="form-control" value="0" min="0"></div>
      </div>

      <div class="row mt-2">
        <div class="col-md-4 mb-2"><label>Garnishment Type</label>
          <select id="wg-type" class="form-control">
            <option value="percent">Percent of disposable income</option>
            <option value="flat">Flat amount per pay</option>
            <option value="child">Child support (common rules)</option>
          </select>
        </div>
        <div class="col-md-4 mb-2"><label>Percent or Amount (e.g., 25 or 100)</label><input id="wg-value" type="number" class="form-control" step="0.01" value="25"></div>
        <div class="col-md-4 mb-2 align-self-end">
          <button class="btn btn-primary" type="submit">Estimate Garnishment</button>
          <button id="wg-reset" type="button" class="btn btn-secondary">Reset</button>
        </div>
      </div>
    </form>

    <div id="wg-result" class="mt-4 d-none">
      <h5>Result</h5>
      <div><strong>Disposable Income (after deductions):</strong> $<span id="wg-disposable">0.00</span></div>
      <div><strong>Estimated Garnishment:</strong> $<span id="wg-garnished">0.00</span></div>
      <div><strong>Net Pay after Garnishment:</strong> $<span id="wg-net">0.00</span></div>

      <h6 class="mt-3">Deep Analysis</h6>
      <div id="wg-analysis" class="analysis alert alert-light"></div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('wg-form').addEventListener('submit', function(e){
  e.preventDefault();
  const gross = parseFloat(document.getElementById('wg-gross').value) || 0;
  const deductions = parseFloat(document.getElementById('wg-deductions').value) || 0;
  // disposable income for garnishment calculations often uses "disposable income" (after legally required deductions)
  const disposable = Math.max(0, gross - deductions);
  const type = document.getElementById('wg-type').value;
  const val = parseFloat(document.getElementById('wg-value').value) || 0;
  const dependents = parseInt(document.getElementById('wg-dependents').value) || 0;

  let garnished = 0;

  if(type === 'flat'){
    garnished = Math.min(val, disposable); // cannot garnish more than disposable
  } else if(type === 'percent'){
    // Simple estimator: apply the percentage to disposable income
    garnished = disposable * (val/100);
  } else if(type === 'child'){
    // Simple common rule example (varies widely): max 50% of disposable for one parent (simplified).
    // We'll give a graduated estimate based on dependents:
    // 1 dependent -> 17.5% - 25% ; 2 -> 25% - 30% ; 3+ -> 30% - 50% (this is illustrative only)
    const base = dependents === 0 ? 0 : (dependents === 1 ? 0.20 : (dependents === 2 ? 0.28 : 0.35));
    garnished = disposable * base;
  }

  // Cap garnished to disposable
  garnished = Math.max(0, Math.min(garnished, disposable));
  const net = disposable - garnished;

  document.getElementById('wg-disposable').textContent = disposable.toFixed(2);
  document.getElementById('wg-garnished').textContent = garnished.toFixed(2);
  document.getElementById('wg-net').textContent = net.toFixed(2);
  document.getElementById('wg-result').classList.remove('d-none');

  // Deep analysis
  let analysis = `This calculator provides an estimate. Laws differ by country/state/local jurisdiction — consult HR or legal counsel for exact withholding rules.\n\n`;
  analysis += `Details:\n- Gross pay this period: $${gross.toFixed(2)}\n- Required deductions (taxes / social insurance): $${deductions.toFixed(2)}\n- Disposable income used for garnishment: $${disposable.toFixed(2)}\n\n`;

  if(type === 'percent'){
    analysis += `Garnishment type: Percent of disposable income (${val}%)\n- Calculated garnishment: $${garnished.toFixed(2)} per pay period.\n`;
    if(val > 50) analysis += "- Note: garnishing >50% is usually legally restricted in many jurisdictions for most debts.\n";
  } else if(type === 'flat'){
    analysis += `Garnishment type: Flat amount ($${val.toFixed(2)})\n- We capped garnishment to disposable income if needed.\n`;
  } else {
    analysis += `Garnishment type: Child support estimate using a simplified rule (dependents=${dependents}).\n- Calculated: $${garnished.toFixed(2)}.\n- Note: actual child support calculations consider income, custody, special needs, and local guidelines.\n`;
  }

  analysis += `\nPractical recommendations:\n- Verify garnishment paperwork and limits with your employer's payroll/HR.\n- If garnishment causes hardship, consult legal aid or a debt counselor — options may exist such as repayment plans or exemptions.\n- Keep records of payments and communicate proactively with creditors if possible.`;

  document.getElementById('wg-analysis').textContent = analysis;
});

document.getElementById('wg-reset').addEventListener('click', function(){
  ['wg-gross','wg-freq','wg-deductions','wg-dependents','wg-type','wg-value'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('wg-result').classList.add('d-none');
});
</script>
{% endblock %}
