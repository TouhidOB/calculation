{% extends "base.html" %}

{% block title %}Countdown to Specific Event{% endblock %}

{% block meta_description %}Create a live countdown timer to any specific date and time, showing the exact time remaining in days, hours, minutes, and seconds.{% endblock %}

{% block meta_keywords %}countdown timer, event countdown, new year countdown, days remaining, time until event, date calculator{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: #f0f8ff; /* Light blue/sky background */
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }

    .section-title {
        font-weight: bold;
        margin-top: 20px;
        margin-bottom: 15px;
        color: #1e90ff; /* Dodger blue accent for event/sky theme */
    }

    /* Result Section Styles */
    .result-section {
        background-color: #e6f3ff; /* Lighter blue background */
        padding: 25px;
        border-radius: 8px;
        text-align: center;
        margin-top: 30px;
        border: 1px solid #1e90ff;
    }

    .result-section h3 {
        color: #0056b3; 
        margin-bottom: 25px;
        font-size: 1.5rem;
        font-weight: 600;
    }

    .countdown-timer {
        font-size: 2.5rem;
        font-weight: 800;
        color: #ff4500; /* Orange-red for the ticking time */
        line-height: 1.3;
        font-family: 'Courier New', monospace;
    }

    .time-unit {
        display: inline-block;
        margin: 0 10px;
        text-align: center;
    }

    .time-value {
        display: block;
        font-size: 3rem;
    }

    .time-label {
        display: block;
        font-size: 0.9rem;
        font-weight: normal;
        color: #555;
    }
    
    .d-none { display: none; }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="mb-3">üìÖ Countdown to Specific Event</h1>
    <p class="small-muted">Set a target date and time to see the live countdown in days, hours, minutes, and seconds.</p>

    <div class="calc-wrapper">

        <form id="countdown-form">
            <h5 class="section-title">Step 1: Event Details</h5>

            <div class="form-group mb-3">
                <label for="event-name" class="form-label">Event Name</label>
                <input type="text" class="form-control" id="event-name" value="New Year" required>
            </div>

            <div class="row g-3">
                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="target-date" class="form-label">Target Date</label>
                        <input type="date" class="form-control" id="target-date" required>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="form-group mb-3">
                        <label for="target-time" class="form-label">Target Time (Local Time)</label>
                        <input type="time" class="form-control" id="target-time" value="00:00" required>
                    </div>
                </div>
            </div>

            <button class="btn btn-info mt-4 w-100" type="submit" style="background-color: #1e90ff; border-color: #1e90ff;">Start Countdown</button>
        </form>

        <div id="results-container" class="d-none">
            <div class="result-section">
                <h3 id="countdown-event-title"></h3>

                <div class="countdown-timer">
                    <div class="time-unit">
                        <span class="time-value" id="countdown-days">00</span>
                        <span class="time-label">Days</span>
                    </div>
                    <div class="time-unit">
                        <span class="time-value" id="countdown-hours">00</span>
                        <span class="time-label">Hours</span>
                    </div>
                    <div class="time-unit">
                        <span class="time-value" id="countdown-minutes">00</span>
                        <span class="time-label">Minutes</span>
                    </div>
                    <div class="time-unit">
                        <span class="time-value" id="countdown-seconds">00</span>
                        <span class="time-label">Seconds</span>
                    </div>
                </div>
                
                <p id="event-message" class="mt-4 fw-bold"></p>
            </div>
        </div>

        <div id="status-message" class="alert d-none mt-3" role="alert"></div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function displayStatus(message, isError) {
        const statusDiv = document.getElementById('status-message');
        statusDiv.classList.remove('d-none', 'alert-success', 'alert-danger', 'alert-info');
        statusDiv.classList.add(isError ? 'alert-danger' : 'alert-info');
        statusDiv.innerHTML = isError ? `‚ùå **Error:** ${message}` : `‚ÑπÔ∏è ${message}`;
    }

    // Global variable to hold the countdown interval
    let countdownInterval;

    // Helper function to pad numbers with a leading zero
    function pad(num) {
        return num.toString().padStart(2, '0');
    }

    function updateCountdown(targetDateTime, eventName) {
        const now = new Date().getTime();
        const distance = targetDateTime.getTime() - now;
        
        const daysElement = document.getElementById('countdown-days');
        const hoursElement = document.getElementById('countdown-hours');
        const minutesElement = document.getElementById('countdown-minutes');
        const secondsElement = document.getElementById('countdown-seconds');
        const messageElement = document.getElementById('event-message');

        // Check if the countdown is over
        if (distance < 0) {
            clearInterval(countdownInterval);
            daysElement.innerText = '00';
            hoursElement.innerText = '00';
            minutesElement.innerText = '00';
            secondsElement.innerText = '00';
            messageElement.innerHTML = `üéâ **${eventName} is happening NOW!**`;
            return;
        }

        // Time calculations
        const oneSecond = 1000;
        const oneMinute = oneSecond * 60;
        const oneHour = oneMinute * 60;
        const oneDay = oneHour * 24;

        const days = Math.floor(distance / oneDay);
        const hours = Math.floor((distance % oneDay) / oneHour);
        const minutes = Math.floor((distance % oneHour) / oneMinute);
        const seconds = Math.floor((distance % oneMinute) / oneSecond);

        // Display the result
        daysElement.innerText = pad(days);
        hoursElement.innerText = pad(hours);
        minutesElement.innerText = pad(minutes);
        secondsElement.innerText = pad(seconds);
        
        messageElement.innerHTML = `Counting down to: ${targetDateTime.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })} at ${targetDateTime.toLocaleTimeString('en-US')}`;
    }

    // --- Event Handler ---

    document.getElementById('countdown-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // Clear any existing timer
        if (countdownInterval) {
            clearInterval(countdownInterval);
        }

        document.getElementById('results-container').classList.add('d-none');
        document.getElementById('status-message').classList.add('d-none');

        const eventName = document.getElementById('event-name').value;
        const targetDateStr = document.getElementById('target-date').value;
        const targetTimeStr = document.getElementById('target-time').value;

        if (!eventName || !targetDateStr || !targetTimeStr) {
            displayStatus("Please fill in all event details (Name, Date, and Time).", true);
            return;
        }

        try {
            // Combine date and time strings into a single valid format (Local Time)
            const targetDateTimeString = `${targetDateStr}T${targetTimeStr}:00`;
            const targetDateTime = new Date(targetDateTimeString);

            // Validation check (if Date object is invalid or in the past)
            if (isNaN(targetDateTime.getTime())) {
                throw new Error("Invalid date or time format.");
            }
            if (targetDateTime.getTime() <= new Date().getTime()) {
                displayStatus("The target date/time must be in the future.", true);
                return;
            }

            // 1. Prepare Results Display
            document.getElementById('countdown-event-title').innerText = `Countdown to ${eventName}`;
            document.getElementById('results-container').classList.remove('d-none');

            // 2. Start Live Countdown
            // Run once immediately to avoid a 1-second delay
            updateCountdown(targetDateTime, eventName); 
            // Set up the interval to run every second (1000ms)
            countdownInterval = setInterval(() => updateCountdown(targetDateTime, eventName), 1000);

        } catch (error) {
            console.error("Countdown Initialization Error:", error);
            displayStatus(`Failed to start countdown: ${error.message}`, true);
        }
    });

    // Set default target date/time (e.g., next New Year)
    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date();
        const nextYear = today.getFullYear() + 1;
        
        // Target: January 1st, next year, 00:00
        const defaultTargetDateStr = `${nextYear}-01-01`;
        
        document.getElementById('target-date').value = defaultTargetDateStr;
        document.getElementById('target-time').value = '00:00';
    });
</script>

{% endblock %}