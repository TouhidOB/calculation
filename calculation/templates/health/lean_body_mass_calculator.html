{% extends "base.html" %}

{% block title %}Lean Body Mass (LBM) Calculator{% endblock %}

{% block meta_description %}Calculate your Lean Body Mass (LBM) in both kilograms and pounds using the Boer formula, based on your height, weight, and gender.{% endblock %}

{% block meta_keywords %}LBM calculator, lean body mass, body fat percentage, Boer formula, body composition, fitness metrics{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .section-title {
        font-weight: bold;
        margin-top: 20px;
    }

    .result-alert {
        white-space: pre-wrap;
    }
    
    .lbm-output {
        font-size: 2rem;
        font-weight: bold;
        color: #008080; /* Teal color for body composition */
    }

    .gender-group {
        display: flex;
        gap: 20px;
        margin-bottom: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-3">ðŸ’ª Lean Body Mass (LBM) Calculator</h1>
    <p class="small-muted">Estimate your **Lean Body Mass**â€”the weight of everything in your body except fatâ€”using your height, weight, and gender with the **Boer Formula**.</p>

    <div class="calc-wrapper mt-4">

        <form id="lbm-form">
            <h5 class="section-title">Step 1: Your Metrics</h5>

            <!-- Gender Input -->
            <div class="form-group mb-3">
                <label class="form-label d-block">Gender</label>
                <div class="gender-group">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderMale" value="male" required>
                        <label class="form-check-label" for="genderMale">Male</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="gender" id="genderFemale" value="female" required>
                        <label class="form-check-label" for="genderFemale">Female</label>
                    </div>
                </div>
            </div>

            <!-- Height Input (Feet and Inches) -->
            <label class="form-label d-block mt-3">Height</label>
            <div class="row g-2">
                <div class="col">
                    <div class="input-group">
                        <input type="number" class="form-control" id="height_ft" placeholder="Feet (e.g., 5)" min="3" max="7" required>
                        <span class="input-group-text">ft</span>
                    </div>
                </div>
                <div class="col">
                    <div class="input-group">
                        <input type="number" class="form-control" id="height_in" placeholder="Inches (e.g., 5)" min="0" max="11" required>
                        <span class="input-group-text">in</span>
                    </div>
                </div>
            </div>

            <h5 class="section-title mt-4">Step 2: Your Current Weight</h5>

            <!-- Weight Input -->
            <div class="input-group my-3">
                <input type="number" class="form-control" id="weight_input" placeholder="Current Weight" min="5" max="500" step="0.1" required>
                <select class="form-select" id="weight_unit" style="max-width: 100px;">
                    <option value="lb" selected>Lbs</option>
                    <option value="kg">Kg</option>
                </select>
            </div>

            <button class="btn btn-primary mt-4" type="submit">Calculate LBM</button>
        </form>

        <div class="alert alert-success mt-4 d-none result-alert" id="lbm-result"></div>

        <h5 class="section-title d-none" id="table-title">Composition Breakdown</h5>
        <table class="table table-bordered mt-2 d-none" id="lbm-table">
            <thead>
                <tr>
                    <th>Metric</th>
                    <th>Value (kg)</th>
                    <th>Value (lbs)</th>
                </tr>
            </thead>
            <tbody id="lbm-body"></tbody>
        </table>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const KG_PER_LB = 0.453592;
    const CM_PER_INCH = 2.54;
    const LB_PER_KG = 2.20462;

    document.getElementById('lbm-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // 1. Get Inputs
        const gender = document.querySelector('input[name="gender"]:checked').value;
        const weight_input = parseFloat(document.getElementById('weight_input').value);
        const weight_unit = document.getElementById('weight_unit').value;
        const height_ft = parseFloat(document.getElementById('height_ft').value);
        const height_in = parseFloat(document.getElementById('height_in').value);

        // Simple validation
        if (weight_input <= 0 || height_ft < 0 || height_in < 0) {
            displayError("Please enter valid weight and height values.");
            return;
        }

        // 2. Normalize Units for Boer Formula (requires kg and cm)
        
        // a. Weight (to kg)
        let weight_kg;
        if (weight_unit === 'lb') {
            weight_kg = weight_input * KG_PER_LB;
        } else { // kg
            weight_kg = weight_input;
        }
        
        // b. Height (to cm)
        const total_height_in = (height_ft * 12) + height_in;
        const height_cm = total_height_in * CM_PER_INCH;

        // 3. Calculate LBM using Boer Formula
        let lbm_kg; // Lean Body Mass in kilograms

        if (gender === 'male') {
            // LBM Male = 0.407 * W(kg) + 0.267 * H(cm) - 19.2
            lbm_kg = (0.407 * weight_kg) + (0.267 * height_cm) - 19.2;
        } else { // female
            // LBM Female = 0.252 * W(kg) + 0.473 * H(cm) - 48.3
            lbm_kg = (0.252 * weight_kg) + (0.473 * height_cm) - 48.3;
        }
        
        // Ensure LBM is not negative or zero
        lbm_kg = Math.max(1, lbm_kg); 
        
        // 4. Calculate related metrics
        const lbm_lb = lbm_kg * LB_PER_KG;
        const fat_mass_kg = weight_kg - lbm_kg;
        const fat_mass_lb = fat_mass_kg * LB_PER_KG;
        const bfp = (fat_mass_kg / weight_kg) * 100; // Body Fat Percentage

        // 5. Update Result Display
        const lbm_kg_rounded = lbm_kg.toFixed(2);
        const lbm_lb_rounded = lbm_lb.toFixed(2);
        
        const res = document.getElementById('lbm-result');
        res.classList.remove('d-none', 'alert-danger');
        res.classList.add('alert-success');
        res.innerHTML = `
**LBM Formula Used:** Boer Formula
**Normalized Height:** ${height_cm.toFixed(1)} cm
**Normalized Weight:** ${weight_kg.toFixed(1)} kg
---

**Estimated Lean Body Mass (LBM):**

<span class="lbm-output">${lbm_lb_rounded} lbs</span> (or ${lbm_kg_rounded} kg)
`;
        
        // 6. Update Breakdown Table
        document.getElementById('table-title').classList.remove('d-none');
        document.getElementById('lbm-table').classList.remove('d-none');
        
        const tableBody = document.getElementById('lbm-body');
        tableBody.innerHTML = `
        <tr>
            <td>**Lean Body Mass (LBM)**</td>
            <td class="lbm-output">${lbm_kg_rounded}</td>
            <td class="lbm-output">${lbm_lb_rounded}</td>
        </tr>
        <tr>
            <td>Body Fat Mass</td>
            <td>${fat_mass_kg.toFixed(2)}</td>
            <td>${fat_mass_lb.toFixed(2)}</td>
        </tr>
        <tr>
            <td>**Body Fat Percentage (BFP)**</td>
            <td colspan="2">**${bfp.toFixed(1)} %**</td>
        </tr>
        `;
    });

    function displayError(message) {
        const res = document.getElementById('lbm-result');
        res.classList.remove('d-none', 'alert-success');
        res.classList.add('alert-danger');
        res.innerHTML = `**Calculation Error:** ${message}`;
        document.getElementById('table-title').classList.add('d-none');
        document.getElementById('lbm-table').classList.add('d-none');
    }
</script>

{% endblock %}