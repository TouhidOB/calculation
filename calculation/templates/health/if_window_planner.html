{% extends "base.html" %}

{% block title %}Intermittent Fasting (IF) Window Planner{% endblock %}

{% block meta_description %}Plan your Intermittent Fasting schedule (16:8, 18:6, 20:4) by setting your desired eating window start time and calculate the full 24-hour cycle.{% endblock %}

{% block meta_keywords %}intermittent fasting calculator, IF planner, 16:8 schedule, eating window, fasting window, time calculator, OMAD{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .section-title {
        font-weight: bold;
        margin-top: 20px;
        color: #f59e0b; /* Amber for energy/time */
    }

    .output-time {
        font-size: 1.8rem;
        font-weight: bold;
        color: #f59e0b; 
    }

    .window-card {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
    }

    .eating-window {
        background-color: #fffbeb; /* Light Amber */
        border: 2px solid #fcd34d;
    }

    .fasting-window {
        background-color: #f0fdfa; /* Light Teal/Blue for a cool contrast */
        border: 2px solid #2dd4bf;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-3">‚è∞ Intermittent Fasting Window Planner</h1>
    <p class="small-muted">Select your protocol and your desired start time to plan your entire **24-hour fasting and eating cycle**.</p>

    <div class="calc-wrapper mt-4">

        <form id="if-planner-form">
            <h5 class="section-title">Step 1: Choose Protocol</h5>

            <!-- Protocol Selection -->
            <label class="form-label d-block mt-3">Fasting to Eating Ratio (Fasting Hours : Eating Hours)</label>
            <select class="form-select mb-3" id="protocol_select" required>
                <option value="" disabled selected>-- Select IF Protocol --</option>
                <option value="16:8">16:8 (Most Common)</option>
                <option value="18:6">18:6 (Advanced)</option>
                <option value="20:4">20:4 (The Warrior Diet)</option>
                <option value="23:1">23:1 (One Meal A Day - OMAD)</option>
                <option value="14:10">14:10 (Beginner)</option>
                <option value="12:12">12:12 (Easiest)</option>
            </select>

            <h5 class="section-title mt-4">Step 2: Desired Eating Window Start Time</h5>

            <!-- Start Time Input -->
            <label class="form-label d-block mt-3">I want my **Eating Window** to start at:</label>
            <input type="time" class="form-control form-control-lg mb-3" id="start_time" value="12:00" required>
            
            <button class="btn btn-primary mt-4 w-100" type="submit">Calculate Window Times</button>
        </form>

        <h5 class="section-title mt-4 d-none" id="result-title">Your 24-Hour Cycle Plan</h5>
        
        <div id="results-container" class="mt-3 d-none">
            <!-- Eating Window Result -->
            <div class="window-card eating-window">
                <h6 class="fw-bold text-lg mb-2 text-dark">üçΩÔ∏è EATING WINDOW</h6>
                <p>
                    <span class="fw-bold">Start Time:</span> <span id="eat_start" class="output-time"></span>
                </p>
                <p class="mb-0">
                    <span class="fw-bold">End Time:</span> <span id="eat_end" class="output-time"></span>
                </p>
            </div>

            <!-- Fasting Window Result -->
            <div class="window-card fasting-window">
                <h6 class="fw-bold text-lg mb-2 text-dark">üö´ FASTING WINDOW</h6>
                <p>
                    <span class="fw-bold">Start Time:</span> <span id="fast_start" class="output-time"></span> (Same as Eating Window End)
                </p>
                <p class="mb-0">
                    <span class="fw-bold">End Time:</span> <span id="fast_end" class="output-time"></span> (Next Day)
                </p>
            </div>
            
        </div>
        
        <div class="alert alert-danger mt-4 d-none" id="error-message"></div>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Protocol map: Key is ratio, value is [Fasting Hours, Eating Hours]
    const PROTOCOLS = {
        '16:8': [16, 8],
        '18:6': [18, 6],
        '20:4': [20, 4],
        '23:1': [23, 1], // OMAD
        '14:10': [14, 10],
        '12:12': [12, 12]
    };

    /** Helper to format hours and minutes into HH:MM (24h) or HH:MM AM/PM (12h) string. */
    function formatTime(hours, minutes) {
        // Ensure hours and minutes are valid and wrap
        hours = hours % 24; 
        minutes = minutes % 60;
        
        const ampm = hours >= 12 ? 'PM' : 'AM';
        const displayHours = hours % 12 || 12; // Convert 0 (midnight) or 12 (noon) to 12
        
        const h_str = displayHours.toString().padStart(2, '0');
        const m_str = minutes.toString().padStart(2, '0');
        
        return `${h_str.replace(/^0/, '')}:${m_str} ${ampm}`;
    }

    document.getElementById('if-planner-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // 1. Get Inputs
        const protocolKey = document.getElementById('protocol_select').value;
        const startTime24h = document.getElementById('start_time').value; // Format: "HH:MM"

        if (!protocolKey || !startTime24h) {
            displayError("Please select a protocol and a start time.");
            return;
        }
        
        const [fastingHours, eatingHours] = PROTOCOLS[protocolKey];
        const [startHour, startMinute] = startTime24h.split(':').map(Number);

        // 2. Calculation Logic
        
        // Eating Window Start is the input time
        const eatStartFormatted = formatTime(startHour, startMinute);

        // Eating Window End
        let eatEndHour = startHour + eatingHours;
        let eatEndMinute = startMinute;
        const eatEndFormatted = formatTime(eatEndHour, eatEndMinute);
        
        // Fasting Window Start (Same as Eating Window End)
        const fastStartFormatted = eatEndFormatted;
        
        // Fasting Window End (Same as Eating Window Start on the next day)
        // Since the window is exactly 24 hours, the end time is always the start time, 
        // but it's important to convey that it's on the next day.
        const fastEndFormatted = eatStartFormatted + " (Next Day)";

        // 3. Update Result Display
        document.getElementById('eat_start').textContent = eatStartFormatted;
        document.getElementById('eat_end').textContent = eatEndFormatted;
        document.getElementById('fast_start').textContent = fastStartFormatted.replace(' (Next Day)', ''); // Remove '(Next Day)' if present
        document.getElementById('fast_end').textContent = fastEndFormatted;

        // 4. Update Visibility
        document.getElementById('result-title').classList.remove('d-none');
        document.getElementById('results-container').classList.remove('d-none');
        document.getElementById('error-message').classList.add('d-none');
    });

    function displayError(message) {
        document.getElementById('error-message').classList.remove('d-none');
        document.getElementById('error-message').textContent = `Calculation Error: ${message}`;
        document.getElementById('result-title').classList.add('d-none');
        document.getElementById('results-container').classList.add('d-none');
    }
</script>

{% endblock %}