{% extends "base.html" %}

{% block title %}A1C to Average Blood Sugar Converter{% endblock %}

{% block meta_description %}Convert your A1C percentage to Estimated Average Glucose (eAG) in both mg/dL and mmol/L, a key tool for diabetes management and monitoring.{% endblock %}

{% block meta_keywords %}A1C converter, eAG calculator, average blood sugar, hemoglobin A1C, glucose level, diabetes management tool{% endblock %}

{% block extra_head %}
<style>
    .calc-wrapper {
        background: white;
        padding: 25px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
    }

    .section-title {
        font-weight: bold;
        margin-top: 20px;
        color: #059669; /* Green for health/targets */
    }

    .output-eag {
        font-size: 3rem;
        font-weight: bold;
        color: #059669; 
        line-height: 1;
    }
    
    .output-unit-label {
        font-size: 1.25rem;
        font-weight: 600;
        margin-top: 10px;
        padding: 10px;
        border-radius: 6px;
        color: #059669;
        background-color: #d1fae5;
    }
    
    .window-card {
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 15px;
        background-color: #f0fdfa;
        border: 2px solid #a7f3d0;
    }
    
    .formula-note {
        font-style: italic;
        color: #4b5563;
        margin-top: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
    <h1 class="mb-3">ðŸ©¸ A1C to Average Blood Sugar Converter</h1>
    <p class="small-muted">Convert your $\text{A1C}$ percentage to Estimated Average Glucose ($\text{eAG}$) in both $\text{mg}/\text{dL}$ (US) and $\text{mmol}/\text{L}$ (International) units.</p>

    <div class="calc-wrapper mt-4">

        <form id="a1c-form">
            <h5 class="section-title">Step 1: Enter A1C Percentage</h5>

            <label class="form-label d-block mt-3">A1C Percentage ($\%$)</label>
            <div class="input-group mb-3">
                <input type="number" class="form-control form-control-lg" id="a1c_input" placeholder="e.g., 7.0" min="4.0" max="15.0" step="0.1" required>
                <span class="input-group-text font-weight-bold fs-4">%</span>
            </div>
            <small class="form-text text-muted d-block mb-3">A non-diabetic A1C is typically below $5.7\%$.</small>

            <button class="btn btn-primary mt-4 w-100" type="submit">Calculate Average Glucose</button>
        </form>

        <div class="alert alert-danger mt-4 d-none" id="error-message"></div>

        <h5 class="section-title mt-4 d-none" id="result-title">Estimated Average Glucose ($\text{eAG}$)</h5>
        
        <div id="results-container" class="mt-3 d-none">
            
            <div class="window-card text-center">
                <h6 class="output-unit-label mb-2">US Standard (Milligrams per Deciliter)</h6>
                
                <p class="mb-0">
                    <span id="eag_mgdl" class="output-eag">0</span>
                    <span class="fs-4 text-muted">$\text{mg}/\text{dL}$</span>
                </p>
            </div>

            <div class="window-card text-center">
                <h6 class="output-unit-label mb-2">International Standard (Millimoles per Liter)</h6>
                
                <p class="mb-0">
                    <span id="eag_mmol" class="output-eag">0.0</span>
                    <span class="fs-4 text-muted">$\text{mmol}/\text{L}$</span>
                </p>
            </div>
            
            <p class="formula-note text-center">
                Calculation based on the regression formula: $\text{eAG}(\text{mg}/\text{dL}) = (28.7 \times \text{A1C}) - 46.7$
            </p>
            
        </div>
        
        <p class="small-muted mt-3">
            Note: The $\text{eAG}$ is an estimate and may differ slightly from daily blood glucose readings. Always use your lab report for clinical decisions.
        </p>

    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Constant for converting mg/dL to mmol/L
    const MMOL_PER_MGDL = 18.018; 
    
    /**
     * Calculates Estimated Average Glucose (eAG) in mg/dL using the formula:
     * eAG (mg/dL) = (28.7 * A1C) - 46.7
     * @param {number} a1c - A1C percentage
     * @returns {number} eAG in mg/dL
     */
    function calculateEagMgdl(a1c) {
        return (28.7 * a1c) - 46.7;
    }

    document.getElementById('a1c-form').addEventListener('submit', function (e) {
        e.preventDefault();

        // 1. Get Inputs
        const a1cInput = parseFloat(document.getElementById('a1c_input').value);

        // 2. Validation
        if (isNaN(a1cInput) || a1cInput <= 0) {
            displayError("Please enter a valid, positive A1C percentage.");
            return;
        }

        // 3. Calculation
        const eagMgdl = calculateEagMgdl(a1cInput);
        const eagMmol = eagMgdl / MMOL_PER_MGDL;

        // 4. Update Result Display
        document.getElementById('eag_mgdl').textContent = eagMgdl.toFixed(0);
        document.getElementById('eag_mmol').textContent = eagMmol.toFixed(1);

        // 5. Update Visibility
        document.getElementById('result-title').classList.remove('d-none');
        document.getElementById('results-container').classList.remove('d-none');
        document.getElementById('error-message').classList.add('d-none');
    });

    function displayError(message) {
        document.getElementById('error-message').classList.remove('d-none');
        document.getElementById('error-message').textContent = `Calculation Error: ${message}`;
        document.getElementById('result-title').classList.add('d-none');
        document.getElementById('results-container').classList.add('d-none');
    }
</script>

{% endblock %}