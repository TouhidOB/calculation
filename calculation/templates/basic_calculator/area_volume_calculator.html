{% extends "base.html" %}

{% block title %}Area and Volume Calculator{% endblock %}

{% block meta_description %}Calculate the area of 2D shapes (Square, Circle, Triangle) and the volume of 3D shapes (Cube, Sphere, Cylinder).{% endblock %}

{% block meta_keywords %}area, volume, circle, square, cylinder, sphere, cube, rectangle, geometry, math calculator{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Styling for the central calculation block (Orange/Indigo Theme) */
    .solver-wrapper {
        background: #fcfcfc;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 750px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-section {
        padding: 25px;
        border-radius: 10px;
        background-color: #fef9e6; /* Light Yellow/Orange */
        border: 2px solid #f97316; /* Orange Accent */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .input-box label {
        font-size: 0.95rem;
        font-weight: 500;
        color: #7c2d12; /* Darker Orange/Brown */
        display: block;
        margin-bottom: 3px;
    }

    .input-field {
        width: 100%;
        padding: 10px;
        font-size: 1.1rem;
        border: 2px solid #fb923c; /* Medium Orange border */
        border-radius: 6px;
        text-align: center;
        font-weight: 600;
        color: #9a3412;
    }
    
    .result-section {
        margin-top: 30px;
    }

    .result-card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        background-color: #eef2ff; /* Lightest Indigo */
        border-left: 5px solid #4f46e5; /* Indigo accent */
    }

    .result-error {
        border-left: 5px solid #ef4444; /* Red */
        background-color: #fee2e2;
        color: #991b1b;
        padding: 20px;
        border-radius: 8px;
    }
    
    .output-label {
        font-size: 1.2rem;
        font-weight: 700;
        text-align: center;
        color: #1f2937;
        margin-bottom: 10px;
    }

    .output-value {
        font-size: 2.5rem;
        font-weight: 800;
        text-align: center;
        color: #4f46e5; /* Deep Indigo */
        word-break: break-all;
    }

    .formula-applied {
        margin-top: 15px;
        font-size: 0.9rem;
        color: #475569;
        line-height: 1.5;
        border-top: 1px dashed #a5b4fc;
        padding-top: 10px;
        text-align: center;
    }

    .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <h1 class="text-3xl font-extrabold mb-2 text-gray-900 text-center">Area & Volume Calculator</h1>
    <p class="text-gray-600 mb-6 text-center">
        Select a 2D or 3D shape and enter its dimensions to calculate the Area or Volume.
    </p>

    <div class="solver-wrapper">
        
        <form id="shape-form" class="space-y-6">
            <div class="input-section">
                <div class="input-box mb-6">
                    <label for="shape-selector" class="text-center w-full block">Select Shape:</label>
                    <select id="shape-selector" 
                            class="input-field shadow-inner focus:shadow-xl transition-shadow bg-white text-lg" 
                            onchange="updateInputs()">
                        <optgroup label="2D Area Calculations">
                            <option value="circle">Circle Area ($\pi r^2$)</option>
                            <option value="square">Square Area ($s^2$)</option>
                            <option value="rectangle">Rectangle Area ($l \cdot w$)</option>
                            <option value="triangle">Triangle Area ($\frac{1}{2} b h$)</option>
                        </optgroup>
                        <optgroup label="3D Volume Calculations">
                            <option value="sphere">Sphere Volume ($\frac{4}{3} \pi r^3$)</option>
                            <option value="cube">Cube Volume ($s^3$)</option>
                            <option value="cylinder">Cylinder Volume ($\pi r^2 h$)</option>
                            <option value="prism">Rectangular Prism Volume ($l \cdot w \cdot h$)</option>
                        </optgroup>
                    </select>
                </div>

                <div id="dynamic-inputs" class="input-grid">
                    <!-- Dynamic inputs will be inserted here -->
                </div>
            </div>

            <button type="submit"
                    class="w-full bg-indigo-600 text-white font-bold py-3 rounded-lg shadow-xl hover:bg-indigo-700 transition duration-150 transform hover:scale-[1.01]">
                Calculate
            </button>
        </form>

        <div id="result-container" class="result-section">
            <div id="solution-output" class="result-card">
                <!-- Initial result for Circle -->
                <p class="output-label">Area (Circle) is:</p>
                <div class="output-value">
                    $$\mathbf{314.16}$$
                </div>
                <div class="formula-applied">
                    Applied Formula: $$A = \pi r^2$$
                </div>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const PI = Math.PI;

    // Defines all shapes, their required inputs, and their calculation logic
    const SHAPES = {
        // --- 2D Shapes (Area) ---
        'square': {
            type: 'Area',
            inputs: [{ key: 's', label: 'Side Length (s)' }],
            formula: 'A = s^2',
            calc: (s) => s * s,
            example: { s: 10 }
        },
        'circle': {
            type: 'Area',
            inputs: [{ key: 'r', label: 'Radius (r)' }],
            formula: 'A = \\pi r^2',
            calc: (r) => PI * r * r,
            example: { r: 10 }
        },
        'rectangle': {
            type: 'Area',
            inputs: [{ key: 'l', label: 'Length (l)' }, { key: 'w', label: 'Width (w)' }],
            formula: 'A = l \\cdot w',
            calc: (l, w) => l * w,
            example: { l: 8, w: 5 }
        },
        'triangle': {
            type: 'Area',
            inputs: [{ key: 'b', label: 'Base (b)' }, { key: 'h', label: 'Height (h)' }],
            formula: 'A = \\frac{1}{2} b h',
            calc: (b, h) => 0.5 * b * h,
            example: { b: 6, h: 4 }
        },
        // --- 3D Shapes (Volume) ---
        'cube': {
            type: 'Volume',
            inputs: [{ key: 's', label: 'Side Length (s)' }],
            formula: 'V = s^3',
            calc: (s) => s * s * s,
            example: { s: 5 }
        },
        'sphere': {
            type: 'Volume',
            inputs: [{ key: 'r', label: 'Radius (r)' }],
            formula: 'V = \\frac{4}{3} \\pi r^3',
            calc: (r) => (4 / 3) * PI * r * r * r,
            example: { r: 3 }
        },
        'cylinder': {
            type: 'Volume',
            inputs: [{ key: 'r', label: 'Radius (r)' }, { key: 'h', label: 'Height (h)' }],
            formula: 'V = \\pi r^2 h',
            calc: (r, h) => PI * r * r * h,
            example: { r: 4, h: 10 }
        },
        'prism': {
            type: 'Volume',
            inputs: [{ key: 'l', label: 'Length (l)' }, { key: 'w', label: 'Width (w)' }, { key: 'h', label: 'Height (h)' }],
            formula: 'V = l \\cdot w \\cdot h',
            calc: (l, w, h) => l * w * h,
            example: { l: 6, w: 3, h: 2 }
        }
    };

    /**
     * Updates the UI to display inputs relevant to the selected shape.
     */
    function updateInputs() {
        const selector = document.getElementById('shape-selector');
        const shapeKey = selector.value;
        const dynamicInputsDiv = document.getElementById('dynamic-inputs');
        const shape = SHAPES[shapeKey];
        
        if (!shape) return;

        let html = '';
        shape.inputs.forEach(inputDef => {
            // Use the example value for the initial state of the input
            const initialValue = shape.example[inputDef.key];

            html += `
                <div class="input-box">
                    <label for="input-${inputDef.key}">${inputDef.label}:</label>
                    <input type="number" id="input-${inputDef.key}" value="${initialValue}" step="any" min="0" required
                           placeholder="${inputDef.label}"
                           class="input-field shadow-inner focus:shadow-xl transition-shadow">
                </div>
            `;
        });

        dynamicInputsDiv.innerHTML = html;
        // Trigger calculation immediately after updating inputs
        calculateShape(new Event('submit'));
    }

    /**
     * Updates the results display with appropriate styling and content.
     */
    function displayResult(isError, outputLabel, outputValue, formula) {
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.remove('hidden', 'result-error', 'result-card');
        
        if (isError) {
            outputDiv.classList.add('result-error');
            outputDiv.classList.remove('result-card');
            outputDiv.innerHTML = outputValue; // Error message is the value
        } else {
            outputDiv.classList.add('result-card');
            outputDiv.classList.remove('result-error');
            outputDiv.innerHTML = `
                <p class="output-label">${outputLabel} is:</p>
                <div class="output-value">
                    $$\\mathbf{${outputValue}}$$
                </div>
                <div class="formula-applied">
                    Applied Formula: $$${formula}$$
                </div>
            `;
        }
    }

    /**
     * Main function to perform the calculation based on selected shape.
     */
    function calculateShape(e) {
        if (e && e.preventDefault) {
            e.preventDefault();
        }

        const selector = document.getElementById('shape-selector');
        const shapeKey = selector.value;
        const shape = SHAPES[shapeKey];
        
        if (!shape) {
            displayResult(true, '', 'Shape not found.', '');
            return;
        }

        // 1. Gather inputs
        const values = [];
        let valid = true;
        let inputNames = [];

        shape.inputs.forEach(inputDef => {
            const inputElement = document.getElementById(`input-${inputDef.key}`);
            const val = parseFloat(inputElement.value.trim());

            if (isNaN(val) || val < 0) {
                valid = false;
            }
            values.push(val);
            inputNames.push(inputDef.label);
        });

        // 2. Validate inputs
        if (!valid) {
            displayResult(true, '', '<p class="font-bold text-center">Invalid Input</p><p class="text-center">Please enter positive numerical values for all dimensions.</p>', '');
            return;
        }

        // 3. Perform calculation
        let result;
        try {
            result = shape.calc(...values);
        } catch (error) {
            console.error("Calculation error:", error);
            displayResult(true, '', `<p class="font-bold text-center">Calculation Error</p><p class="text-center">${error.message}</p>`, '');
            return;
        }

        // 4. Display result
        let result_f = result.toFixed(4).replace(/\.?0+$/, '');

        // If result is very large/small, use scientific notation
        if (Math.abs(result) > 1e12 || (Math.abs(result) < 1e-6 && result !== 0)) {
            result_f = result.toExponential(4);
        }

        displayResult(
            false,
            shape.type + ' (' + shapeKey.charAt(0).toUpperCase() + shapeKey.slice(1) + ')',
            result_f,
            shape.formula
        );
    }

    // Attach handler to the form
    document.getElementById('shape-form').addEventListener('submit', calculateShape);

    // Initial setup and calculation on load
    window.onload = function() {
        updateInputs(); // Sets up Circle inputs and initial values
        // Note: updateInputs already triggers calculateShape, so no need for an extra submit call here.
    };
</script>
{% endblock %}