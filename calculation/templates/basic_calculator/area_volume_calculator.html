{% extends "base.html" %}

{% block title %}Area and Volume Calculator{% endblock %}

{% block meta_description %}Calculate the area of 2D shapes (Square, Circle, Triangle) and the volume of 3D shapes (Cube, Sphere, Cylinder).{% endblock %}

{% block meta_keywords %}area, volume, circle, square, cylinder, sphere, cube, rectangle, geometry, math calculator{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
    /* üé® Define Custom Theme Colors using CSS Variables */
    :root {
        --orange-dark: #9a3412; /* Darker Orange/Brown */
        --orange-light: #fef9e6; /* Light Yellow/Orange (Input Background) */
        --orange-accent: #f97316; /* Orange Accent (Input Border) */
        --indigo-dark: #4f46e5; /* Deep Indigo (Result Text, Button) */
        --indigo-lightest: #eef2ff; /* Lightest Indigo (Result Card Background) */
        --indigo-accent: #a5b4fc; /* Light Indigo (Formula Divider) */
    }

    /* üßº Solver Wrapper: Central container styling */
    .solver-wrapper {
        background: #fcfcfc;
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 750px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    /* ‚å®Ô∏è Input Section Styling */
    .input-section {
        background-color: var(--orange-light);
        border: 2px solid var(--orange-accent);
    }
    
    .input-box label {
        font-size: 0.95rem;
        font-weight: 500;
        color: var(--orange-dark); 
        margin-bottom: 3px;
    }

    .input-field {
        /* Custom input style */
        padding: 10px;
        font-size: 1.1rem;
        border: 2px solid #fb923c; /* Medium Orange border */
        border-radius: 6px;
        text-align: center;
        font-weight: 600;
        color: var(--orange-dark);
        /* Override Bootstrap focus for a cleaner look */
        transition: box-shadow 0.15s ease-in-out;
    }
    
    .input-field:focus {
        border-color: var(--orange-accent) !important;
        box-shadow: 0 0 0 0.25rem rgba(249, 115, 22, 0.25) !important;
    }

    /* üìä Result Display Styling */
    .result-card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        background-color: var(--indigo-lightest);
        border-left: 5px solid var(--indigo-dark); /* Indigo accent */
    }

    .result-error {
        border-left: 5px solid #dc3545; /* Bootstrap danger red */
        background-color: #f8d7da;
        color: #842029;
        padding: 20px;
        border-radius: 8px;
    }
    
    .output-label {
        font-size: 1.2rem;
        font-weight: 700;
        color: #1f2937;
    }

    .output-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: var(--indigo-dark); /* Deep Indigo */
        word-break: break-all;
    }

    .formula-applied {
        margin-top: 15px;
        font-size: 0.9rem;
        color: #475569;
        line-height: 1.5;
        border-top: 1px dashed var(--indigo-accent);
        padding-top: 10px;
    }

    /* Bootstrap Grid for Dynamic Inputs */
    .input-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }

    /* Override Bootstrap select for a cleaner look */
    .input-field.form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23343a40' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
        padding-right: 2.5rem;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center fw-bolder mb-2 text-dark fs-2">Area & Volume Calculator</h1>
    <p class="text-secondary mb-5 text-center">
        Select a 2D or 3D shape and enter its dimensions to calculate the Area or Volume.
    </p>

    <div class="solver-wrapper">
        
        <form id="shape-form" class="d-grid gap-4">
            <div class="input-section p-4 rounded-3">
                <div class="input-box mb-4">
                    <label for="shape-selector" class="d-block text-center mb-2">Select Shape:</label>
                    <select id="shape-selector" 
                            class="form-select input-field shadow-sm text-center" 
                            onchange="updateInputs()">
                        <optgroup label="2D Area Calculations">
                            <option value="circle">Circle Area (pi * r^2)</option>
                            <option value="square">Square Area (s^2)</option>
                            <option value="rectangle">Rectangle Area (l \cdot w)</option>
                            <option value="triangle">Triangle Area (frac{1}{2} * b * h)</option>
                        </optgroup>
                        <optgroup label="3D Volume Calculations">
                            <option value="sphere">Sphere Volume (frac{4}{3} * pi * r^3)</option>
                            <option value="cube">Cube Volume (s^3)</option>
                            <option value="cylinder">Cylinder Volume (pi * r^2 * h)</option>
                            <option value="prism">Rectangular Prism Volume (l \cdot w \cdot h)</option>
                        </optgroup>
                    </select>
                </div>

                <div id="dynamic-inputs" class="input-grid">
                    </div>
            </div>

            <button type="submit"
                    class="btn w-100 fw-bold py-3 shadow-lg text-white"
                    style="background-color: var(--indigo-dark); border-color: var(--indigo-dark);">
                Calculate
            </button>
        </form>

        <div id="result-container" class="mt-4">
            <div id="solution-output" class="result-card">
                <p class="output-label text-center">Area (Circle) is:</p>
                <div class="output-value text-center">
                    mathbf{314.16}
                </div>
                <div class="formula-applied text-center">
                    Applied Formula: A = pi * r^2
                </div>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const PI = Math.PI;

    // Defines all shapes, their required inputs, and their calculation logic
    // (This object is kept exactly the same as it is the functional core)
    const SHAPES = {
        // --- 2D Shapes (Area) ---
        'square': {
            type: 'Area',
            inputs: [{ key: 's', label: 'Side Length (s)' }],
            formula: 'A = s^2',
            calc: (s) => s * s,
            example: { s: 10 }
        },
        'circle': {
            type: 'Area',
            inputs: [{ key: 'r', label: 'Radius (r)' }],
            formula: 'A = \\pi r^2',
            calc: (r) => PI * r * r,
            example: { r: 10 }
        },
        'rectangle': {
            type: 'Area',
            inputs: [{ key: 'l', label: 'Length (l)' }, { key: 'w', label: 'Width (w)' }],
            formula: 'A = l \\cdot w',
            calc: (l, w) => l * w,
            example: { l: 8, w: 5 }
        },
        'triangle': {
            type: 'Area',
            inputs: [{ key: 'b', label: 'Base (b)' }, { key: 'h', label: 'Height (h)' }],
            formula: 'A = \\frac{1}{2} b h',
            calc: (b, h) => 0.5 * b * h,
            example: { b: 6, h: 4 }
        },
        // --- 3D Shapes (Volume) ---
        'cube': {
            type: 'Volume',
            inputs: [{ key: 's', label: 'Side Length (s)' }],
            formula: 'V = s^3',
            calc: (s) => s * s * s,
            example: { s: 5 }
        },
        'sphere': {
            type: 'Volume',
            inputs: [{ key: 'r', label: 'Radius (r)' }],
            formula: 'V = \\frac{4}{3} \\pi r^3',
            calc: (r) => (4 / 3) * PI * r * r * r,
            example: { r: 3 }
        },
        'cylinder': {
            type: 'Volume',
            inputs: [{ key: 'r', label: 'Radius (r)' }, { key: 'h', label: 'Height (h)' }],
            formula: 'V = \\pi r^2 h',
            calc: (r, h) => PI * r * r * h,
            example: { r: 4, h: 10 }
        },
        'prism': {
            type: 'Volume',
            inputs: [{ key: 'l', label: 'Length (l)' }, { key: 'w', label: 'Width (w)' }, { key: 'h', label: 'Height (h)' }],
            formula: 'V = l \\cdot w \\cdot h',
            calc: (l, w, h) => l * w * h,
            example: { l: 6, w: 3, h: 2 }
        }
    };

    /**
     * Updates the UI to display inputs relevant to the selected shape.
     */
    function updateInputs() {
        const selector = document.getElementById('shape-selector');
        const shapeKey = selector.value;
        const dynamicInputsDiv = document.getElementById('dynamic-inputs');
        const shape = SHAPES[shapeKey];
        
        if (!shape) return;

        let html = '';
        shape.inputs.forEach(inputDef => {
            const initialValue = shape.example[inputDef.key];

            html += `
                <div class="input-box">
                    <label for="input-${inputDef.key}">${inputDef.label}:</label>
                    <input type="number" id="input-${inputDef.key}" value="${initialValue}" step="any" min="0" required
                           placeholder="${inputDef.label}"
                           class="form-control input-field shadow-sm">
                </div>
            `;
        });

        dynamicInputsDiv.innerHTML = html;
        // Trigger calculation immediately after updating inputs
        calculateShape(new Event('submit'));
    }

    /**
     * Updates the results display with appropriate styling and content.
     */
    function displayResult(isError, outputLabel, outputValue, formula) {
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.remove('d-none', 'result-error', 'result-card');
        
        if (isError) {
            outputDiv.classList.add('result-error');
            outputDiv.classList.remove('result-card');
            outputDiv.innerHTML = outputValue; // Error message is the value
        } else {
            outputDiv.classList.add('result-card');
            outputDiv.classList.remove('result-error');
            
            // Note: Retaining LaTeX syntax for formulas and result for proper MathJax rendering
            outputDiv.innerHTML = `
                <p class="output-label text-center">${outputLabel} is:</p>
                <div class="output-value text-center">
                    $$\\mathbf{${outputValue}}$$
                </div>
                <div class="formula-applied text-center">
                    Applied Formula: $$${formula}$$
                </div>
            `;
            // Trigger MathJax re-render after content update
            if (window.MathJax) {
                window.MathJax.typesetPromise([outputDiv]);
            }
        }
    }

    /**
     * Main function to perform the calculation based on selected shape.
     */
    function calculateShape(e) {
        if (e && e.preventDefault) {
            e.preventDefault();
        }

        const selector = document.getElementById('shape-selector');
        const shapeKey = selector.value;
        const shape = SHAPES[shapeKey];
        
        if (!shape) {
            displayResult(true, '', '<p class="fw-bold text-center">Shape Error</p><p class="text-center">The selected shape is not defined in the calculator logic.</p>', '');
            return;
        }

        // 1. Gather inputs
        const values = [];
        let valid = true;

        shape.inputs.forEach(inputDef => {
            const inputElement = document.getElementById(`input-${inputDef.key}`);
            const val = parseFloat(inputElement.value.trim());

            // Check if input is a non-negative number
            if (isNaN(val) || val < 0) {
                valid = false;
            }
            values.push(val);
        });

        // 2. Validate inputs
        if (!valid) {
            displayResult(true, '', '<p class="fw-bold text-center">Invalid Input</p><p class="text-center">Please enter positive numerical values for all dimensions.</p>', '');
            return;
        }

        // 3. Perform calculation
        let result;
        try {
            result = shape.calc(...values);
        } catch (error) {
            console.error("Calculation error:", error);
            displayResult(true, '', `<p class="fw-bold text-center">Calculation Error</p><p class="text-center">${error.message}</p>`, '');
            return;
        }

        // 4. Display result
        let result_f = result.toFixed(4).replace(/\.?0+$/, '');

        // If result is very large/small, use scientific notation
        if (Math.abs(result) > 1e12 || (Math.abs(result) < 1e-6 && result !== 0)) {
            result_f = result.toExponential(4);
        }

        displayResult(
            false,
            shape.type + ' (' + shapeKey.charAt(0).toUpperCase() + shapeKey.slice(1) + ')',
            result_f,
            shape.formula
        );
    }

    // Attach handler to the form
    document.getElementById('shape-form').addEventListener('submit', calculateShape);

    // Initial setup and calculation on load
    window.onload = function() {
        updateInputs(); 
    };
</script>
{% endblock %}