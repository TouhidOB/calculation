{% extends "base.html" %}

{% block title %}Standard Deviation Calculator ($\sigma$){% endblock %}

{% block meta_description %}Calculate the population standard deviation ($\sigma$), mean, and variance for a set of numbers (data set).{% endblock %}

{% block meta_keywords %}standard deviation, variance, mean, statistics calculator, data analysis{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Styling for the central calculation block */
    .solver-wrapper {
        background: #f0fdfa; /* Light cyan/teal background */
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 650px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-group {
        padding: 20px;
        border-radius: 8px;
        background-color: #f0fff4; /* Mint green */
        border: 1px solid #a7f3d0;
    }

    .input-group label {
        font-size: 1.1rem;
        font-weight: 600;
        color: #047857; /* Dark teal */
        margin-bottom: 10px;
        display: block;
        text-align: center;
    }

    #data-input {
        width: 100%;
        min-height: 120px;
        padding: 15px;
        font-size: 1.1rem;
        border: 2px solid #34d399; /* Medium teal border */
        border-radius: 8px;
        font-family: monospace; /* Monospace for data entry */
        font-weight: 500;
        color: #064e3b;
        resize: vertical;
    }
    
    .result-box {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        border-left: 5px solid;
    }

    /* Custom result styles */
    .result-success {
        border-left-color: #059669; /* Emerald Green */
        background-color: #f0fdfa;
        color: #064e3b;
    }
    .result-error {
        border-left-color: #ef4444; /* Red */
        background-color: #fee2e2;
        color: #991b1b;
    }

    .output-value {
        font-size: 2.5rem;
        font-weight: 800;
        text-align: center;
        color: #059669;
        margin-top: 10px;
    }

    .step-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed #d1d5db;
        font-size: 1.1rem;
    }
    .step-item:last-child {
        border-bottom: none;
    }

    .step-label {
        font-weight: 600;
        color: #1f2937;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <h1 class="text-3xl font-extrabold mb-2 text-gray-900 text-center">Standard Deviation Calculator ($\sigma$)</h1>
    <p class="text-gray-600 mb-6 text-center">Enter your data set to calculate the mean ($\mu$), variance ($\sigma^2$), and population standard deviation ($\sigma$).</p>

    <div class="solver-wrapper">
        <form id="stddev-form" class="space-y-6">
            
            <div class="input-group shadow-lg">
                <label for="data-input">Data Set (Enter numbers separated by commas or spaces):</label>
                <textarea id="data-input" required
                          placeholder="e.g., 2, 4, 4, 4, 5, 5, 7, 9"
                          class="shadow-inner focus:shadow-xl transition-shadow"></textarea>
                <p class="text-xs text-gray-500 mt-2 text-center">Default calculation uses Population Standard Deviation (division by $N$).</p>
            </div>

            <button type="submit"
                    class="w-full bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-xl hover:bg-emerald-700 transition duration-150 transform hover:scale-[1.01]">
                Calculate Standard Deviation
            </button>
        </form>

        <!-- Result Display Area -->
        <div id="result-container" class="mt-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">Statistical Results</h2>
            <div id="solution-output" class="result-box hidden">
                <!-- Result will be displayed here -->
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.getElementById('stddev-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const dataInput = document.getElementById('data-input').value.trim();
        const outputDiv = document.getElementById('solution-output');
        
        outputDiv.classList.add('hidden');
        outputDiv.className = 'result-box'; 
        outputDiv.innerHTML = '';

        let htmlContent = '';
        let resultClass = '';

        // 1. Parse Input
        const numbers = dataInput
            .split(/[\s,]+/) // Split by comma or space
            .filter(s => s.length > 0) // Remove empty strings
            .map(s => parseFloat(s))
            .filter(n => !isNaN(n)); // Keep only valid numbers

        // --- Input Validation ---
        if (numbers.length < 2) {
            htmlContent = `<p class="font-bold text-center">Invalid Data Set</p><p class="text-center">Please enter at least two valid numbers to calculate standard deviation.</p>`;
            resultClass = 'result-error';
            displayResult(resultClass, htmlContent);
            return;
        }

        const N = numbers.length;
        
        // 2. Calculate Mean ($\mu$)
        const sum = numbers.reduce((acc, val) => acc + val, 0);
        const mean = sum / N;

        // 3. Calculate Variance ($\sigma^2$) (Population)
        const squaredDifferencesSum = numbers.reduce((acc, val) => {
            const difference = val - mean;
            return acc + difference * difference;
        }, 0);
        
        const variance = squaredDifferencesSum / N; // Population Variance: divide by N

        // 4. Calculate Standard Deviation ($\sigma$)
        const stdDev = Math.sqrt(variance);

        // Format results for display (2 decimal places)
        const meanF = mean.toFixed(2);
        const varianceF = variance.toFixed(4);
        const stdDevF = stdDev.toFixed(4);
        
        // --- Result Display ---
        
        htmlContent += `<div class="p-2">
            <div class="step-item">
                <span class="step-label">Data Points ($N$):</span>
                <span>${N}</span>
            </div>
            <div class="step-item">
                <span class="step-label">Sum ($\\sum x$):</span>
                <span>${sum.toFixed(2)}</span>
            </div>
            <div class="step-item">
                <span class="step-label">Mean ($\mu$):</span>
                <span>$$\\mathbf{${meanF}}$$</span>
            </div>
            <div class="step-item">
                <span class="step-label">Variance ($\sigma^2$):</span>
                <span>$$\\mathbf{${varianceF}}$$</span>
            </div>
        </div>`;
        
        // Final Result
        htmlContent += `<p class="output-value mt-8">Standard Deviation ($\sigma$):</p>`;
        htmlContent += `<div class="output-value">$$\\mathbf{${stdDevF}}$$</div>`;
        
        htmlContent += `<p class="text-sm text-center text-gray-600 mt-4">
                            The standard deviation measures the spread of the data set. A larger $\\sigma$ indicates more variation.
                        </p>`;

        resultClass = 'result-success';
        
        displayResult(resultClass, htmlContent);
    });

    /**
     * Updates the results display with appropriate styling and content.
     */
    function displayResult(className, contentHtml) {
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.add(className);
        outputDiv.innerHTML = contentHtml;
        outputDiv.classList.remove('hidden');
    }
</script>
{% endblock %}