{% extends "base.html" %}

{% block title %}Binary/Decimal/Hex/Octal Converter{% endblock %}

{% block meta_description %}Convert numbers between Binary (Base 2), Decimal (Base 10), Hexadecimal (Base 16), and Octal (Base 8) formats.{% endblock %}

{% block meta_keywords %}base converter, binary, decimal, hexadecimal, octal, radix, computer science, number conversion{% endblock %}

{% block extra_head %}

<style>
    /* üé® Define Custom Theme Colors using CSS Variables */
    :root {
        --teal-light: #f0fdfa; /* Solver Wrapper Background */
        --green-pale: #d1fae5; /* Input Section Background */
        --green-accent: #10b981; /* Emerald Accent */
        --green-dark: #065f46; /* Input Text Color */
        --green-active: #059669; /* Darker selected green */
        --green-border: #064e3b; /* Active border */

        /* Result Card Accent Colors */
        --color-bin: #f59e0b; /* Amber */
        --color-dec: #10b981; /* Emerald */
        --color-hex: #3b82f6; /* Blue */
        --color-oct: #ef4444; /* Red */
    }

    /* üßº Solver Wrapper: Central container styling */
    .solver-wrapper {
        background: var(--teal-light);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 700px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    /* ‚å®Ô∏è Input Section Styling */
    .input-section {
        padding: 25px;
        border-radius: 10px;
        background-color: var(--green-pale);
        border: 2px solid var(--green-accent);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .input-field {
        /* Custom input style */
        padding: 12px;
        font-size: 1.2rem;
        border: 2px solid #34d399;
        border-radius: 6px;
        text-align: center;
        font-weight: 700;
        color: var(--green-dark);
        font-family: monospace; /* For better number visibility */
    }

    /* Styles for the base selection buttons */
    .base-selector button {
        flex-grow: 1;
        padding: 10px 5px;
        font-weight: 600;
        border-radius: 6px;
        transition: all 0.15s;
        border: 2px solid transparent;
        color: #495057; /* Bootstrap default text color */
        background-color: #e9ecef; /* Light gray background */
    }
    .base-selector button:not(.active):hover {
        background-color: var(--green-pale);
    }
    .base-selector button.active {
        background-color: var(--green-active);
        color: white;
        border-color: var(--green-border);
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    }

    /* Result Grid Styling (Bootstrap 5 Grid) */
    .output-grid {
        margin-top: 30px;
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 20px;
    }

    /* üìä Result Card Styling */
    .result-card {
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background-color: #ffffff;
        border-left: 5px solid; 
    }

    /* Specific colors for result cards */
    .result-bin { border-left-color: var(--color-bin); }
    .result-dec { border-left-color: var(--color-dec); }
    .result-hex { border-left-color: var(--color-hex); }
    .result-oct { border-left-color: var(--color-oct); }
    .border-dashed { border-style: dashed !important; border-width: 3px !important; }

    .output-label {
        font-size: 1rem;
        font-weight: 600;
        text-align: center;
        color: #1f2937;
    }

    .output-value {
        font-size: 1.3rem;
        font-weight: 800;
        text-align: center;
        margin-top: 5px;
        word-break: break-all;
        font-family: monospace;
        color: #212529; /* Dark text for contrast */
    }

    .result-error {
        grid-column: span 2;
        border-left: 5px solid #dc3545; /* Bootstrap danger */
        background-color: #f8d7da;
        color: #842029;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
    }

</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center fw-bolder mb-2 text-dark fs-2">Multi-Base Converter</h1>
    <p class="text-secondary mb-5 text-center">
        Convert numbers instantly between Base 2, 8, 10, and 16.
    </p>

    <div class="solver-wrapper">
        
        <div class="input-section">
            <h3 class="fs-4 fw-bold text-center text-success mb-4" style="color: var(--green-dark);">Input Number & Base</h3>
            
            <label for="number-input" class="d-block fw-semibold mb-2 text-center text-dark">Enter Number:</label>
            <input type="text" id="number-input" required 
                   placeholder="e.g., A5, 101011, 23, 45"
                   class="form-control input-field shadow-sm text-uppercase"
                   oninput="convertBase()">
            
            <p class="d-block fw-semibold mt-4 mb-2 text-center text-dark">Select Input Base (Radix):</p>
            <div id="base-selector" class="base-selector d-flex justify-content-center gap-2">
                <button type="button" data-radix="2" class="btn active" onclick="selectBase(this)">Binary (2)</button>
                <button type="button" data-radix="8" class="btn" onclick="selectBase(this)">Octal (8)</button>
                <button type="button" data-radix="10" class="btn" onclick="selectBase(this)">Decimal (10)</button>
                <button type="button" data-radix="16" class="btn" onclick="selectBase(this)">Hex (16)</button>
            </div>
            
        </div>

        <div id="solution-output" class="output-grid d-none">
            </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    let currentRadix = 2; // Default to Binary

    /**
     * Sets the active base button and updates the global radix.
     * @param {HTMLElement} button - The clicked button element.
     */
    function selectBase(button) {
        // Remove 'active' class from all buttons
        document.querySelectorAll('.base-selector button').forEach(btn => {
            btn.classList.remove('active');
        });

        // Add 'active' class to the clicked button
        button.classList.add('active');
        
        currentRadix = parseInt(button.dataset.radix);
        
        // Always call convertBase() when the base changes to update results based on the current input value
        convertBase();
    }

    /**
     * Creates an HTML card for a single converted base result.
     * @param {string} title - The title/base name.
     * @param {string} value - The converted number string.
     * @param {string} cssClass - Custom class for styling.
     * @returns {string} HTML string for the result card.
     */
    function createResultCard(title, value, cssClass) {
        return `
            <div class="result-card ${cssClass}">
                <p class="output-label">${title}</p>
                <div class="output-value">${value}</div>
            </div>
        `;
    }

    /**
     * Performs the conversion from the input base to all other bases.
     */
    function convertBase() {
        const inputElement = document.getElementById('number-input');
        const outputDiv = document.getElementById('solution-output');
        const inputStr = inputElement.value.trim().toUpperCase(); // Hex uses uppercase

        outputDiv.innerHTML = ''; // Clear previous results
        outputDiv.classList.add('d-none'); // Hide the grid if input is empty or invalid

        if (inputStr === '') {
            // If input is empty, just keep the output hidden and exit
            return;
        }

        // --- 1. Convert Input String to Decimal (Base 10) and Validate ---
        let decimalValue;
        
        // Create a regex pattern based on the current radix
        let validPattern;
        switch (currentRadix) {
            case 2: validPattern = /^[01]+$/; break;
            case 8: validPattern = /^[0-7]+$/; break;
            case 10: validPattern = /^\d+$/; break;
            case 16: validPattern = /^[0-9A-F]+$/; break;
            default: validPattern = /./; 
        }

        // Check for valid characters
        if (!validPattern.test(inputStr)) {
            const htmlContent = `<p class="fw-bold">Invalid Input for Base ${currentRadix}</p><p>Please ensure your number contains only valid digits/characters for the selected base.</p>`;
            outputDiv.innerHTML = `<div class="result-error">${htmlContent}</div>`;
            outputDiv.classList.remove('d-none'); // Show error
            return;
        }

        // Attempt the conversion
        try {
            // Using BigInt for larger number support (if input is within BigInt string length limits)
            decimalValue = BigInt(parseInt(inputStr, currentRadix));
        } catch (e) {
            // Fallback for errors like non-integer values or numbers too large for BigInt constructor
            const htmlContent = `<p class="fw-bold">Input Error</p><p>The number is too large or contains an unhandled error.</p>`;
            outputDiv.innerHTML = `<div class="result-error">${htmlContent}</div>`;
            outputDiv.classList.remove('d-none'); // Show error
            return;
        }


        // --- 2. Convert Decimal (BigInt) to all other bases ---
        
        const conversions = [
            { radix: 2, name: 'Binary (Base 2)', class: 'result-bin' },
            { radix: 8, name: 'Octal (Base 8)', class: 'result-oct' },
            { radix: 10, name: 'Decimal (Base 10)', class: 'result-dec' },
            { radix: 16, name: 'Hexadecimal (Base 16)', class: 'result-hex' },
        ];

        let htmlContent = '';
        
        conversions.forEach(conversion => {
            let convertedValue;
            let cardClass = conversion.class;

            try {
                // Use the BigInt's built-in toString method
                convertedValue = decimalValue.toString(conversion.radix);
            } catch (e) {
                convertedValue = "ERROR";
            }
            
            // Hex is traditionally uppercase
            if (conversion.radix === 16) {
                convertedValue = convertedValue.toUpperCase();
            }
            
            // Mark the source base with a dashed border and use the original, validated input string
            if (conversion.radix === currentRadix) {
                cardClass += ' border-dashed';
                convertedValue = inputStr; 
            }

            htmlContent += createResultCard(conversion.name, convertedValue, cardClass);
        });

        outputDiv.innerHTML = htmlContent;
        outputDiv.classList.remove('d-none'); // Show results
    }

    // Initialize the calculator on load
    window.onload = function() {
        // Set the initial active button style for Binary (Base 2)
        // This ensures the correct button is highlighted when the page loads
        selectBase(document.querySelector('.base-selector button[data-radix="2"]'));
        
        // FIX: Removed the automatic call to convertBase() by itself here.
        // The convertBase() is now only called when:
        // 1. A key is pressed in the input field (oninput="convertBase()").
        // 2. A base selector button is clicked (selectBase calls convertBase()).
    };
</script>
{% endblock %}