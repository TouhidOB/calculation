{% extends "base.html" %}

{% block title %}Significant Figures Counter{% endblock %}

{% block meta_description %}Count the number of significant figures (Sig Figs) in any number (decimal, whole number, or scientific notation).{% endblock %}

{% block meta_keywords %}significant figures, sig figs, precision, measurement, rules for counting, math calculator{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Styling for the central calculation block (Blue/Gray Theme) */
    .solver-wrapper {
        background: #f8fafc; /* Lightest blue-gray background */
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 650px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-section {
        padding: 25px;
        border-radius: 10px;
        background-color: #e0f2fe; /* Light sky blue */
        border: 2px solid #38bdf8; /* Sky Blue accent */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .input-box label {
        font-size: 1rem;
        font-weight: 500;
        color: #0c4a6e; /* Dark blue */
        display: block;
        margin-bottom: 5px;
        text-align: center;
    }

    .input-field {
        width: 100%;
        padding: 12px;
        font-size: 1.2rem;
        border: 2px solid #7dd3fc; 
        border-radius: 6px;
        text-align: center;
        font-weight: 600;
        color: #0f172a;
        font-family: monospace;
    }
    
    .result-section {
        margin-top: 30px;
    }

    .result-card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        background-color: #f0f9ff; /* Very light blue */
        border-left: 5px solid #0ea5e9; /* Deep blue accent */
    }

    .result-error {
        border-left: 5px solid #ef4444; /* Red */
        background-color: #fee2e2;
        color: #991b1b;
        padding: 20px;
        border-radius: 8px;
    }
    
    .output-label {
        font-size: 1.2rem;
        font-weight: 700;
        text-align: center;
        color: #1f2937;
        margin-bottom: 10px;
    }

    .output-value {
        font-size: 2.5rem;
        font-weight: 800;
        text-align: center;
        color: #0ea5e9; /* Sky blue */
        word-break: break-all;
    }

    .explanation {
        margin-top: 15px;
        font-size: 0.95rem;
        color: #475569;
        line-height: 1.5;
        border-top: 1px dashed #bae6fd;
        padding-top: 10px;
    }
    
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <h1 class="text-3xl font-extrabold mb-2 text-gray-900 text-center">Significant Figures Counter</h1>
    <p class="text-gray-600 mb-6 text-center">
        Enter a number to calculate its significant figures (SF) and understand the rules applied.
    </p>

    <div class="solver-wrapper">
        
        <div class="input-section">
            <h3 class="text-xl font-bold text-center text-blue-700 mb-4">Input Number</h3>
            
            <div class="input-box">
                <label for="number-input">Enter Number (e.g., $0.0120$, $5400$, or $3.0 \times 10^{5}$):</label>
                <input type="text" id="number-input" value="0.001230" required 
                       placeholder="Enter number here..."
                       class="input-field shadow-inner focus:shadow-xl transition-shadow"
                       oninput="countSigFigs()">
            </div>
            
        </div>

        <div id="result-container" class="result-section">
            <div id="solution-output" class="result-card">
                <!-- Initial result display -->
                <p class="output-label">Significant Figures (SF):</p>
                <div class="output-value">
                    $$\mathbf{4}$$
                </div>
                <div class="explanation">
                    <p>Since a decimal point is present, all digits from the first non-zero digit ('1') to the very last digit, including trailing zeros (Rule 4), are significant.</p>
                </div>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    /**
     * Calculates the number of significant figures in a string representation of a number.
     * @param {string} inputStr - The user's input string.
     * @returns {{count: (string|number), explanation: string}} The SF count and explanation.
     */
    function calculateSigFigs(inputStr) {
        let s = inputStr.replace(/,/g, '').trim(); // Remove commas for consistency

        if (s.length === 0) {
            return { count: 0, explanation: 'The input field is empty.' };
        }
        
        // 1. Handle scientific notation (e.g., 1.23e5)
        let eIndex = s.search(/[eE]/);
        if (eIndex !== -1) {
            // Significant figures are counted only from the mantissa (the part before 'e')
            s = s.substring(0, eIndex);
        }
        
        // 2. Remove sign
        const isNegative = s.startsWith('+') || s.startsWith('-');
        if (isNegative) {
            s = s.substring(1);
        }

        // 3. Handle zero case
        if (s.replace(/[\.0]/g, '').length === 0) {
            return { count: 0, explanation: 'The number is zero, which has no significant figures defined by standard rules.' };
        }

        const hasDecimal = s.includes('.');
        let rawDigits = s.replace('.', '');

        // Find the index of the first non-zero digit
        let firstNonZero = -1;
        for (let i = 0; i < rawDigits.length; i++) {
            if (rawDigits[i] !== '0') {
                firstNonZero = i;
                break;
            }
        }

        // The significant sequence starts here (Rule 2: Leading zeros are NOT significant)
        let significantDigits = rawDigits.substring(firstNonZero); 
        let sfCount = significantDigits.length;
        let explanation = `The first significant digit is **${significantDigits[0]}**. `;

        if (hasDecimal) {
            // Rule 4 (Trailing Zeros with Decimal): All digits from the first non-zero to the end are significant.
            explanation += `Since a **decimal point** is present, all digits from the first non-zero digit to the very last digit, including captive and trailing zeros, are significant (Rules 1, 3, & 4).`;
            return { count: sfCount, explanation: explanation };

        } else {
            // No Decimal Point (Ambiguity possible)
            
            // Find the index of the last non-zero digit in the *rawDigits* string
            let lastNonZero = -1;
            for (let i = rawDigits.length - 1; i >= 0; i--) {
                if (rawDigits[i] !== '0') {
                    lastNonZero = i;
                    break;
                }
            }
            
            // Definite SF count: up to the last non-zero digit (Rules 1 & 3)
            let definiteSF = lastNonZero - firstNonZero + 1;
            
            if (definiteSF < sfCount) {
                // This is the ambiguous case (e.g., 100, 5400)
                explanation += `Trailing zeros in a whole number like this (**without a decimal point**) are considered **ambiguous**. The number of significant figures could be **${definiteSF}** (counting only digits up to the last non-zero) or **${sfCount}** (if the trailing zeros were actually measured). The most conservative count is **${definiteSF}**.`;
                return { count: `${definiteSF} to ${sfCount} (Ambiguous)`, explanation: explanation };
            } else {
                // Case like 123
                explanation += `All non-zero digits and captive zeros are significant (Rules 1 & 3). There are no decimal-dependent trailing zeros to consider.`;
                return { count: sfCount, explanation: explanation };
            }
        }
    }

    /**
     * Updates the UI with the calculation result or error.
     */
    function countSigFigs() {
        const inputElement = document.getElementById('number-input');
        const outputDiv = document.getElementById('solution-output');
        const inputStr = inputElement.value;
        let result;

        try {
            result = calculateSigFigs(inputStr);
        } catch (e) {
            const htmlContent = `<p class="font-bold text-center">Processing Error</p><p class="text-center">Could not parse the input. Please check for extraneous characters.</p>`;
            outputDiv.innerHTML = `<div class="result-error">${htmlContent}</div>`;
            outputDiv.classList.remove('result-card');
            outputDiv.classList.add('result-error');
            return;
        }

        const isError = (result.count === 0 && inputStr.replace(/[\.0]/g, '').length === 0);
        
        // Update the output card
        if (!isError) {
            outputDiv.classList.remove('result-error');
            outputDiv.classList.add('result-card');
            outputDiv.innerHTML = `
                <p class="output-label">Significant Figures (SF):</p>
                <div class="output-value">
                    $$\\mathbf{${result.count}}$$
                </div>
                <div class="explanation">
                    <p>${result.explanation}</p>
                </div>
            `;
        } else {
            outputDiv.innerHTML = `<div class="result-error"><p class="font-bold text-center">Zero/Invalid Input</p><p class="text-center">${result.explanation}</p></div>`;
            outputDiv.classList.remove('result-card');
            outputDiv.classList.add('result-error');
        }
    }

    // Run on load
    window.onload = countSigFigs;
</script>
{% endblock %}