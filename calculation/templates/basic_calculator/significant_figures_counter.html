{% extends "base.html" %}

{% block title %}Significant Figures Counter{% endblock %}

{% block meta_description %}Count the number of significant figures (Sig Figs) in any number (decimal, whole number, or scientific notation).{% endblock %}

{% block meta_keywords %}significant figures, sig figs, precision, measurement, rules for counting, math calculator{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
    /* Styling for the central calculation block (Bootstrap Primary/Blue Theme) */
    .solver-wrapper {
        background: #f8f9fa; /* Light background */
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 650px;
        margin: 0 auto;
    }
    
    .input-section {
        padding: 25px;
        border-radius: 10px;
        background-color: #eaf4ff; /* Very light blue */
        border: 2px solid #0d6efd; /* Primary Blue accent */
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }
    
    .input-box label {
        font-size: 1rem;
        font-weight: 500;
        color: #0d4484; /* Dark blue */
        display: block;
        margin-bottom: 5px;
        text-align: center;
    }

    .input-field {
        width: 100%;
        padding: 12px;
        font-size: 1.2rem;
        border: 2px solid #0d6efd; 
        border-radius: 6px;
        text-align: center;
        font-weight: 600;
        color: #212529;
        font-family: monospace;
    }
    
    .result-section {
        margin-top: 30px;
    }

    .result-card {
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        background-color: #e9f0f8; /* Light blue-gray */
        border-left: 5px solid #0d6efd; /* Deep blue accent */
    }

    .result-error {
        border-left: 5px solid #dc3545; /* Danger (Red) */
        background-color: #f8d7da;
        color: #721c24;
        padding: 20px;
        border-radius: 8px;
    }
    
    .output-label {
        font-size: 1.2rem;
        font-weight: 700;
        text-align: center;
        color: #212529;
        margin-bottom: 10px;
    }

    .output-value {
        font-size: 2.5rem;
        font-weight: 800;
        text-align: center;
        color: #0d6efd; /* Primary blue */
        word-break: break-all;
    }

    .explanation {
        margin-top: 15px;
        font-size: 0.95rem;
        color: #495057;
        line-height: 1.5;
        border-top: 1px dashed #a0c3ec;
        padding-top: 10px;
    }
    
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center fw-bolder mb-2 text-dark">Significant Figures Counter</h1>
    <p class="text-secondary mb-4 text-center">
        Enter a number to calculate its significant figures (SF) and understand the rules applied.
    </p>

    <div class="solver-wrapper">
        
        <div class="input-section">
            <h3 class="h5 text-center text-primary fw-bold mb-4">Input Number</h3>
            
            <div class="input-box">
                <label for="number-input">Enter Number (e.g., $0.0120$, $5400$, or $3.0 \times 10^{5}$):</label>
                <input type="text" id="number-input" required 
                       placeholder="Enter number here..."
                       class="input-field shadow-sm form-control"
                       oninput="countSigFigs()">
            </div>
            
        </div>

        <div id="result-container" class="result-section">
            <div id="solution-output" class="p-4 border text-center text-muted rounded">
                Start typing a number above to see the Significant Figures count and explanation.
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script>
    function calculateSigFigs(inputStr) {
        let s = inputStr.replace(/,/g, '').trim(); // Remove commas for consistency

        if (s.length === 0) {
            return { count: 0, explanation: 'The input field is empty.' };
        }
        
        // 1. Handle scientific notation (e.g., 1.23e5)
        let eIndex = s.search(/[eE]/);
        if (eIndex !== -1) {
            // Significant figures are counted only from the mantissa (the part before 'e')
            s = s.substring(0, eIndex);
        }
        
        // 2. Remove sign
        const isNegative = s.startsWith('+') || s.startsWith('-');
        if (isNegative) {
            s = s.substring(1);
        }

        // 3. Handle zero case
        if (s.replace(/[\.0]/g, '').length === 0) {
            return { count: 0, explanation: 'The number is zero, which has no significant figures defined by standard rules.' };
        }

        const hasDecimal = s.includes('.');
        let rawDigits = s.replace('.', '');
        
        // Find the index of the first non-zero digit
        let firstNonZero = -1;
        for (let i = 0; i < rawDigits.length; i++) {
            if (rawDigits[i] !== '0') {
                firstNonZero = i;
                break;
            }
        }

        // The significant sequence starts here (Rule 2: Leading zeros are NOT significant)
        // If the number is 0.001230, rawDigits="0001230", firstNonZero=3. significantDigits="1230".
        let significantDigits = rawDigits.substring(firstNonZero); 
        let sfCount = significantDigits.length;
        let explanation = '';

        if (hasDecimal) {
            // Rule 4 (Trailing Zeros with Decimal): All digits from the first non-zero to the end are significant.
            // Rule 2 (Leading Zeros before first non-zero) are NOT significant.
            // Rule 3 (Captive Zeros) are significant.
            explanation = `The first significant digit is **${significantDigits[0]}**. Since a **decimal point** is present, all digits from the first non-zero digit ('${significantDigits[0]}') to the very last digit, including captive zeros and trailing zeros, are significant.`;
            return { count: sfCount, explanation: explanation };

        } else {
            // No Decimal Point (Ambiguity possible)
            
            // Find the index of the last non-zero digit in the *rawDigits* string
            let lastNonZero = -1;
            for (let i = rawDigits.length - 1; i >= 0; i--) {
                if (rawDigits[i] !== '0') {
                    lastNonZero = i;
                    break;
                }
            }
            
            // Definite SF count: up to the last non-zero digit (Rules 1 & 3)
            let definiteSF = lastNonZero - firstNonZero + 1;
            
            if (definiteSF < sfCount) {
                // This is the ambiguous case (e.g., 100, 5400)
                explanation = `The number of significant figures is **at least ${definiteSF}** (non-zero and captive zeros). Trailing zeros (**${'0'.repeat(sfCount - definiteSF)}**) in a whole number like this (**without a decimal point**) are considered **ambiguous**. They may or may not be significant.`;
                return { count: `${definiteSF} to ${sfCount} (Ambiguous)`, explanation: explanation };
            } else {
                // Case like 123
                explanation = `The first significant digit is **${significantDigits[0]}**. All non-zero digits (Rule 1) and captive zeros (Rule 3) are significant. There are no trailing zeros to consider.`;
                return { count: sfCount, explanation: explanation };
            }
        }
    }

    /**
     * Updates the UI with the calculation result or a placeholder/error.
     */
    function countSigFigs() {
        const inputElement = document.getElementById('number-input');
        const outputDiv = document.getElementById('solution-output');
        const inputStr = inputElement.value;

        if (inputStr.trim().length === 0) {
            outputDiv.innerHTML = `<div class="p-4 border text-center text-muted rounded">
                Start typing a number above to see the Significant Figures count and explanation.
            </div>`;
            return;
        }
        
        let result;

        try {
            result = calculateSigFigs(inputStr);
        } catch (e) {
            const htmlContent = `<p class="font-bold text-center">Processing Error</p><p class="text-center">Could not parse the input. Please check for extraneous characters.</p>`;
            outputDiv.innerHTML = `<div class="result-error">${htmlContent}</div>`;
            return;
        }

        const isZeroOrInvalid = (result.count === 0);
        
        // Update the output card
        if (!isZeroOrInvalid) {
            outputDiv.classList.remove('result-error', 'p-4', 'border', 'text-center', 'text-muted', 'rounded');
            outputDiv.classList.add('result-card');
            outputDiv.innerHTML = `
                <p class="output-label">Significant Figures (SF):</p>
                <div class="output-value">
                    $$\\mathbf{${result.count}}$$
                </div>
                <div class="explanation">
                    <p>${result.explanation}</p>
                </div>
            `;
        } else {
            const htmlContent = `<p class="font-bold text-center">Zero/Invalid Input</p><p class="text-center">${result.explanation}</p>`;
            outputDiv.innerHTML = `<div class="result-error">${htmlContent}</div>`;
            outputDiv.classList.remove('result-card');
        }
    }

    // FIXED: Removed window.onload auto-calculation. Now, the input's oninput handler does the work.
</script>
{% endblock %}