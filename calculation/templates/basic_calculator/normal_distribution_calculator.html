{% extends "base.html" %}

{% block title %}Normal Distribution Calculator (Z-Score & Probability){% endblock %}

{% block meta_description %}Calculate the Z-Score and cumulative probability (area under the curve) for a given X-value in a Normal Distribution. Formula: Z = (X - $\mu$) / $\sigma$.{% endblock %}

{% block meta_keywords %}normal distribution, z-score, probability, standard deviation, mean, cumulative probability, statistics calculator{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Styling for the central calculation block */
    .solver-wrapper {
        background: #f0fdf4; /* Lightest emerald/mint background */
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 650px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        padding: 20px;
        border-radius: 8px;
        background-color: #ecfdf5; /* Light mint green */
        border: 1px solid #a7f3d0;
    }

    .input-box label {
        font-size: 1rem;
        font-weight: 600;
        color: #047857; /* Dark emerald */
        margin-bottom: 5px;
        display: block;
        text-align: center;
    }

    .input-field {
        width: 100%;
        padding: 10px;
        font-size: 1.2rem;
        border: 2px solid #34d399; /* Medium emerald border */
        border-radius: 8px;
        text-align: center;
        font-weight: 700;
        color: #065f46;
    }
    
    .result-box {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        border-left: 5px solid;
    }

    /* Custom result styles */
    .result-success {
        border-left-color: #059669; /* Emerald Green */
        background-color: #f0fdfa;
        color: #064e3b;
    }
    .result-error {
        border-left-color: #ef4444; /* Red */
        background-color: #fee2e2;
        color: #991b1b;
    }

    .output-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 15px;
    }

    .output-card {
        padding: 15px 10px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        background-color: #d1fae5; /* Lighter emerald */
    }

    .output-label {
        font-size: 1.1rem;
        font-weight: 600;
        color: #047857;
        margin-bottom: 5px;
        text-align: center;
    }

    .output-value {
        font-size: 2rem;
        font-weight: 800;
        color: #059669;
        text-align: center;
        line-height: 1.2;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <h1 class="text-3xl font-extrabold mb-2 text-gray-900 text-center">Normal Distribution Calculator</h1>
    <p class="text-gray-600 mb-6 text-center">
        Calculate the Z-Score and the cumulative probability $P(X \le x)$. 
    </p>

    <div class="solver-wrapper">
        <form id="normal-dist-form" class="space-y-6">
            
            <div class="input-grid shadow-lg">
                <div class="input-box">
                    <label for="mean-input">Mean ($\mu$):</label>
                    <input type="number" id="mean-input" value="100" required step="any"
                           placeholder="e.g., 100"
                           class="input-field shadow-inner focus:shadow-xl transition-shadow">
                </div>
                <div class="input-box">
                    <label for="std-dev-input">Std. Dev. ($\sigma$):</label>
                    <input type="number" id="std-dev-input" value="15" required step="any" min="0.01"
                           placeholder="e.g., 15"
                           class="input-field shadow-inner focus:shadow-xl transition-shadow">
                </div>
                <div class="input-box">
                    <label for="x-value-input">X Value ($x$):</label>
                    <input type="number" id="x-value-input" value="115" required step="any"
                           placeholder="e.g., 115"
                           class="input-field shadow-inner focus:shadow-xl transition-shadow">
                </div>
            </div>

            <button type="submit"
                    class="w-full bg-emerald-600 text-white font-bold py-3 rounded-lg shadow-xl hover:bg-emerald-700 transition duration-150 transform hover:scale-[1.01]">
                Calculate Probability
            </button>
        </form>

        <!-- Result Display Area -->
        <div id="result-container" class="mt-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">Results</h2>
            <div id="solution-output" class="result-box hidden">
                <!-- Result will be displayed here -->
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Constants used for the approximation of the Error Function (erf)
    const a1 = 0.254829592;
    const a2 = -0.284496736;
    const a3 = 1.421413741;
    const a4 = -1.453152027;
    const a5 = 1.061405429;
    const p = 0.3275911;

    /**
     * Calculates the Error Function (erf) using a rational approximation.
     * Source: Abramowitz and Stegun, Handbook of Mathematical Functions.
     * This is required to find the cumulative distribution function (CDF) for the normal distribution.
     * @param {number} x - The input value.
     * @returns {number} The value of erf(x).
     */
    function erf(x) {
        // Sign is preserved in erf(x)
        const sign = (x >= 0) ? 1 : -1;
        x = Math.abs(x);

        // A&S formula 7.1.26
        const t = 1.0 / (1.0 + p * x);
        const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
        return sign * y;
    }

    /**
     * Calculates the Standard Normal Cumulative Distribution Function (CDF), $\Phi(z)$.
     * $\Phi(z) = P(Z \le z) = \frac{1}{2} [1 + \text{erf}(\frac{z}{\sqrt{2}})]$
     * @param {number} z - The Z-Score.
     * @returns {number} The cumulative probability $P(Z \le z)$.
     */
    function normalCDF(z) {
        return 0.5 * (1 + erf(z / Math.sqrt(2)));
    }

    document.getElementById('normal-dist-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const mu = parseFloat(document.getElementById('mean-input').value.trim());
        const sigma = parseFloat(document.getElementById('std-dev-input').value.trim());
        const xVal = parseFloat(document.getElementById('x-value-input').value.trim());
        
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.add('hidden');
        outputDiv.className = 'result-box'; 
        outputDiv.innerHTML = '';

        let htmlContent = '';
        let resultClass = '';

        // --- Input Validation ---
        if (isNaN(mu) || isNaN(sigma) || isNaN(xVal)) {
            htmlContent = `<p class="font-bold text-center">Invalid Input</p><p class="text-center">Please enter valid numerical values for $\\mu$, $\\sigma$, and $x$.</p>`;
            resultClass = 'result-error';
            displayResult(resultClass, htmlContent);
            return;
        }

        if (sigma <= 0) {
            htmlContent = `<p class="font-bold text-center">Invalid Standard Deviation</p><p class="text-center">Standard deviation ($\sigma$) must be a positive number.</p>`;
            resultClass = 'result-error';
            displayResult(resultClass, htmlContent);
            return;
        }
        
        // --- Core Calculations ---
        
        // 1. Calculate Z-Score
        const zScore = (xVal - mu) / sigma;

        // 2. Calculate Cumulative Probability (Area to the Left: P(X <= x))
        const pLessX = normalCDF(zScore);

        // 3. Calculate Area to the Right (P(X > x))
        const pGreaterX = 1 - pLessX;
        
        // Format results
        const zScoreF = zScore.toFixed(4);
        const pLessXF = pLessX.toFixed(4);
        const pLessXPercent = (pLessX * 100).toFixed(2);
        const pGreaterXF = pGreaterX.toFixed(4);
        const pGreaterXPercent = (pGreaterX * 100).toFixed(2);

        // --- Result Display ---
        
        htmlContent += `<p class="text-lg text-center font-medium mb-6">
                            Z-Score Formula: $z = \\frac{x - \\mu}{\\sigma} = \\frac{\\mathbf{${xVal} - ${mu}}}{\\mathbf{${sigma}}}$
                        </p>`;

        htmlContent += `<div class="output-grid">
            <div class="output-card">
                <div class="output-label">Z-Score ($z$)</div>
                <div class="output-value text-2xl">$$\\mathbf{${zScoreF}}$$</div>
            </div>
            <div class="output-card">
                <div class="output-label">Probability $P(X \\le x)$ (Left Area)</div>
                <div class="output-value text-xl">
                    $$\\mathbf{${pLessXF}}$$ ($${pLessXPercent}\\%$$)
                </div>
            </div>
            <div class="output-card">
                <div class="output-label">Probability $P(X > x)$ (Right Area)</div>
                <div class="output-value text-xl">
                    $$\\mathbf{${pGreaterXF}}$$ ($${pGreaterXPercent}\\%$$)
                </div>
            </div>
            <div class="output-card">
                <div class="output-label">Interpretation</div>
                <div class="text-sm font-medium pt-1 text-gray-700">
                    The value $\mathbf{${xVal}}$ is $\mathbf{|${zScoreF}|}$ standard deviation(s) ${zScore >= 0 ? 'above' : 'below'} the mean.
                </div>
            </div>
        </div>`;

        resultClass = 'result-success';
        
        displayResult(resultClass, htmlContent);
    });

    /**
     * Updates the results display with appropriate styling and content.
     */
    function displayResult(className, contentHtml) {
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.add(className);
        outputDiv.innerHTML = contentHtml;
        outputDiv.classList.remove('hidden');
    }
</script>
{% endblock %}