{% extends "base.html" %}

{% block title %}Normal Distribution Calculator (Z-Score & Probability){% endblock %}

{% block meta_description %}Calculate the Z-Score and cumulative probability (area under the curve) for a given X-value in a Normal Distribution. Formula: Z = (X - $\mu$) / $\sigma$.{% endblock %}

{% block meta_keywords %}normal distribution, z-score, probability, standard deviation, mean, cumulative probability, statistics calculator{% endblock %}

{% block extra_head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<style>
    /* ðŸŽ¨ Define Custom Theme Colors (Emerald/Green Theme for Bootstrap) */
    :root {
        --emerald-main: #059669; /* Deep Emerald for accent */
        --emerald-dark: #047857; /* Dark Emerald for labels */
        --mint-pale: #f0fdf4; /* Solver Wrapper Background */
        --mint-light: #ecfdf5; /* Input Section Background */
        --mint-accent: #34d399; /* Medium Emerald border */
        --result-bg: #d1fae5; /* Lighter Emerald result card */
    }

    /* ðŸ§¼ Solver Wrapper: Central container styling */
    .solver-wrapper {
        background: var(--mint-pale);
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 650px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-grid-custom {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        padding: 20px;
        border-radius: 8px;
        background-color: var(--mint-light);
        border: 1px solid #a7f3d0;
    }

    .input-box label {
        font-size: 1rem;
        font-weight: 600;
        color: var(--emerald-dark);
        margin-bottom: 5px;
        display: block;
        text-align: center;
    }

    .input-field {
        padding: 10px;
        font-size: 1.2rem;
        border: 2px solid var(--mint-accent);
        border-radius: 8px;
        text-align: center;
        font-weight: 700;
        color: #065f46;
    }
    .input-field:focus {
        border-color: var(--emerald-main);
        box-shadow: 0 0 0 0.25rem rgba(52, 211, 153, 0.25);
    }
    
    .result-box-custom {
        margin-top: 25px;
        padding: 20px;
        border-radius: 12px;
        border-left: 5px solid;
    }

    /* Custom result styles */
    .result-success {
        border-left-color: var(--emerald-main);
        background-color: #f0fdfa;
        color: #064e3b;
    }
    .result-error {
        border-left-color: var(--bs-danger); 
        background-color: #f8d7da;
        color: #842029;
    }

    .output-card-custom {
        padding: 15px 10px;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        background-color: var(--result-bg);
        height: 100%;
    }

    .output-label {
        font-size: 1.1rem;
        font-weight: 600;
        color: var(--emerald-dark);
        margin-bottom: 5px;
        text-align: center;
    }

    .output-value {
        font-size: 2rem;
        font-weight: 800;
        color: var(--emerald-main);
        text-align: center;
        line-height: 1.2;
    }
</style>
{% endblock %}

{% block content %}
<div class="container my-5">
    <h1 class="text-center fw-bolder mb-2 text-dark fs-2">Normal Distribution Calculator</h1>
    <p class="text-secondary mb-4 text-center">
        Calculate the **Z-Score** and the **cumulative probability** $P(X \le x)$. 
    </p>

    <div class="solver-wrapper shadow-lg">
        <form id="normal-dist-form" class="d-grid gap-4">
            
            <div class="input-grid-custom shadow-sm">
                <div class="input-box">
                    <label for="mean-input">Mean ($\mu$):</label>
                    <input type="number" id="mean-input" required step="any"
                           placeholder="e.g., 100"
                           class="form-control input-field">
                </div>
                <div class="input-box">
                    <label for="std-dev-input">Std. Dev. ($\sigma$):</label>
                    <input type="number" id="std-dev-input" required step="any" min="0.01"
                           placeholder="e.g., 15"
                           class="form-control input-field">
                </div>
                <div class="input-box">
                    <label for="x-value-input">X Value ($x$):</label>
                    <input type="number" id="x-value-input" required step="any"
                           placeholder="e.g., 115"
                           class="form-control input-field">
                </div>
            </div>

            <button type="submit"
                    class="btn w-100 fw-bold py-3 mt-3 shadow-xl text-white"
                    style="background-color: var(--emerald-main); border-color: var(--emerald-main);">
                Calculate Probability
            </button>
        </form>

        <div id="result-container" class="mt-4">
            <h2 class="fs-4 fw-semibold text-dark mb-3 border-bottom pb-2">Results</h2>
            <div id="solution-output" class="result-box-custom d-none">
                </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<script>
    // Constants used for the approximation of the Error Function (erf)
    const a1 = 0.254829592;
    const a2 = -0.284496736;
    const a3 = 1.421413741;
    const a4 = -1.453152027;
    const a5 = 1.061405429;
    const p = 0.3275911;

    /**
     * Calculates the Error Function (erf) using a rational approximation.
     * @param {number} x - The input value.
     * @returns {number} The value of erf(x).
     */
    function erf(x) {
        const sign = (x >= 0) ? 1 : -1;
        x = Math.abs(x);

        const t = 1.0 / (1.0 + p * x);
        const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
        return sign * y;
    }

    /**
     * Calculates the Standard Normal Cumulative Distribution Function (CDF), $\Phi(z)$.
     * $\Phi(z) = P(Z \le z) = \frac{1}{2} [1 + \text{erf}(\frac{z}{\sqrt{2}})]$
     * @param {number} z - The Z-Score.
     * @returns {number} The cumulative probability $P(Z \le z)$.
     */
    function normalCDF(z) {
        return 0.5 * (1 + erf(z / Math.sqrt(2)));
    }

    document.getElementById('normal-dist-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const mu = parseFloat(document.getElementById('mean-input').value.trim());
        const sigma = parseFloat(document.getElementById('std-dev-input').value.trim());
        const xVal = parseFloat(document.getElementById('x-value-input').value.trim());
        
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.add('d-none');
        outputDiv.classList.remove('result-error', 'result-success');
        outputDiv.innerHTML = '';

        let htmlContent = '';
        let resultClass = '';

        // --- Input Validation ---
        if (isNaN(mu) || isNaN(sigma) || isNaN(xVal)) {
            htmlContent = `<p class="fw-bold text-center">Invalid Input</p><p class="text-center">Please enter valid numerical values for $\\mu$, $\\sigma$, and $x$.</p>`;
            resultClass = 'result-error';
            displayResult(resultClass, htmlContent);
            return;
        }

        if (sigma <= 0) {
            htmlContent = `<p class="fw-bold text-center">Invalid Standard Deviation</p><p class="text-center">Standard deviation ($\sigma$) must be a positive number ($> 0$).</p>`;
            resultClass = 'result-error';
            displayResult(resultClass, htmlContent);
            return;
        }
        
        // --- Core Calculations ---
        
        // 1. Calculate Z-Score
        const zScore = (xVal - mu) / sigma;

        // 2. Calculate Cumulative Probability (Area to the Left: P(X <= x))
        const pLessX = normalCDF(zScore);

        // 3. Calculate Area to the Right (P(X > x))
        const pGreaterX = 1 - pLessX;
        
        // Format results
        const zScoreF = zScore.toFixed(4);
        const pLessXF = pLessX.toFixed(4);
        const pLessXPercent = (pLessX * 100).toFixed(2);
        const pGreaterXF = pGreaterX.toFixed(4);
        const pGreaterXPercent = (pGreaterX * 100).toFixed(2);

        // --- Result Display ---
        
        htmlContent += `<p class="fs-5 text-center fw-medium mb-4">
                            Z-Score Calculation: $$z = \\frac{x - \\mu}{\\sigma} = \\frac{\\mathbf{${xVal} - ${mu}}}{\\mathbf{${sigma}}} \\approx \\mathbf{${zScoreF}}$$
                        </p>`;

        htmlContent += `<div class="row g-3">
            <div class="col-lg-6 col-md-6 col-12">
                <div class="output-card-custom shadow-sm">
                    <div class="output-label">Z-Score ($z$)</div>
                    <div class="output-value fs-2">$$\\mathbf{${zScoreF}}$$</div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-12">
                <div class="output-card-custom shadow-sm">
                    <div class="output-label">Probability $P(X \\le x)$ (Area to the Left)</div>
                    <div class="output-value fs-3">
                        $$\\mathbf{${pLessXF}}$$ ($${pLessXPercent}\\%$$)
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-12">
                <div class="output-card-custom shadow-sm">
                    <div class="output-label">Probability $P(X > x)$ (Area to the Right)</div>
                    <div class="output-value fs-3">
                        $$\\mathbf{${pGreaterXF}}$$ ($${pGreaterXPercent}\\%$$)
                    </div>
                </div>
            </div>
            <div class="col-lg-6 col-md-6 col-12">
                <div class="output-card-custom shadow-sm">
                    <div class="output-label">Interpretation</div>
                    <div class="small fw-medium pt-1 text-center text-secondary">
                        The value $\mathbf{${xVal}}$ is $\mathbf{|${zScoreF}|}$ standard deviation(s) **${zScore >= 0 ? 'above' : 'below'}** the mean ($\mathbf{${mu}}$).
                    </div>
                </div>
            </div>
        </div>`;

        resultClass = 'result-success';
        
        displayResult(resultClass, htmlContent);
    });

    /**
     * Updates the results display with appropriate styling and content.
     */
    function displayResult(className, contentHtml) {
        const outputDiv = document.getElementById('solution-output');
        outputDiv.classList.add(className);
        outputDiv.innerHTML = contentHtml;
        outputDiv.classList.remove('d-none');
        
        // Trigger MathJax re-render
        if (window.MathJax) {
            window.MathJax.typesetPromise();
        }
    }
</script>
{% endblock %}