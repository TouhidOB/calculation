{% extends "base.html" %}

{% block title %}Complex Number Calculator ($a + bi$){% endblock %}

{% block meta_description %}Perform addition, subtraction, multiplication, and division on two complex numbers ($Z_1$ and $Z_2$) in the standard $a+bi$ form.{% endblock %}

{% block meta_keywords %}complex number, a+bi, imaginary number, arithmetic, calculator, impedance, phasor{% endblock %}

{% block extra_head %}
<script src="https://cdn.tailwindcss.com"></script>
<style>
    /* Styling for the central calculation block */
    .solver-wrapper {
        background: #f0f9ff; /* Lightest blue background */
        padding: 30px;
        border-radius: 16px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        max-width: 800px;
        margin: 0 auto;
        font-family: 'Inter', sans-serif;
    }
    
    .input-complex-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        padding: 20px;
        border-radius: 8px;
        background-color: #e0f2fe; /* Light sky blue */
        border: 1px solid #93c5fd;
    }

    .complex-input-group {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin-top: 10px;
    }
    
    .complex-input-box label {
        font-size: 0.9rem;
        font-weight: 500;
        color: #0c4a6e;
        display: block;
        margin-bottom: 3px;
    }

    .input-field {
        width: 100%;
        padding: 10px;
        font-size: 1.1rem;
        border: 2px solid #38bdf8; /* Medium blue border */
        border-radius: 6px;
        text-align: center;
        font-weight: 600;
        color: #075985;
    }
    
    .result-section {
        margin-top: 25px;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
    }

    .result-card {
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #bae6fd;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        background-color: #f0f9ff;
    }

    .result-error {
        border-left: 5px solid #ef4444; /* Red */
        background-color: #fee2e2;
        color: #991b1b;
        padding: 20px;
        border-radius: 8px;
        grid-column: span 2; /* Span across both columns on smaller screens */
    }
    
    .output-label {
        font-size: 1.2rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 10px;
        color: #0c4a6e;
    }

    .output-value {
        font-size: 1.8rem;
        font-weight: 800;
        text-align: center;
        color: #0ea5e9;
        word-break: break-all;
    }
    .complex-notation {
        font-family: monospace;
        font-size: 1.1rem;
        font-weight: 500;
        text-align: center;
        color: #64748b;
        margin-bottom: 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto p-4 md:p-8">
    <h1 class="text-3xl font-extrabold mb-2 text-gray-900 text-center">Complex Number Calculator</h1>
    <p class="text-gray-600 mb-6 text-center">Perform basic arithmetic on two complex numbers $Z_1$ and $Z_2$, where $Z = a + bi$.</p>

    <div class="solver-wrapper">
        <form id="complex-calculator-form" class="space-y-6">
            
            <div class="input-complex-grid shadow-lg">
                <div>
                    <h3 class="text-xl font-bold text-center text-sky-700 mb-2">Complex Number 1 ($Z_1$)</h3>
                    <p class="complex-notation text-center">$Z_1 = a_1 + b_1i$</p>
                    <div class="complex-input-group">
                        <div class="complex-input-box">
                            <label for="a1-input">Real Part ($a_1$):</label>
                            <input type="number" id="a1-input" value="3" required step="any"
                                   placeholder="Real (a1)"
                                   class="input-field shadow-inner focus:shadow-xl transition-shadow">
                        </div>
                        <div class="complex-input-box">
                            <label for="b1-input">Imaginary Part ($b_1$):</label>
                            <input type="number" id="b1-input" value="4" required step="any"
                                   placeholder="Imaginary (b1)"
                                   class="input-field shadow-inner focus:shadow-xl transition-shadow">
                        </div>
                    </div>
                </div>

                <div>
                    <h3 class="text-xl font-bold text-center text-sky-700 mb-2">Complex Number 2 ($Z_2$)</h3>
                    <p class="complex-notation text-center">$Z_2 = a_2 + b_2i$</p>
                    <div class="complex-input-group">
                        <div class="complex-input-box">
                            <label for="a2-input">Real Part ($a_2$):</label>
                            <input type="number" id="a2-input" value="1" required step="any"
                                   placeholder="Real (a2)"
                                   class="input-field shadow-inner focus:shadow-xl transition-shadow">
                        </div>
                        <div class="complex-input-box">
                            <label for="b2-input">Imaginary Part ($b_2$):</label>
                            <input type="number" id="b2-input" value="-2" required step="any"
                                   placeholder="Imaginary (b2)"
                                   class="input-field shadow-inner focus:shadow-xl transition-shadow">
                        </div>
                    </div>
                </div>
            </div>
            <p class="text-sm text-gray-500 text-center">Input examples: $Z_1 = 3 + 4i$, $Z_2 = 1 - 2i$.</p>

            <button type="submit"
                    class="w-full bg-sky-600 text-white font-bold py-3 rounded-lg shadow-xl hover:bg-sky-700 transition duration-150 transform hover:scale-[1.01]">
                Calculate All Operations
            </button>
        </form>

        <!-- Result Display Area -->
        <div id="result-container" class="mt-8">
            <h2 class="text-2xl font-semibold text-gray-800 mb-4 border-b pb-2">Calculated Results</h2>
            <div id="solution-output" class="result-section">
                <!-- Results will be displayed here -->
            </div>
        </div>
        
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    /**
     * Formats a complex number (a + bi) into a string.
     * @param {number} a - Real part.
     * @param {number} b - Imaginary part.
     * @returns {string} The formatted LaTeX string.
     */
    function formatComplex(a, b) {
        // Round to 4 decimal places for clean output
        const a_f = parseFloat(a.toFixed(4));
        const b_f = parseFloat(b.toFixed(4));

        if (b_f === 0) {
            return `\\mathbf{${a_f}}`; // Purely real
        } else if (a_f === 0) {
            if (b_f === 1) return `\\mathbf{i}`;
            if (b_f === -1) return `\\mathbf{-i}`;
            return `\\mathbf{${b_f}i}`; // Purely imaginary
        } else {
            const sign = b_f >= 0 ? '+' : '-';
            const b_abs = Math.abs(b_f);
            const b_term = b_abs === 1 ? 'i' : `${b_abs}i`;
            return `\\mathbf{${a_f} ${sign} ${b_term}}`; // General case
        }
    }
    
    /**
     * Generates an HTML card for a single result.
     */
    function createResultCard(title, resultComplex, operationSymbol) {
        const [a, b] = resultComplex;
        const formattedResult = formatComplex(a, b);

        let html = `
            <div class="result-card">
                <p class="output-label">${title} ($Z_1 ${operationSymbol} Z_2$)</p>
                <div class="output-value">
                    $$${formattedResult}$$
                </div>
            </div>
        `;
        return html;
    }

    document.getElementById('complex-calculator-form').addEventListener('submit', function(e) {
        e.preventDefault();

        const a1 = parseFloat(document.getElementById('a1-input').value.trim());
        const b1 = parseFloat(document.getElementById('b1-input').value.trim());
        const a2 = parseFloat(document.getElementById('a2-input').value.trim());
        const b2 = parseFloat(document.getElementById('b2-input').value.trim());
        
        const outputDiv = document.getElementById('solution-output');
        outputDiv.innerHTML = ''; // Clear previous results

        let htmlContent = '';
        let resultClass = '';

        // --- Input Validation ---
        if (isNaN(a1) || isNaN(b1) || isNaN(a2) || isNaN(b2)) {
            htmlContent = `<p class="font-bold text-center">Invalid Input</p><p class="text-center">Please enter valid numerical values for all four parts ($a_1, b_1, a_2, b_2$).</p>`;
            resultClass = 'result-error';
            outputDiv.innerHTML = htmlContent;
            outputDiv.className = 'result-error'; 
            return;
        }

        outputDiv.className = 'result-section'; // Set back to the grid layout

        // --- Core Calculations ---
        
        // 1. Addition (Z1 + Z2) = (a1 + a2) + (b1 + b2)i
        const addA = a1 + a2;
        const addB = b1 + b2;

        // 2. Subtraction (Z1 - Z2) = (a1 - a2) + (b1 - b2)i
        const subA = a1 - a2;
        const subB = b1 - b2;

        // 3. Multiplication (Z1 * Z2) = (a1*a2 - b1*b2) + (a1*b2 + b1*a2)i
        const multA = (a1 * a2) - (b1 * b2);
        const multB = (a1 * b2) + (b1 * a2);

        // 4. Division (Z1 / Z2) = [(a1*a2 + b1*b2) / (a2^2 + b2^2)] + [(b1*a2 - a1*b2) / (a2^2 + b2^2)]i
        const denominator = (a2 * a2) + (b2 * b2);

        if (denominator === 0) {
            htmlContent = `<p class="font-bold text-center">Division by Zero</p><p class="text-center">Cannot divide, as Complex Number 2 ($Z_2$) is zero ($0 + 0i$).</p>`;
            resultClass = 'result-error';
            outputDiv.innerHTML = htmlContent;
            outputDiv.className = 'result-error'; 
            return;
        }

        const divA = ((a1 * a2) + (b1 * b2)) / denominator;
        const divB = ((b1 * a2) - (a1 * b2)) / denominator;
        
        // --- Result Display ---
        
        // 1. Addition
        htmlContent += createResultCard('Addition', [addA, addB], '+');
        
        // 2. Subtraction
        htmlContent += createResultCard('Subtraction', [subA, subB], '-');

        // 3. Multiplication
        htmlContent += createResultCard('Multiplication', [multA, multB], '\\cdot');

        // 4. Division
        htmlContent += createResultCard('Division', [divA, divB], '/');

        outputDiv.innerHTML = htmlContent;
    });
</script>
{% endblock %}