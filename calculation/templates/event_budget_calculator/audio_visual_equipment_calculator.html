{% extends "base.html" %}

{% block title %}Audio-Visual (AV) Equipment Calculator{% endblock %}

{% block meta_description %}Plan your event's technical requirements. Calculate projector sizes, speaker quantities, and lighting needs based on guest count and venue size.{% endblock %}

{% block meta_keywords %}AV calculator, audio visual planner, event tech budget, projector screen size, speaker calculator, event lighting cost{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    :root {
        --bs-primary-rgb: 139, 92, 246; /* Violet 500 */
    }

    body {
        background-color: #f5f3ff;
    }

    .calc-card {
        background: white;
        border-radius: 1.25rem;
        box-shadow: 0 10px 25px rgba(139, 92, 246, 0.1);
        border: 1px solid #ddd6fe;
        overflow: hidden;
    }

    .input-sidebar {
        background-color: #1e1b4b; /* Deep Navy */
        color: #e0e7ff;
        border-right: 1px solid #312e81;
    }

    .form-label {
        font-weight: 700;
        color: #a5b4fc;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    /* Tech Category Cards */
    .tech-card {
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        border-left: 6px solid;
        background: white;
        border: 1px solid #e2e8f0;
        border-left-width: 6px;
        transition: all 0.2s ease;
    }

    .tech-card:hover { transform: scale(1.02); }

    .card-video { border-left-color: #ef4444; }   /* Red - Visuals */
    .card-audio { border-left-color: #3b82f6; }   /* Blue - Audio */
    .card-light { border-left-color: #facc15; }   /* Yellow - Lighting */

    .result-display-box {
        background-color: #2e1065;
        border: 1px solid #4c1d95;
        border-radius: 1rem;
        padding: 1.5rem;
        text-align: center;
    }

    .result-value {
        font-size: 2.75rem;
        font-weight: 800;
        color: #ffffff;
        line-height: 1;
    }

    .av-bar {
        height: 35px;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        background: #e2e8f0;
    }

    .bar-segment {
        height: 100%;
        color: white;
        font-weight: 700;
        font-size: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-dark"><i class="bi bi-mic text-primary me-2"></i>AV Tech Planner</h1>
        <p class="text-muted mx-auto" style="max-width: 650px;">
            Input your estimated technical costs to visualize your AV budget and receive equipment scale recommendations.
        </p>
    </div>

    <div class="calc-card mx-auto" style="max-width: 1100px;">
        <div class="row g-0">
            <div class="col-lg-4 input-sidebar p-4 p-md-5">
                <h5 class="fw-bold mb-4 text-white"><i class="bi bi-broadcast me-2"></i>Event Scale</h5>
                
                <div class="mb-4">
                    <label class="form-label">Anticipated Guests</label>
                    <div class="input-group shadow-sm">
                        <span class="input-group-text bg-white"><i class="bi bi-people"></i></span>
                        <input type="number" id="av-guests" class="form-control" placeholder="e.g. 200">
                    </div>
                </div>

                <div id="summary-section" class="d-none">
                    <div class="result-display-box mb-4">
                        <span class="form-label opacity-75">Total Tech Spend</span>
                        <div class="result-value my-1" id="total-av-cost">$0</div>
                        <p class="mb-0 small fw-bold text-info" id="av-per-head">$0.00 / guest</p>
                    </div>

                    <div class="p-3 bg-dark-subtle rounded border border-secondary small">
                        <h6 class="fw-bold text-white small mb-2 text-uppercase">Recommended Scale:</h6>
                        <ul class="ps-3 mb-0 text-white-50" id="recommendations-list">
                            </ul>
                    </div>
                </div>
            </div>

            <div class="col-lg-8 p-4 p-md-5 bg-white">
                <div id="placeholder-ui" class="text-center py-5">
                    <i class="bi bi-projector display-1 mb-3 text-muted opacity-25"></i>
                    <h4 class="fw-bold text-dark">Analyze Tech Needs</h4>
                    <p>Enter your guest count and estimated category costs to see your technical breakdown.</p>
                </div>

                <div id="planner-ui" class="d-none">
                    <h5 class="fw-bold mb-4 text-dark">Category Budgeting</h5>
                    
                    <div class="tech-card card-video">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="fw-bold mb-0 text-danger">Video & Projection</h6>
                                <p class="small text-muted mb-0">Screens, Projectors, LED Walls, Laptops.</p>
                            </div>
                            <div class="input-group w-25">
                                <span class="input-group-text">$</span>
                                <input type="number" id="cost-video" class="form-control av-input" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <div class="tech-card card-audio">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="fw-bold mb-0 text-primary">Audio & PA System</h6>
                                <p class="small text-muted mb-0">Mics, Speakers, Mixers, Monitors.</p>
                            </div>
                            <div class="input-group w-25">
                                <span class="input-group-text">$</span>
                                <input type="number" id="cost-audio" class="form-control av-input" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <div class="tech-card card-light">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="fw-bold mb-0 text-warning">Stage & Decor Lighting</h6>
                                <p class="small text-muted mb-0">Uplights, Stage Wash, Moving Heads.</p>
                            </div>
                            <div class="input-group w-25">
                                <span class="input-group-text">$</span>
                                <input type="number" id="cost-light" class="form-control av-input" placeholder="0">
                            </div>
                        </div>
                    </div>

                    <h6 class="fw-bold text-dark mt-5 mb-3"><i class="bi bi-gpu-card me-2"></i>Tech Allocation</h6>
                    <div class="av-bar shadow-sm" id="av-bar"></div>
                    
                    <div class="alert alert-secondary mt-4 small" role="alert">
                        <i class="bi bi-info-circle me-2"></i>
                        <strong>Staffing Note:</strong> Remember to include labor costs for an AV Technician (typically $400-$800/day) in your estimates.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const inputs = ['cost-video', 'cost-audio', 'cost-light'];
    const colors = { 'cost-video': '#ef4444', 'cost-audio': '#3b82f6', 'cost-light': '#facc15' };
    const labels = { 'cost-video': 'Video', 'cost-audio': 'Audio', 'cost-light': 'Lighting' };

    function calculateAV() {
        const guests = parseFloat(document.getElementById('av-guests').value) || 0;
        let totalCost = 0;
        let costs = {};

        inputs.forEach(id => {
            const val = parseFloat(document.getElementById(id).value) || 0;
            totalCost += val;
            costs[id] = val;
        });

        const placeholder = document.getElementById('placeholder-ui');
        const planner = document.getElementById('planner-ui');
        const summary = document.getElementById('summary-section');

        if (guests <= 0 && totalCost === 0) {
            placeholder.classList.remove('d-none');
            planner.classList.add('d-none');
            summary.classList.add('d-none');
            return;
        }

        placeholder.classList.add('d-none');
        planner.classList.remove('d-none');
        summary.classList.remove('d-none');

        // Logic for Recommendations
        const recList = document.getElementById('recommendations-list');
        recList.innerHTML = '';
        
        if (guests < 50) {
            recList.innerHTML += '<li>2-Speaker PA System</li><li>65" LED Display</li>';
        } else if (guests < 200) {
            recList.innerHTML += '<li>4-Speaker Array</li><li>10ft Projector Screen</li><li>Basic Stage Lighting</li>';
        } else {
            recList.innerHTML += '<li>Subwoofers Required</li><li>Dual Screen Setup</li><li>Dedicated AV Tech</li>';
        }

        // Summary Updates
        document.getElementById('total-av-cost').textContent = '$' + totalCost.toLocaleString();
        document.getElementById('av-per-head').textContent = '$' + (totalCost / (guests || 1)).toFixed(2) + ' / guest';

        // Bar Update
        const bar = document.getElementById('av-bar');
        bar.innerHTML = '';
        inputs.forEach(id => {
            if (costs[id] > 0) {
                const pct = (costs[id] / totalCost) * 100;
                const div = document.createElement('div');
                div.className = 'bar-segment';
                div.style.width = pct + '%';
                div.style.backgroundColor = colors[id];
                div.textContent = pct > 15 ? labels[id] : '';
                bar.appendChild(div);
            }
        });
    }

    window.onload = () => {
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calculateAV);
        });
    };
</script>
{% endblock %}