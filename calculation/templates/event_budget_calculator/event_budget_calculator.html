{% extends "base.html" %}

{% block title %}Event Budget Calculator (Complete Planner){% endblock %}

{% block meta_description %}Plan and track your event expenses with our comprehensive budget calculator. Visualize spending across categories like venue, catering, and decor.{% endblock %}

{% block meta_keywords %}event budget, wedding planner, party budget, expense tracker, event planning tool, budget calculator{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
<style>
    :root {
        --bs-primary-rgb: 99, 102, 241; /* Indigo 500 */
    }

    body {
        background-color: #f8fafc;
    }

    .calc-card {
        background: white;
        border-radius: 1.25rem;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
        border: 1px solid #e2e8f0;
        overflow: hidden;
    }

    .input-sidebar {
        background-color: #f5f3ff;
        border-right: 1px solid #ddd6fe;
    }

    .form-label {
        font-weight: 700;
        color: #334155;
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    /* Category Cards */
    .budget-card {
        border-radius: 12px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        border-left: 6px solid;
        background: white;
        transition: transform 0.2s;
        border-top: 1px solid #e2e8f0;
        border-right: 1px solid #e2e8f0;
        border-bottom: 1px solid #e2e8f0;
    }

    .budget-card:hover { transform: translateX(5px); }

    .card-venue { border-left-color: #6366f1; } /* Indigo */
    .card-food { border-left-color: #f59e0b; }  /* Amber */
    .card-decor { border-left-color: #ec4899; } /* Pink */
    .card-misc { border-left-color: #64748b; }  /* Slate */

    .result-display-box {
        background-color: #ffffff;
        border: 2px solid #ddd6fe;
        border-radius: 1rem;
        padding: 1.5rem;
        text-align: center;
    }

    .result-value {
        font-size: 2.5rem;
        font-weight: 800;
        color: #4338ca;
        line-height: 1;
    }

    .status-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-weight: 700;
    }

    /* Visual Bar */
    .breakdown-bar {
        height: 35px;
        border-radius: 8px;
        overflow: hidden;
        display: flex;
        background: #e2e8f0;
    }

    .bar-segment {
        height: 100%;
        color: white;
        font-weight: 700;
        font-size: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: width 0.4s ease;
    }

    .placeholder-state {
        padding: 5rem 2rem;
        text-align: center;
        color: #94a3b8;
    }
</style>
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="text-center mb-5">
        <h1 class="fw-bold text-dark"><i class="bi bi-wallet2 text-primary me-2"></i>Event Budget Planner</h1>
        <p class="text-muted mx-auto" style="max-width: 650px;">
            Track your event spending, compare against your target budget, and visualize where your money is going.
        </p>
    </div>

    <div class="calc-card mx-auto" style="max-width: 1100px;">
        <div class="row g-0">
            <div class="col-lg-4 input-sidebar p-4 p-md-5 d-flex flex-column">
                <h5 class="fw-bold mb-4 text-dark"><i class="bi bi-piggy-bank me-2"></i>Financial Goals</h5>
                
                <div class="mb-4">
                    <label class="form-label">Total Budget Target</label>
                    <div class="input-group shadow-sm">
                        <span class="input-group-text bg-white">$</span>
                        <input type="number" id="target-budget" class="form-control" placeholder="e.g. 5000">
                    </div>
                </div>

                <div id="summary-section" class="d-none">
                    <div class="result-display-box mb-4">
                        <span class="form-label text-primary opacity-75">Total Expenses</span>
                        <div class="result-value my-1" id="total-expenses-display">$0</div>
                        <div id="budget-status" class="mt-2"></div>
                    </div>
                </div>

                <div class="p-3 bg-white rounded border border-primary-subtle small mt-auto">
                    <i class="bi bi-lightbulb-fill text-warning me-1"></i>
                    <strong>Pro-Tip:</strong> Always set aside 10-15% of your total budget for "Emergency/Miscellaneous" costs.
                </div>
            </div>

            <div class="col-lg-8 p-4 p-md-5 bg-white">
                
                <div id="placeholder-ui" class="placeholder-state w-100">
                    <i class="bi bi-calculator display-1 mb-3 opacity-25"></i>
                    <h4 class="fw-bold text-dark">Start Your Budget</h4>
                    <p>Enter your target budget and start adding estimated costs to see your breakdown.</p>
                </div>

                <div id="planner-ui" class="d-none">
                    <h5 class="fw-bold mb-4 text-dark">Expense Categories</h5>
                    
                    <div class="budget-card card-venue">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="fw-bold mb-0 text-indigo"><i class="bi bi-building me-2"></i>Venue & Rentals</h6>
                            <div class="input-group w-25">
                                <span class="input-group-text py-0 px-2">$</span>
                                <input type="number" id="cost-venue" class="form-control form-control-sm budget-input" placeholder="0">
                            </div>
                        </div>
                        <p class="small text-muted mt-2 mb-0">Location fees, tables, chairs, and insurance.</p>
                    </div>

                    <div class="budget-card card-food">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="fw-bold mb-0 text-warning"><i class="bi bi-egg-fried me-2"></i>Catering & Drinks</h6>
                            <div class="input-group w-25">
                                <span class="input-group-text py-0 px-2">$</span>
                                <input type="number" id="cost-food" class="form-control form-control-sm budget-input" placeholder="0">
                            </div>
                        </div>
                        <p class="small text-muted mt-2 mb-0">Food per head, beverages, service staff, and cake.</p>
                    </div>

                    <div class="budget-card card-decor">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="fw-bold mb-0 text-pink"><i class="bi bi-flower1 me-2"></i>Decor & Floral</h6>
                            <div class="input-group w-25">
                                <span class="input-group-text py-0 px-2">$</span>
                                <input type="number" id="cost-decor" class="form-control form-control-sm budget-input" placeholder="0">
                            </div>
                        </div>
                        <p class="small text-muted mt-2 mb-0">Flowers, lighting, centerpieces, and signage.</p>
                    </div>

                    <div class="budget-card card-misc">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="fw-bold mb-0 text-secondary"><i class="bi bi-plus-circle me-2"></i>Marketing & Misc</h6>
                            <div class="input-group w-25">
                                <span class="input-group-text py-0 px-2">$</span>
                                <input type="number" id="cost-misc" class="form-control form-control-sm budget-input" placeholder="0">
                            </div>
                        </div>
                        <p class="small text-muted mt-2 mb-0">Invitations, photography, and emergency fund.</p>
                    </div>

                    <h6 class="fw-bold text-dark mt-5 mb-3"><i class="bi bi-pie-chart me-2"></i>Spending Distribution</h6>
                    <div class="breakdown-bar shadow-sm" id="budget-distribution-bar"></div>
                    <div class="d-flex justify-content-between mt-2 small text-muted">
                        <span>$0 Spending</span>
                        <span id="remaining-label"></span>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const inputs = ['cost-venue', 'cost-food', 'cost-decor', 'cost-misc'];
    const labels = { 'cost-venue': 'Venue', 'cost-food': 'Food', 'cost-decor': 'Decor', 'cost-misc': 'Misc' };
    const colors = { 'cost-venue': '#6366f1', 'cost-food': '#f59e0b', 'cost-decor': '#ec4899', 'cost-misc': '#64748b' };

    function calculate() {
        const targetBudget = parseFloat(document.getElementById('target-budget').value) || 0;
        let totalExpenses = 0;
        let data = [];
        
        inputs.forEach(id => {
            const val = parseFloat(document.getElementById(id).value) || 0;
            totalExpenses += val;
            data.push({ id, val });
        });

        const placeholder = document.getElementById('placeholder-ui');
        const planner = document.getElementById('planner-ui');
        const summary = document.getElementById('summary-section');
        const statusDiv = document.getElementById('budget-status');

        if (targetBudget === 0 && totalExpenses === 0) {
            placeholder.classList.remove('d-none');
            planner.classList.add('d-none');
            summary.classList.add('d-none');
            return;
        }

        placeholder.classList.add('d-none');
        planner.classList.remove('d-none');
        summary.classList.remove('d-none');

        document.getElementById('total-expenses-display').textContent = '$' + totalExpenses.toLocaleString();

        // Update Status Badge
        if (targetBudget > 0) {
            const diff = targetBudget - totalExpenses;
            if (diff >= 0) {
                statusDiv.innerHTML = `<span class="status-badge bg-success-subtle text-success border border-success">Under Budget: $${diff.toLocaleString()}</span>`;
            } else {
                statusDiv.innerHTML = `<span class="status-badge bg-danger-subtle text-danger border border-danger">Over Budget: $${Math.abs(diff).toLocaleString()}</span>`;
            }
            document.getElementById('remaining-label').textContent = 'Target: $' + targetBudget.toLocaleString();
        }

        // Update Visual Bar
        const bar = document.getElementById('budget-distribution-bar');
        bar.innerHTML = '';

        data.forEach(item => { 
            if (item.val > 0) {
                const pct = (item.val / Math.max(totalExpenses, targetBudget)) * 100;
                const segment = document.createElement('div');
                segment.className = 'bar-segment';
                segment.style.width = pct + '%';
                segment.style.backgroundColor = colors[item.id];
                segment.textContent = pct > 12 ? labels[item.id] : '';
                segment.title = labels[item.id] + ': $' + item.val;
                bar.appendChild(segment);
            }
        });
    }

    window.onload = () => {
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calculate);
        });
    };
</script>
{% endblock %}